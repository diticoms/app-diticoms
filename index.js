import ct from"react";import{createRoot as dt}from"react-dom/client";import{useState as U,useEffect as we,useCallback as ye,useMemo as rt}from"react";import{Settings as ot,LogOut as lt}from"lucide-react";import{useState as ce}from"react";import{User as Pe,Lock as Re}from"lucide-react";import{jsx as Ee}from"react/jsx-runtime";var j=({className:e="",size:o=64})=>Ee("img",{src:"logo.png",alt:"Logo",width:o,height:o,className:`${e} object-contain`,loading:"eager",onError:c=>{let N=c.target;N.src.indexOf("public/")===-1&&(N.src="public/logo.png")}});import{jsx as L,jsxs as J}from"react/jsx-runtime";var de=({onLogin:e,isLoading:o})=>{let[c,N]=ce(""),[m,b]=ce("");return L("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:J("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[o&&L("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:J("div",{className:"relative flex flex-col items-center",children:[L(j,{size:80,className:"animate-pulse"}),L("div",{className:"mt-8 text-center",children:L("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),J("div",{className:"flex flex-col items-center text-center space-y-3",children:[L(j,{size:64,className:o?"animate-pulse":""}),J("div",{children:[L("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),L("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),J("form",{onSubmit:k=>{k.preventDefault(),c&&m&&e(c,m)},className:"space-y-4",children:[J("div",{className:"relative",children:[L(Pe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),L("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:c,onChange:k=>N(k.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),J("div",{className:"relative",children:[L(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),L("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:m,onChange:k=>b(k.target.value),required:!0,autoComplete:"current-password"})]}),L("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),L("div",{className:"pt-4 text-center border-t border-slate-50",children:L("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as me,useMemo as _e,useRef as se}from"react";import{Search as be,ChevronRight as ze,Calendar as Ue,Filter as Oe,CheckCircle2 as De,Phone as Me,MapPin as Fe,Download as He}from"lucide-react";import*as Y from"xlsx";var re=()=>new Date().toISOString().split("T")[0];var P=e=>{let o=typeof e=="number"?e:parseInt(String(e).replace(/\D/g,""),10);return isNaN(o)?"0":o.toLocaleString("vi-VN")},ae=e=>{if(typeof e=="number")return e;let o=parseInt(e.replace(/\D/g,""),10);return isNaN(o)?0:o},pe=e=>e.reduce((o,c)=>o+(c.total||0),0);function ue(e,o){let c;return(...N)=>{clearTimeout(c),c=setTimeout(()=>e(...N),o)}}import{Fragment as je,jsx as d,jsxs as u}from"react/jsx-runtime";var ge=({data:e,loading:o,technicians:c,selectedId:N,onSelectRow:m,filters:b,setFilters:g,currentUser:k})=>{let I=k?.role==="admin",[y,F]=me(b.searchTerm),[z,W]=me(null),S=se(null),K=se(!1),D=se({x:0,y:0}),V=se(!1),B=_e(()=>ue(a=>g.setSearchTerm(a),300),[g]),O=a=>{F(a.target.value),B(a.target.value)},G=()=>{if(e.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let a=e.map(v=>{let s=Number(v.revenue||0),i=Number(v.cost||0),h=s-i,t=Number(v.debt||0);return{"Ng\xE0y nh\u1EADp":(v.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":v.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":v.phone,"\u0110\u1ECBa ch\u1EC9":v.address,"K\u1EF9 thu\u1EADt vi\xEAn":v.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":v.content,"Doanh thu (\u0111)":s,"Gi\xE1 v\u1ED1n (\u0111)":i,"L\u1EE3i nhu\u1EADn (\u0111)":h,"C\xF4ng n\u1EE3 (\u0111)":t,"Tr\u1EA1ng th\xE1i":v.status}}),w=Y.utils.json_to_sheet(a),C=Y.utils.book_new();Y.utils.book_append_sheet(C,w,"BaoCaoDichVu");let Q=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;Y.writeFile(C,Q)},E=a=>{let w=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${a.customerName}
\u{1F4DE} S\u0110T: ${a.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${a.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${a.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${a.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(w).then(()=>{W("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>W(null),2e3)}).catch(C=>{console.error("L\u1ED7i copy:",C)})},M=(a,w)=>{K.current=!1,V.current=!1,D.current={x:a.clientX,y:a.clientY},S.current=setTimeout(()=>{V.current||(K.current=!0,E(w))},600)},R=a=>{let w=Math.abs(a.clientX-D.current.x),C=Math.abs(a.clientY-D.current.y);(w>10||C>10)&&(V.current=!0,S.current&&(clearTimeout(S.current),S.current=null))},q=(a,w)=>{S.current&&(clearTimeout(S.current),S.current=null),!K.current&&!V.current&&m(w)};return u("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[z&&u("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[d(De,{size:16,className:"text-green-400"}),d("span",{className:"font-black text-[11px] uppercase tracking-widest",children:z})]}),u("div",{className:"space-y-3 mb-5 shrink-0",children:[u("div",{className:"relative group",children:[d(be,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),d("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:y,onChange:O})]}),u("div",{className:"flex flex-wrap items-center gap-1.5",children:[u("button",{onClick:()=>g.setViewAll(!b.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${b.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[d(Oe,{size:14})," ",b.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!b.viewAll&&u("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[d(Ue,{size:12,className:"text-slate-400"}),d("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateFrom,onChange:a=>g.setDateFrom(a.target.value)}),d("span",{className:"text-slate-300",children:"/"}),d("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateTo,onChange:a=>g.setDateTo(a.target.value)})]}),u("div",{className:"flex-1 flex gap-1.5",children:[I&&d("div",{className:"relative flex-1 min-w-[80px]",children:u("select",{className:"w-full pl-2 pr-6 py-1.5 bg-white border border-slate-200 rounded-xl outline-none font-bold text-slate-600 appearance-none h-[34px] cursor-pointer text-[10px] shadow-sm",value:b.searchTech,onChange:a=>g.setSearchTech(a.target.value),children:[d("option",{value:"",children:"KTV"}),c.map(a=>d("option",{value:a,children:a},a))]})}),u("button",{onClick:G,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider flex-shrink-0",children:[d(He,{size:14})," EXCEL"]})]})]})]}),d("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:o?u("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[d(j,{size:48,className:"animate-pulse"}),d("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):e.length===0?u("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[d(be,{size:48,strokeWidth:1,className:"opacity-40"}),d("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):e.map(a=>u("div",{onPointerDown:w=>M(w,a),onPointerMove:R,onPointerUp:w=>q(w,a),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${N===a.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[u("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[u("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[d("span",{children:(a.created_at||"").split("T")[0]?.split("-")[2]||"--"}),u("span",{className:"opacity-60 text-[10px]",children:["T",(a.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),u("div",{className:"min-w-0 flex-1",children:[d("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:a.customerName}),d("div",{className:"flex flex-col gap-0.5 mb-1.5",children:u("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[d(Me,{size:10,className:"text-blue-400"}),d("span",{children:a.phone}),a.address&&u(je,{children:[d("span",{className:"text-slate-200",children:"|"}),d(Fe,{size:10,className:"text-red-400"}),d("span",{className:"truncate max-w-[120px]",children:a.address})]})]})}),u("div",{className:"flex items-center gap-2",children:[d("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:a.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),d("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${a.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":a.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:a.status})]})]})]}),u("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[u("div",{className:"text-right",children:[u("div",{className:"font-black text-slate-800 text-[14px]",children:[P(a.revenue),"\u0111"]}),Number(a.debt)>0&&u("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",P(a.debt)]})]}),d(ze,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),N===a.id&&d("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},a.id))}),u("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[u("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[b.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",d("span",{className:"text-slate-700 ml-1 font-black",children:e.length})]}),u("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",P(e.reduce((a,w)=>a+Number(w.revenue||0),0)),"\u0111"]})]})]})};import{useState as ne,useRef as Xe,useMemo as le}from"react";import{Plus as $e,Trash2 as fe,Activity as Ge,User as qe,Phone as Ke,MapPin as Ve,ReceiptText as Be,X as Je,MessageSquare as We}from"lucide-react";import Ye from"html2canvas";var oe="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",he={sheetUrl:oe,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},ee=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{jsx as x,jsxs as A}from"react/jsx-runtime";var xe=({formData:e,bankInfo:o})=>{let c=pe(e.workItems),N=o?`https://img.vietqr.io/image/${o.bankId}-${o.accountNo}-compact2.png?amount=${c}&addInfo=DITICOMS SERVICE ${e.customerName.toUpperCase()}&accountName=${encodeURIComponent(o.accountName)}`:"";return A("div",{className:"w-[302px] bg-white p-6 mx-auto font-sans block",style:{height:"auto",minHeight:"fit-content"},children:[A("div",{className:"flex flex-col items-center text-center space-y-1 mb-5",children:[x(j,{size:52}),x("h1",{className:"text-xl font-black uppercase text-blue-600 tracking-tight",children:"DITICOMS SERVICE"}),x("p",{className:"text-[8px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:"S\u1EEDa ch\u1EEFa & B\u1EA3o tr\xEC Thi\u1EBFt b\u1ECB"}),x("div",{className:"w-12 h-0.5 bg-blue-600 rounded-full mt-1.5"})]}),A("div",{className:"space-y-1.5 mb-5 text-[11px]",children:[A("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[x("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Kh\xE1ch h\xE0ng:"}),x("span",{className:"font-bold text-slate-900",children:e.customerName})]}),A("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[x("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Ng\xE0y t\u1EA1o:"}),x("span",{className:"font-bold text-slate-900",children:new Date().toLocaleDateString("vi-VN")})]})]}),A("div",{className:"space-y-3 mb-6",children:[x("div",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest border-l-2 border-blue-500 pl-2",children:"Chi ti\u1EBFt d\u1ECBch v\u1EE5"}),A("table",{className:"w-full text-[10px] border-collapse",children:[x("thead",{children:A("tr",{className:"text-[8px] text-slate-400 uppercase border-b border-slate-100",children:[x("th",{className:"pb-2 text-left font-black",children:"N\u1ED9i dung"}),x("th",{className:"pb-2 text-center font-black px-1",children:"SL"}),x("th",{className:"pb-2 text-right font-black px-1",children:"\u0110\u01A1n gi\xE1"}),x("th",{className:"pb-2 text-right font-black",children:"T.Ti\u1EC1n"})]})}),x("tbody",{className:"divide-y divide-slate-50",children:e.workItems.map((m,b)=>A("tr",{className:"align-middle",children:[x("td",{className:"py-2.5 text-slate-800 font-bold leading-tight pr-1",children:m.desc}),x("td",{className:"py-2.5 text-center text-slate-600 font-black px-1",children:m.qty}),x("td",{className:"py-2.5 text-right text-slate-600 font-medium whitespace-nowrap px-1",children:P(m.price)}),x("td",{className:"py-2.5 text-right font-black text-slate-900 whitespace-nowrap",children:P(m.total)})]},b))})]})]}),A("div",{className:"bg-slate-50 p-4 rounded-2xl flex justify-between items-center mb-6",children:[x("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-wider",children:"T\u1ED5ng c\u1ED9ng:"}),A("span",{className:"text-lg font-black text-blue-600",children:[P(e.revenue),"\u0111"]})]}),o&&e.status!=="Ho\xE0n th\xE0nh"&&A("div",{className:"flex flex-col items-center space-y-2.5 pt-4 border-t border-dashed border-slate-200",children:[x("img",{src:N,alt:"QR",className:"w-32 h-32 border-2 border-white shadow-sm rounded-lg"}),A("div",{className:"text-center",children:[A("p",{className:"text-[9px] font-black text-slate-800 uppercase tracking-tighter",children:[o.bankId," \u2022 ",o.accountNo]}),x("p",{className:"text-[8px] font-bold text-slate-400 uppercase mt-0.5",children:o.accountName})]})]}),A("div",{className:"text-center pt-6 border-t border-slate-50 mt-6",children:[x("p",{className:"text-[9px] font-bold text-slate-400 uppercase italic tracking-widest",children:"Tr\xE2n tr\u1ECDng c\u1EA3m \u01A1n!"}),x("p",{className:"text-[7px] text-slate-300 mt-2 font-bold tracking-[0.3em]",children:"DITICOMS SERVICE MANAGER"})]})]})};import{Fragment as Ze,jsx as n,jsxs as p}from"react/jsx-runtime";var ve=({formData:e,setFormData:o,technicians:c,priceList:N,selectedId:m,isSubmitting:b,currentUser:g,onSave:k,onUpdate:I,onDelete:y,onClear:F,services:z,bankInfo:W})=>{let S=g?.role==="admin",[K,D]=ne(null),[V,B]=ne(!1),[O,G]=ne(!1),[E,M]=ne(!1),R=Xe(null),q=le(()=>{let t={};return[...z].sort((l,f)=>new Date(f.created_at).getTime()-new Date(l.created_at).getTime()).forEach(l=>{l.phone&&!t[l.phone]&&(t[l.phone]={name:l.customerName||"",address:l.address||""})}),Object.entries(t).map(([l,f])=>({phone:l,...f}))},[z]),a=le(()=>{let t=e.phone.trim();return t.length<3?[]:q.filter(r=>r.phone.includes(t)).slice(0,5)},[q,e.phone]),w=le(()=>{let t={};return z.forEach(r=>{(Array.isArray(r.workItems)?r.workItems:[]).forEach(f=>{f.desc&&(t[f.desc.trim()]=Number(f.price)||0)})}),N.forEach(r=>t[r.name.trim()]=r.price),Object.entries(t).map(([r,l])=>({name:r,price:l}))},[z,N]),C=(t,r)=>{o(l=>{let f={...l,[t]:r};return t==="status"&&(r==="Ho\xE0n th\xE0nh"?f.debt=0:f.debt=f.revenue),f})},Q=t=>{o(r=>({...r,phone:t.phone,customerName:t.name,address:t.address})),B(!1)},v=(t,r,l)=>{o(f=>{let H=[...f.workItems],te={...H[t],[r]:l},Te=ae(r==="price"?l:te.price),Ie=Number(r==="qty"?l:te.qty);te.total=Te*Ie,H[t]=te;let ie=H.reduce((Le,Ae)=>Le+(Number(Ae.total)||0),0);return{...f,workItems:H,revenue:ie,debt:f.status==="Ho\xE0n th\xE0nh"?0:ie}})},s=async()=>{if(R.current){M(!0);try{let t=await Ye(R.current,{scale:3,useCORS:!0}),r=`Bill_${(e.customerName||"Khach").toUpperCase()}.png`;t.toBlob(async l=>{if(!l)return;if(navigator.share&&navigator.canShare){let H=new File([l],r,{type:"image/png"});if(navigator.canShare({files:[H]})){await navigator.share({files:[H],title:"Invoice"});return}}let f=document.createElement("a");f.href=t.toDataURL(),f.download=r,f.click()})}catch{alert("L\u1ED7i khi t\u1EA1o h\xF3a \u0111\u01A1n")}finally{M(!1)}}},i="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",h="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return p("div",{className:"space-y-6",children:[p("div",{className:"flex justify-between items-center",children:[p("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[n(Ge,{size:18,className:"text-blue-500"})," ",m?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),m&&S&&n("button",{onClick:y,disabled:b,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:n(fe,{size:20})})]}),p("div",{className:"space-y-3",children:[p("div",{className:"relative",children:[n(Ke,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:i,value:e.phone,onChange:t=>{C("phone",t.target.value),B(!0)},onFocus:()=>B(!0),onBlur:()=>setTimeout(()=>B(!1),200)}),V&&a.length>0&&p("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-100 shadow-2xl z-[100] max-h-48 overflow-auto rounded-2xl mt-1 animate-in fade-in zoom-in duration-200",children:[n("div",{className:"p-2 border-b border-slate-50 bg-slate-50/50",children:n("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest",children:"Kh\xE1ch h\xE0ng c\u0169"})}),a.map((t,r)=>p("div",{onMouseDown:()=>Q(t),className:"p-3 hover:bg-blue-50 border-b last:border-0 cursor-pointer transition-colors",children:[p("div",{className:"flex justify-between items-center",children:[n("span",{className:"font-black text-blue-600 text-xs",children:t.phone}),n("span",{className:"font-bold text-slate-700 text-xs",children:t.name})]}),n("p",{className:"text-[10px] text-slate-400 truncate mt-0.5",children:t.address||"Kh\xF4ng c\xF3 \u0111\u1ECBa ch\u1EC9"})]},r))]})]}),p("div",{className:"relative",children:[n(qe,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:i,value:e.customerName,onChange:t=>C("customerName",t.target.value)})]}),p("div",{className:"relative",children:[n(Ve,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:i,value:e.address,onChange:t=>C("address",t.target.value)})]}),p("div",{className:"relative",children:[n(We,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),n("textarea",{placeholder:"Y\xEAu c\u1EA7u d\u1ECBch v\u1EE5...",className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl min-h-[80px] focus:bg-white focus:border-blue-400 outline-none",value:e.content,onChange:t=>C("content",t.target.value)})]}),p("div",{className:"grid grid-cols-2 gap-3",children:[n("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:e.status,onChange:t=>C("status",t.target.value),children:ee.map(t=>n("option",{value:t,children:t},t))}),p("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:e.technician,onChange:t=>C("technician",t.target.value),disabled:!S,children:[n("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),c.map(t=>n("option",{value:t,children:t},t))]})]}),p("div",{className:"pt-2",children:[p("div",{className:"flex justify-between items-center mb-2 px-1",children:[n("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"D\u1ECBch v\u1EE5 & Linh ki\u1EC7n"}),n("button",{onClick:()=>o(t=>({...t,workItems:[...t.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:n($e,{size:18})})]}),n("div",{className:"space-y-2",children:e.workItems.map((t,r)=>p("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 relative group hover:border-blue-100 transition-all",children:[n("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200",value:t.desc,onFocus:()=>D(r),onChange:l=>v(r,"desc",l.target.value),onBlur:()=>setTimeout(()=>D(null),200)}),K===r&&w.length>0&&n("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-100 shadow-2xl z-50 max-h-40 overflow-auto rounded-xl mt-1",children:w.filter(l=>l.name.toLowerCase().includes(t.desc.toLowerCase())).map((l,f)=>p("div",{onMouseDown:()=>{v(r,"desc",l.name),v(r,"price",l.price)},className:"p-2.5 hover:bg-slate-50 text-xs flex justify-between border-b last:border-0 font-medium cursor-pointer",children:[n("span",{children:l.name}),n("span",{className:"font-bold text-blue-500",children:P(l.price)})]},f))}),p("div",{className:"flex gap-2 text-[11px] font-bold",children:[p("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg px-2 flex items-center gap-1",children:["SL: ",n("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:t.qty,onChange:l=>v(r,"qty",l.target.value)})]}),n("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:n("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:P(t.price),onChange:l=>v(r,"price",l.target.value)})}),n("button",{onClick:()=>o(l=>({...l,workItems:l.workItems.filter((f,H)=>H!==r)})),className:"text-slate-300 hover:text-red-400 transition-colors p-1",children:n(fe,{size:16})})]})]},r))})]}),p("div",{className:"pt-4 space-y-2 bg-slate-100/40 p-3 rounded-[24px] border border-slate-100",children:[n("div",{className:"flex items-center gap-2 px-1 mb-1",children:n("span",{className:"font-black text-slate-400 text-[9px] uppercase tracking-[0.2em]",children:"Th\xF4ng tin t\xE0i ch\xEDnh"})}),p("div",{className:"grid grid-cols-3 gap-2",children:[p("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[8px] font-black text-blue-500 uppercase tracking-tighter",children:"T\u1ED5ng thu"}),n("input",{type:"text",className:`${h} text-blue-600 bg-slate-50`,value:P(e.revenue),readOnly:!0})]}),p("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[8px] font-black text-orange-500 uppercase tracking-tighter",children:"V\u1ED1n"}),n("input",{type:"text",className:`${h} text-orange-600`,value:P(e.cost),onChange:t=>C("cost",ae(t.target.value))})]}),p("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[8px] font-black text-red-500 uppercase tracking-tighter",children:"C\xF4ng n\u1EE3"}),n("input",{type:"text",className:`${h} text-red-600`,value:P(e.debt),onChange:t=>C("debt",ae(t.target.value))})]})]})]})]}),n("div",{className:"grid grid-cols-2 gap-3 pt-2",children:m?p(Ze,{children:[n("button",{disabled:b,onClick:I,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),n("button",{onClick:F,className:"bg-slate-100 text-slate-600 font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):n("button",{disabled:b,onClick:k,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg uppercase tracking-wider text-[12px] active:scale-95 transition-all",children:b?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),m&&p("button",{onClick:()=>G(!0),className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 rounded-xl uppercase shadow-md flex items-center justify-center gap-2 text-[12px] transition-all",children:[n(Be,{size:18})," XEM H\xD3A \u0110\u01A0N"]}),O&&n("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-[999999] flex items-center justify-center p-4",children:p("div",{className:"bg-white rounded-[40px] p-2 max-w-[360px] w-full max-h-[95vh] flex flex-col shadow-2xl relative animate-in fade-in zoom-in duration-300",children:[n("button",{onClick:()=>G(!1),className:"absolute top-4 right-4 p-2.5 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-600 z-[1000001] transition-colors",children:n(Je,{size:20})}),n("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar bg-slate-100/30 flex justify-center rounded-t-[38px]",children:n("div",{ref:R,className:"bg-white shadow-xl h-fit",children:n(xe,{formData:e,bankInfo:W})})}),p("div",{className:"p-4 bg-white grid grid-cols-2 gap-3 rounded-b-[40px] border-t border-slate-50",children:[n("button",{onClick:s,disabled:E,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] flex items-center justify-center gap-2 active:scale-95 transition-all shadow-lg",children:E?"\u0110ANG T\u1EA0O...":"L\u01AFU / CHIA S\u1EBA"}),n("button",{onClick:()=>window.print(),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] active:scale-95 transition-all shadow-lg",children:"IN H\xD3A \u0110\u01A0N"}),n("button",{onClick:()=>G(!1),className:"col-span-2 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-3.5 rounded-2xl uppercase text-[11px] transition-all",children:"\u0110\xD3NG"})]})]})})]})};import{useState as Qe}from"react";import{X as et,Save as tt,CreditCard as at,RefreshCw as st,Loader2 as nt}from"lucide-react";import{jsx as _,jsxs as X}from"react/jsx-runtime";var Ne=({config:e,onSave:o,onClose:c,isAdmin:N,onCheckUpdate:m,isCheckingUpdate:b})=>{let[g,k]=Qe({...e});return _("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:X("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[X("div",{className:"flex justify-between items-center",children:[_("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),_("button",{onClick:c,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:_(et,{size:20})})]}),X("div",{className:"space-y-4",children:[X("div",{className:"space-y-3",children:[X("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[_(at,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),X("div",{className:"grid grid-cols-2 gap-3",children:[_("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.bankId,onChange:I=>k(y=>({...y,bankInfo:{...y.bankInfo,bankId:I.target.value}}))}),_("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountNo,onChange:I=>k(y=>({...y,bankInfo:{...y.bankInfo,accountNo:I.target.value}}))}),_("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountName,onChange:I=>k(y=>({...y,bankInfo:{...y.bankInfo,accountName:I.target.value.toUpperCase()}}))})]})]}),m&&_("div",{className:"pt-2",children:X("button",{onClick:m,disabled:b,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[b?_(nt,{size:14,className:"animate-spin"}):_(st,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),X("div",{className:"flex gap-3",children:[X("button",{onClick:()=>o(g),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[_(tt,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),_("button",{onClick:c,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};async function $(e,o,c={},N=0){if(!e||!e.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let g=new AbortController,k=setTimeout(()=>g.abort(),2e4),I=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...c,action:o}),signal:g.signal});if(clearTimeout(k),!I.ok)throw new Error(`HTTP ${I.status}`);let y=await I.text();if(!y)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let F=y.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(F?F[0]:y)}catch(g){if(N<1&&(g.name==="AbortError"||g.message.includes("HTTP")))return $(e,o,c,N+1);throw g}}import{jsx as T,jsxs as Z}from"react/jsx-runtime";var it=()=>{let[e,o]=U(()=>{let s=localStorage.getItem("diti_user");return s?JSON.parse(s):null}),[c,N]=U(()=>{let s=localStorage.getItem("diti_config");return{...s?JSON.parse(s):he,sheetUrl:oe}}),[m,b]=U(()=>{let s=localStorage.getItem("diti_services_cache");return s?JSON.parse(s):[]}),[g,k]=U([]),[I,y]=U([]),[F,z]=U(!1),[W,S]=U(!1),[K,D]=U(!1),[V,B]=U(!1),[O,G]=U(null),[E,M]=U({dateFrom:re(),dateTo:re(),searchTerm:"",searchTech:"",viewAll:!1}),[R,q]=U({customerName:"",phone:"",address:"",status:ee[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0});we(()=>{let s=document.getElementById("splash");s&&setTimeout(()=>{s.style.opacity="0",setTimeout(()=>s.remove(),600)},500)},[]);let a=ye(async()=>{if(e){z(m.length===0);try{let[s,i,h]=await Promise.all([$(c.sheetUrl,"read"),$(c.sheetUrl,"read_settings"),$(c.sheetUrl,"read_pricelist")]);if(Array.isArray(s)){let t=s.map(r=>({...r,customerName:r.customer_name||r.customerName||"",workItems:typeof r.work_items=="string"?JSON.parse(r.work_items):r.work_items||[],revenue:Number(r.revenue||0),cost:Number(r.cost||0),debt:Number(r.debt||0),created_at:r.created_at||r.date||new Date().toISOString()}));b(t),localStorage.setItem("diti_services_cache",JSON.stringify(t))}if(i?.technicians){let t=typeof i.technicians=="string"?JSON.parse(i.technicians):i.technicians;k(Array.isArray(t)?t:[])}Array.isArray(h)&&y(h)}catch(s){console.error("Fetch Error:",s)}finally{z(!1)}}},[e,c.sheetUrl,m.length]);we(()=>{e&&a()},[e,a]);let w=rt(()=>{let s=[...m];if(e?.role!=="admin"&&e?.associatedTech&&(s=s.filter(i=>i.technician===e.associatedTech)),E.viewAll||(s=s.filter(i=>{let h=(i.created_at||"").split("T")[0];return h>=E.dateFrom&&h<=E.dateTo})),E.searchTech&&(s=s.filter(i=>i.technician===E.searchTech)),E.searchTerm){let i=E.searchTerm.toLowerCase();s=s.filter(h=>(h.customerName||"").toLowerCase().includes(i)||(h.phone||"").includes(i)||(h.address||"").toLowerCase().includes(i))}return s.sort((i,h)=>new Date(h.created_at).getTime()-new Date(i.created_at).getTime())},[m,E,e]),C=async(s,i)=>{z(!0);try{let h=await $(c.sheetUrl,"login",{username:s,password:i});h?.status==="success"&&h.user?(o(h.user),localStorage.setItem("diti_user",JSON.stringify(h.user))):alert(h?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{z(!1)}},Q=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(o(null),localStorage.clear(),window.location.reload())},v=ye(()=>{G(null),q({customerName:"",phone:"",address:"",status:ee[0],technician:e?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[e]);return e?Z("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[T("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:Z("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[Z("div",{className:"flex items-center gap-3",children:[T(j,{size:32}),Z("div",{children:[T("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),T("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:e.name})]})]}),Z("div",{className:"flex gap-2",children:[T("button",{onClick:()=>D(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:T(ot,{size:18})}),T("button",{onClick:Q,className:"p-2 text-red-400",children:T(lt,{size:18})})]})]})}),T("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:Z("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[T("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:T("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:T(ve,{formData:R,setFormData:q,technicians:g,priceList:I,selectedId:O,isSubmitting:W,currentUser:e,services:m,bankInfo:c.bankInfo,onClear:v,onSave:async()=>{S(!0);try{(await $(c.sheetUrl,"create",{...R,customer_name:R.customerName,work_items:R.workItems,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await a(),v(),alert("L\u01B0u phi\u1EBFu th\xE0nh c\xF4ng"))}catch{alert("L\u1ED7i khi l\u01B0u phi\u1EBFu")}finally{S(!1)}},onUpdate:async()=>{if(O){S(!0);try{await $(c.sheetUrl,"update",{...R,customer_name:R.customerName,work_items:R.workItems,id:O,created_at:m.find(s=>s.id===O)?.created_at}),await a(),v(),alert("C\u1EADp nh\u1EADt phi\u1EBFu th\xE0nh c\xF4ng")}catch{alert("L\u1ED7i khi c\u1EADp nh\u1EADt phi\u1EBFu")}finally{S(!1)}}},onDelete:async()=>{if(!(!O||!confirm("X\xF3a?"))){S(!0);try{await $(c.sheetUrl,"delete",{id:O,role:e.role}),await a(),v()}catch{alert("L\u1ED7i khi x\xF3a phi\u1EBFu")}finally{S(!1)}}}})})}),T("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:T(ge,{data:w,loading:F,technicians:g,selectedId:O,onSelectRow:s=>{G(s.id),q({...s}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:E,setFilters:{setDateFrom:s=>M(i=>({...i,dateFrom:s,viewAll:!1})),setDateTo:s=>M(i=>({...i,dateTo:s,viewAll:!1})),setSearchTerm:s=>M(i=>({...i,searchTerm:s})),setSearchTech:s=>M(i=>({...i,searchTech:s})),setViewAll:s=>M(i=>({...i,viewAll:s}))},currentUser:e})})]})}),K&&T(Ne,{config:c,isAdmin:e.role==="admin",onClose:()=>D(!1),onSave:s=>{N(s),localStorage.setItem("diti_config",JSON.stringify(s)),D(!1)}})]}):T(de,{onLogin:C,isLoading:F})},ke=it;import{jsx as Ce}from"react/jsx-runtime";var Se=document.getElementById("root");Se&&dt(Se).render(Ce(ct.StrictMode,{children:Ce(ke,{})}));
