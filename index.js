import kt from"react";import{createRoot as St}from"react-dom/client";import{useState as O,useEffect as _e,useCallback as Ee,useMemo as vt}from"react";import{Settings as Nt,LogOut as wt}from"lucide-react";import{useState as ge}from"react";import{User as Xe,Lock as qe}from"lucide-react";import{jsx as $e}from"react/jsx-runtime";var X=({className:e="",size:o=64})=>$e("img",{src:"public/logo.png",alt:"Logo",width:o,height:o,className:`${e} object-contain`,loading:"eager",onError:i=>{let w=i.target;w.src.indexOf("public/")!==-1&&(w.src="logo.png")}});import{jsx as _,jsxs as Z}from"react/jsx-runtime";var xe=({onLogin:e,isLoading:o})=>{let[i,w]=ge(""),[m,x]=ge("");return _("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:Z("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[o&&_("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:Z("div",{className:"relative flex flex-col items-center",children:[_(X,{size:80,className:"animate-pulse"}),_("div",{className:"mt-8 text-center",children:_("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),Z("div",{className:"flex flex-col items-center text-center space-y-3",children:[_(X,{size:64,className:o?"animate-pulse":""}),Z("div",{children:[_("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),_("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),Z("form",{onSubmit:y=>{y.preventDefault(),i&&m&&e(i,m)},className:"space-y-4",children:[Z("div",{className:"relative",children:[_(Xe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),_("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:i,onChange:y=>w(y.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),Z("div",{className:"relative",children:[_(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),_("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:m,onChange:y=>x(y.target.value),required:!0,autoComplete:"current-password"})]}),_("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),_("div",{className:"pt-4 text-center border-t border-slate-50",children:_("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as Ne,useMemo as Be,useRef as de}from"react";import{Search as we,ChevronRight as Ge,Calendar as Ke,Filter as Ve,CheckCircle2 as Je,Phone as Ye,MapPin as We,Download as Ze,Smartphone as Qe}from"lucide-react";import*as se from"xlsx";var me=()=>new Date().toISOString().split("T")[0];var E=e=>{let o=typeof e=="number"?e:parseInt(String(e).replace(/\D/g,""),10);return isNaN(o)?"0":o.toLocaleString("vi-VN")},ce=e=>{if(typeof e=="number")return e;let o=parseInt(e.replace(/\D/g,""),10);return isNaN(o)?0:o},fe=e=>e.reduce((o,i)=>o+(i.total||0),0);function ve(e,o){let i;return(...w)=>{clearTimeout(i),i=setTimeout(()=>e(...w),o)}}import{Fragment as et,jsx as d,jsxs as u}from"react/jsx-runtime";var ye=({data:e,loading:o,technicians:i,selectedId:w,onSelectRow:m,filters:x,setFilters:f,currentUser:y,onInstallApp:S,installAvailable:N})=>{let G=y?.role==="admin",[H,oe]=Ne(x.searchTerm),[D,ee]=Ne(null),C=de(null),te=de(!1),J=de({x:0,y:0}),P=de(!1),Y=Be(()=>ve(n=>f.setSearchTerm(n),300),[f]),K=n=>{oe(n.target.value),Y(n.target.value)},V=()=>{if(e.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let n=e.map(z=>{let T=Number(z.revenue||0),s=Number(z.cost||0),r=T-s,v=Number(z.debt||0);return{"Ng\xE0y nh\u1EADp":(z.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":z.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":z.phone,"\u0110\u1ECBa ch\u1EC9":z.address,"K\u1EF9 thu\u1EADt vi\xEAn":z.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":z.content,"Doanh thu (\u0111)":T,"Gi\xE1 v\u1ED1n (\u0111)":s,"L\u1EE3i nhu\u1EADn (\u0111)":r,"C\xF4ng n\u1EE3 (\u0111)":v,"Tr\u1EA1ng th\xE1i":z.status}}),h=se.utils.json_to_sheet(n),U=se.utils.book_new();se.utils.book_append_sheet(U,h,"BaoCaoDichVu");let ae=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;se.writeFile(U,ae)},k=n=>{let h=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${n.customerName}
\u{1F4DE} S\u0110T: ${n.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${n.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${n.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${n.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(h).then(()=>{ee("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>ee(null),2e3)}).catch(U=>{console.error("L\u1ED7i copy:",U)})},F=(n,h)=>{te.current=!1,P.current=!1,J.current={x:n.clientX,y:n.clientY},C.current=setTimeout(()=>{P.current||(te.current=!0,k(h))},600)},A=n=>{let h=Math.abs(n.clientX-J.current.x),U=Math.abs(n.clientY-J.current.y);(h>10||U>10)&&(P.current=!0,C.current&&(clearTimeout(C.current),C.current=null))},W=(n,h)=>{C.current&&(clearTimeout(C.current),C.current=null),!te.current&&!P.current&&m(h)};return u("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[D&&u("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[d(Je,{size:16,className:"text-green-400"}),d("span",{className:"font-black text-[11px] uppercase tracking-widest",children:D})]}),u("div",{className:"space-y-3 mb-5 shrink-0",children:[u("div",{className:"relative group",children:[d(we,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),d("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:H,onChange:K})]}),u("div",{className:"flex flex-wrap items-center gap-2",children:[u("button",{onClick:()=>f.setViewAll(!x.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${x.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[d(Ve,{size:14})," ",x.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!x.viewAll&&u("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[d(Ke,{size:12,className:"text-slate-400"}),d("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:x.dateFrom,onChange:n=>f.setDateFrom(n.target.value)}),d("span",{className:"text-slate-300",children:"/"}),d("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:x.dateTo,onChange:n=>f.setDateTo(n.target.value)})]}),u("div",{className:"flex items-center gap-2 ml-auto",children:[S&&u("button",{onClick:S,className:`h-[34px] px-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider ${N?"bg-slate-800 text-white hover:bg-black":"bg-slate-100 text-slate-500"}`,children:[d(Qe,{size:14})," ",N?"C\xC0I \u0110\u1EB6T APP":"T\u1EA2I APP"]}),u("button",{onClick:V,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider",children:[d(Ze,{size:14})," EXCEL"]})]})]})]}),d("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:o?u("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[d(X,{size:48,className:"animate-pulse"}),d("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):e.length===0?u("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[d(we,{size:48,strokeWidth:1,className:"opacity-40"}),d("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):e.map(n=>u("div",{onPointerDown:h=>F(h,n),onPointerMove:A,onPointerUp:h=>W(h,n),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${w===n.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[u("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[u("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[d("span",{children:(n.created_at||"").split("T")[0]?.split("-")[2]||"--"}),u("span",{className:"opacity-60 text-[10px]",children:["T",(n.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),u("div",{className:"min-w-0 flex-1",children:[d("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:n.customerName}),d("div",{className:"flex flex-col gap-0.5 mb-1.5",children:u("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[d(Ye,{size:10,className:"text-blue-400"}),d("span",{children:n.phone}),n.address&&u(et,{children:[d("span",{className:"text-slate-200",children:"|"}),d(We,{size:10,className:"text-red-400"}),d("span",{className:"truncate max-w-[120px]",children:n.address})]})]})}),u("div",{className:"flex items-center gap-2",children:[d("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:n.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),d("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${n.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":n.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:n.status})]})]})]}),u("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[u("div",{className:"text-right",children:[u("div",{className:"font-black text-slate-800 text-[14px]",children:[E(n.revenue),"\u0111"]}),Number(n.debt)>0&&u("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",E(n.debt)]})]}),d(Ge,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),w===n.id&&d("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},n.id))}),u("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[u("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[x.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",d("span",{className:"text-slate-700 ml-1 font-black",children:e.length})]}),u("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",E(e.reduce((n,h)=>n+Number(h.revenue||0),0)),"\u0111"]})]})]})};import{useState as Q,useRef as tt,useMemo as Ce}from"react";import{Plus as at,Trash2 as Te,Activity as st,User as nt,Phone as ot,MapPin as Ie,ReceiptText as rt,X as Le,Share2 as Pe,MessageSquare as lt,Download as it,CheckCircle2 as ct,Copy as dt}from"lucide-react";import pt from"html2canvas";var be="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",ke={sheetUrl:be,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},re=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{jsx as p,jsxs as I}from"react/jsx-runtime";var Se=({formData:e,bankInfo:o})=>{let i=fe(e.workItems),w=o?`https://img.vietqr.io/image/${o.bankId}-${o.accountNo}-compact2.png?amount=${i}&addInfo=DITICOMS SERVICE ${e.customerName.toUpperCase()}&accountName=${encodeURIComponent(o.accountName)}`:"";return I("div",{className:"w-[302px] bg-white p-6 mx-auto font-sans block",style:{height:"auto",minHeight:"fit-content"},children:[I("div",{className:"flex flex-col items-center text-center space-y-1 mb-5",children:[p(X,{size:52}),p("h1",{className:"text-xl font-black uppercase text-blue-600 tracking-tight",children:"DITICOMS SERVICE"}),p("p",{className:"text-[10px] text-slate-800 font-black uppercase tracking-widest",children:"Hotline: 0935.71.5151"}),p("div",{className:"w-12 h-0.5 bg-blue-600 rounded-full mt-1.5"})]}),I("div",{className:"space-y-1.5 mb-5 text-[11px]",children:[I("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[p("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"Kh\xE1ch h\xE0ng:"}),p("span",{className:"font-bold text-slate-900 text-right",children:e.customerName})]}),I("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[p("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"\u0110i\u1EC7n tho\u1EA1i:"}),p("span",{className:"font-bold text-slate-900 text-right",children:e.phone})]}),e.address&&I("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[p("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"\u0110\u1ECBa ch\u1EC9:"}),p("span",{className:"font-bold text-slate-900 text-right truncate max-w-[180px]",children:e.address})]}),I("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[p("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Ng\xE0y t\u1EA1o:"}),p("span",{className:"font-bold text-slate-900",children:new Date().toLocaleDateString("vi-VN")})]})]}),I("div",{className:"space-y-3 mb-6",children:[p("div",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest border-l-2 border-blue-500 pl-2",children:"Chi ti\u1EBFt d\u1ECBch v\u1EE5"}),I("table",{className:"w-full text-[10px] border-collapse",children:[p("thead",{children:I("tr",{className:"text-[8px] text-slate-400 uppercase border-b border-slate-100",children:[p("th",{className:"pb-2 text-left font-black",children:"N\u1ED9i dung"}),p("th",{className:"pb-2 text-center font-black px-1",children:"SL"}),p("th",{className:"pb-2 text-right font-black px-1",children:"\u0110\u01A1n gi\xE1"}),p("th",{className:"pb-2 text-right font-black",children:"T.Ti\u1EC1n"})]})}),p("tbody",{className:"divide-y divide-slate-50",children:e.workItems.map((m,x)=>I("tr",{className:"align-middle",children:[p("td",{className:"py-2.5 text-slate-800 font-bold leading-tight pr-1",children:m.desc}),p("td",{className:"py-2.5 text-center text-slate-600 font-black px-1",children:m.qty}),p("td",{className:"py-2.5 text-right text-slate-600 font-medium whitespace-nowrap px-1",children:E(m.price)}),p("td",{className:"py-2.5 text-right font-black text-slate-900 whitespace-nowrap",children:E(m.total)})]},x))})]})]}),I("div",{className:"bg-slate-50 p-4 rounded-2xl flex justify-between items-center mb-6",children:[p("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-wider",children:"T\u1ED5ng c\u1ED9ng:"}),I("span",{className:"text-lg font-black text-blue-600",children:[E(e.revenue),"\u0111"]})]}),o&&e.status!=="Ho\xE0n th\xE0nh"&&I("div",{className:"flex flex-col items-center space-y-3 pt-4 border-t border-dashed border-slate-200",children:[p("div",{className:"bg-white p-2 rounded-xl border-2 border-slate-100 shadow-sm",children:p("img",{src:w,alt:"QR",className:"w-36 h-36 aspect-square object-contain"})}),I("div",{className:"text-center",children:[I("p",{className:"text-[10px] font-black text-slate-800 uppercase tracking-tighter",children:[o.bankId," \u2022 ",o.accountNo]}),p("p",{className:"text-[8px] font-bold text-slate-400 uppercase mt-0.5",children:o.accountName})]})]}),p("div",{className:"text-center pt-6 border-t border-slate-50 mt-6",children:p("p",{className:"text-[9px] font-bold text-slate-400 uppercase italic tracking-widest",children:"Tr\xE2n tr\u1ECDng c\u1EA3m \u01A1n!"})})]})};import{Fragment as ut,jsx as t,jsxs as l}from"react/jsx-runtime";var Ae=({formData:e,setFormData:o,technicians:i,priceList:w,selectedId:m,isSubmitting:x,currentUser:f,onSave:y,onUpdate:S,onDelete:N,onClear:G,services:H,bankInfo:oe})=>{let D=f?.role==="admin",[ee,C]=Q(!1),[te,J]=Q(!1),[P,Y]=Q(!1),[K,V]=Q(!1),[k,F]=Q(null),[A,W]=Q(null),[n,h]=Q(null),U=tt(null),ae=Ce(()=>{let a={};return[...H].sort((b,g)=>new Date(g.created_at).getTime()-new Date(b.created_at).getTime()).forEach(b=>{let g=String(b.phone||"").trim();g.length>=3&&(a[g]||(a[g]={name:b.customerName||"",address:b.address||""}))}),Object.entries(a).map(([b,g])=>({phone:b,...g}))},[H]),z=Ce(()=>{let a=e.phone.trim();return a.length<3?[]:ae.filter(c=>c.phone.includes(a)).slice(0,5)},[ae,e.phone]),T=(a,c)=>{o(b=>{let g={...b,[a]:c};return a==="status"&&(c==="Ho\xE0n th\xE0nh"?g.debt=0:g.debt=g.revenue),g})},s=a=>{o(c=>({...c,phone:a.phone,customerName:a.name,address:a.address})),C(!1)},r=(a,c,b)=>{o(g=>{let $=[...g.workItems],ie={...$[a],[c]:b},De=ce(c==="price"?b:ie.price),He=Number(c==="qty"?b:ie.qty);ie.total=De*He,$[a]=ie;let he=$.reduce((Fe,je)=>Fe+(Number(je.total)||0),0);return{...g,workItems:$,revenue:he,debt:g.status==="Ho\xE0n th\xE0nh"?0:he}})},v=async()=>{if(U.current){Y(!0);try{let a=U.current.getElementsByTagName("img");await Promise.all(Array.from(a).map(g=>g.complete?Promise.resolve():new Promise($=>{g.onload=$,g.onerror=$})));let c=await pt(U.current,{scale:2.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1}),b=c.toDataURL("image/png",.9);W(b),c.toBlob(g=>{g&&(F(g),V(!0))},"image/png",.9)}catch(a){console.error(a),alert("Kh\xF4ng th\u1EC3 ch\u1EE5p h\xF3a \u0111\u01A1n. Vui l\xF2ng th\u1EED l\u1EA1i ho\u1EB7c ch\u1EE5p m\xE0n h\xECnh th\u1EE7 c\xF4ng.")}finally{Y(!1)}}},j=()=>{if(!A)return;let a=`Bill_${(e.customerName||"Khach").toUpperCase().replace(/\s+/g,"_")}.png`;try{let c=document.createElement("a");c.href=A,c.download=a,document.body.appendChild(c),c.click(),document.body.removeChild(c),le("\u0110\xE3 b\u1EAFt \u0111\u1EA7u t\u1EA3i xu\u1ED1ng")}catch{window.open(A,"_blank"),le("M\u1EDF \u1EA3nh trong tab m\u1EDBi")}},R=async()=>{if(k)try{let a=[new ClipboardItem({[k.type]:k})];await navigator.clipboard.write(a),le("\u0110\xE3 ch\xE9p \u1EA3nh v\xE0o b\u1ED9 nh\u1EDB")}catch{le("L\u1ED7i copy: Nh\u1EA5n gi\u1EEF \u1EA3nh \u0111\u1EC3 l\u01B0u")}},Oe=async()=>{if(!k)return;let a=`Bill_${(e.customerName||"Khach").toUpperCase().replace(/\s+/g,"_")}.png`,c=new File([k],a,{type:"image/png"});try{navigator.share&&navigator.canShare&&navigator.canShare({files:[c]})?await navigator.share({files:[c],title:"H\xF3a \u0111\u01A1n Diticoms",text:`G\u1EEDi h\xF3a \u0111\u01A1n kh\xE1ch h\xE0ng: ${e.customerName}`}):navigator.share?await navigator.share({title:"Diticoms Service",text:`H\xF3a \u0111\u01A1n: ${e.customerName}
T\u1ED5ng: ${E(e.revenue)}\u0111`,url:window.location.href}):j()}catch(b){console.error("Share error",b),j()}},le=a=>{h(a),setTimeout(()=>h(null),2500)},pe="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",ue="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return l("div",{className:"space-y-6",children:[n&&t("div",{className:"fixed top-24 left-1/2 -translate-x-1/2 z-[10001] bg-blue-600 text-white px-5 py-2.5 rounded-full text-[11px] font-black uppercase tracking-widest shadow-2xl animate-in fade-in zoom-in",children:n}),l("div",{className:"flex justify-between items-center",children:[l("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[t(st,{size:18,className:"text-blue-500"})," ",m?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),m&&D&&t("button",{onClick:N,disabled:x,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:t(Te,{size:20})})]}),l("div",{className:"space-y-3",children:[l("div",{className:"relative",children:[t(ot,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),t("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:pe,value:e.phone,onChange:a=>{T("phone",a.target.value),C(!0)},onFocus:()=>C(!0),onBlur:()=>setTimeout(()=>C(!1),200)}),ee&&z.length>0&&l("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-200 shadow-2xl z-[60] max-h-56 overflow-auto rounded-2xl mt-1 animate-in fade-in zoom-in duration-150",children:[t("div",{className:"p-2 border-b border-slate-50 bg-slate-50/50",children:t("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest px-1",children:"G\u1EE3i \xFD t\u1EEB l\u1ECBch s\u1EED"})}),z.map((a,c)=>l("div",{onMouseDown:()=>s(a),className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 transition-colors flex flex-col",children:[l("div",{className:"flex justify-between items-center mb-0.5",children:[t("span",{className:"font-black text-blue-600 text-xs",children:a.phone}),t("span",{className:"font-bold text-slate-800 text-xs",children:a.name})]}),l("div",{className:"flex items-center gap-1 text-slate-400 text-[10px]",children:[t(Ie,{size:10}),t("span",{className:"truncate",children:a.address||"Kh\xF4ng c\xF3 \u0111\u1ECBa ch\u1EC9"})]})]},c))]})]}),l("div",{className:"relative",children:[t(nt,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),t("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:pe,value:e.customerName,onChange:a=>T("customerName",a.target.value)})]}),l("div",{className:"relative",children:[t(Ie,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),t("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:pe,value:e.address,onChange:a=>T("address",a.target.value)})]}),l("div",{className:"relative",children:[t(lt,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),t("textarea",{placeholder:"Y\xEAu c\u1EA7u d\u1ECBch v\u1EE5...",className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl min-h-[80px] focus:bg-white focus:border-blue-400 outline-none",value:e.content,onChange:a=>T("content",a.target.value)})]}),l("div",{className:"grid grid-cols-2 gap-3",children:[t("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:e.status,onChange:a=>T("status",a.target.value),children:re.map(a=>t("option",{value:a,children:a},a))}),l("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:e.technician,onChange:a=>T("technician",a.target.value),disabled:!D,children:[t("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),i.map(a=>t("option",{value:a,children:a},a))]})]}),l("div",{className:"pt-2",children:[l("div",{className:"flex justify-between items-center mb-2 px-1",children:[t("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"D\u1ECBch v\u1EE5 & Linh ki\u1EC7n"}),t("button",{onClick:()=>o(a=>({...a,workItems:[...a.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:t(at,{size:18})})]}),t("div",{className:"space-y-2",children:e.workItems.map((a,c)=>l("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 relative group hover:border-blue-100 transition-all",children:[t("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200",value:a.desc,onChange:b=>r(c,"desc",b.target.value)}),l("div",{className:"flex gap-2 text-[11px] font-bold",children:[l("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg px-2 flex items-center gap-1",children:["SL: ",t("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:a.qty,onChange:b=>r(c,"qty",b.target.value)})]}),t("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:t("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:E(a.price),onChange:b=>r(c,"price",b.target.value)})}),t("button",{onClick:()=>o(b=>({...b,workItems:b.workItems.filter((g,$)=>$!==c)})),className:"text-slate-300 hover:text-red-400 transition-colors p-1",children:t(Te,{size:16})})]})]},c))})]}),l("div",{className:"pt-4 space-y-2 bg-slate-100/40 p-3 rounded-[24px] border border-slate-100",children:[t("div",{className:"flex items-center gap-2 px-1 mb-1",children:t("span",{className:"font-black text-slate-400 text-[9px] uppercase tracking-[0.2em]",children:"Th\xF4ng tin t\xE0i ch\xEDnh"})}),l("div",{className:"grid grid-cols-3 gap-2",children:[l("div",{className:"flex flex-col gap-1 text-center",children:[t("span",{className:"text-[8px] font-black text-blue-500 uppercase tracking-tighter",children:"T\u1ED5ng thu"}),t("input",{type:"text",className:`${ue} text-blue-600 bg-slate-50`,value:E(e.revenue),readOnly:!0})]}),l("div",{className:"flex flex-col gap-1 text-center",children:[t("span",{className:"text-[8px] font-black text-orange-500 uppercase tracking-tighter",children:"V\u1ED1n"}),t("input",{type:"text",className:`${ue} text-orange-600`,value:E(e.cost),onChange:a=>T("cost",ce(a.target.value))})]}),l("div",{className:"flex flex-col gap-1 text-center",children:[t("span",{className:"text-[8px] font-black text-red-500 uppercase tracking-tighter",children:"C\xF4ng n\u1EE3"}),t("input",{type:"text",className:`${ue} text-red-600`,value:E(e.debt),onChange:a=>T("debt",ce(a.target.value))})]})]})]})]}),t("div",{className:"grid grid-cols-2 gap-3 pt-2",children:m?l(ut,{children:[t("button",{disabled:x,onClick:S,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),t("button",{onClick:G,className:"bg-slate-100 text-slate-600 font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):t("button",{disabled:x,onClick:y,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg uppercase tracking-wider text-[12px] active:scale-95 transition-all",children:x?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),m&&l("button",{onClick:()=>J(!0),className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 rounded-xl uppercase shadow-md flex items-center justify-center gap-2 text-[12px] transition-all",children:[t(rt,{size:18})," XEM H\xD3A \u0110\u01A0N"]}),te&&t("div",{className:"fixed inset-0 bg-black/90 z-[9999] flex items-center justify-center p-4 safe-area-padding",children:l("div",{className:"bg-white rounded-[40px] p-2 max-w-[360px] w-full max-h-[95vh] flex flex-col shadow-2xl relative animate-in fade-in zoom-in duration-300",children:[t("button",{onClick:()=>J(!1),className:"absolute top-4 right-4 p-2.5 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-600 z-[10001] transition-colors",children:t(Le,{size:20})}),t("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar bg-slate-100/30 flex justify-center rounded-t-[38px]",children:t("div",{ref:U,className:"bg-white shadow-xl h-fit",children:t(Se,{formData:e,bankInfo:oe})})}),l("div",{className:"p-4 bg-white grid grid-cols-2 gap-3 rounded-b-[40px] border-t border-slate-50",children:[t("button",{onClick:v,disabled:P,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] flex items-center justify-center gap-2 active:scale-95 transition-all shadow-lg",children:P?"\u0110ANG X\u1EEC L\xDD...":"L\u01AFU / CHIA S\u1EBA"}),t("button",{onClick:()=>window.print(),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] active:scale-95 transition-all shadow-lg",children:"IN H\xD3A \u0110\u01A0N"})]})]})}),K&&t("div",{className:"fixed inset-0 bg-black/80 z-[10000] flex items-end justify-center",children:l("div",{className:"bg-white w-full max-w-md rounded-t-[40px] p-6 space-y-5 animate-in slide-in-from-bottom duration-300 max-h-[90vh] overflow-y-auto",children:[l("div",{className:"flex justify-between items-center mb-1",children:[l("h3",{className:"font-black text-slate-800 uppercase tracking-tight text-xs flex items-center gap-2",children:[t(Pe,{size:16,className:"text-blue-500"})," T\xD9Y CH\u1ECCN H\xD3A \u0110\u01A0N"]}),t("button",{onClick:()=>V(!1),className:"p-2 bg-slate-100 rounded-full text-slate-400",children:t(Le,{size:18})})]}),l("div",{className:"bg-slate-50 p-2 rounded-3xl border border-slate-100 relative group overflow-hidden",children:[A&&t("img",{src:A,alt:"Preview Bill",className:"w-full h-auto rounded-2xl shadow-sm max-h-[300px] object-contain mx-auto",onContextMenu:a=>a.stopPropagation()}),t("div",{className:"absolute inset-x-0 bottom-4 flex justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:t("span",{className:"bg-black/60 text-white text-[8px] px-3 py-1 rounded-full backdrop-blur-sm font-bold uppercase",children:"Nh\u1EA5n gi\u1EEF \u1EA3nh \u0111\u1EC3 l\u01B0u th\u1EE7 c\xF4ng"})})]}),l("div",{className:"grid grid-cols-3 gap-2",children:[l("button",{onClick:j,className:"flex flex-col items-center gap-2 p-4 bg-slate-50 rounded-2xl hover:bg-blue-50 border border-slate-100 transition-all active:scale-95",children:[t("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm",children:t(it,{size:20,className:"text-slate-600"})}),t("span",{className:"font-bold text-[9px] text-slate-600 uppercase",children:"L\u01B0u File"})]}),l("button",{onClick:R,className:"flex flex-col items-center gap-2 p-4 bg-slate-50 rounded-2xl hover:bg-blue-50 border border-slate-100 transition-all active:scale-95",children:[t("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm",children:t(dt,{size:20,className:"text-slate-600"})}),t("span",{className:"font-bold text-[9px] text-slate-600 uppercase",children:"Sao ch\xE9p"})]}),l("button",{onClick:Oe,className:"flex flex-col items-center gap-2 p-4 bg-blue-600 rounded-2xl hover:bg-blue-700 border border-blue-500 transition-all active:scale-95",children:[t("div",{className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center shadow-sm",children:t(Pe,{size:20,className:"text-white"})}),t("span",{className:"font-bold text-[9px] text-white uppercase",children:"Chia s\u1EBB"})]})]}),l("div",{className:"bg-blue-50/50 p-4 rounded-2xl flex items-start gap-3 border border-blue-100",children:[t("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center shrink-0 mt-0.5",children:t(ct,{size:16,className:"text-blue-600"})}),l("p",{className:"text-[10px] text-blue-800 font-medium leading-relaxed",children:["H\xF3a \u0111\u01A1n \u0111\xE3 \u0111\u01B0\u1EE3c t\u1EA1o th\xE0nh c\xF4ng. B\u1EA1n c\xF3 th\u1EC3 ",t("b",{children:"T\u1EA3i xu\u1ED1ng"}),", ",t("b",{children:"Sao ch\xE9p"})," ho\u1EB7c ",t("b",{children:"Chia s\u1EBB"})," tr\u1EF1c ti\u1EBFp qua Zalo. N\u1EBFu n\xFAt kh\xF4ng ho\u1EA1t \u0111\u1ED9ng (\u0111\u1ED1i v\u1EDBi APK), h\xE3y ",t("b",{children:"nh\u1EA5n gi\u1EEF v\xE0o \u1EA3nh"})," ph\xEDa tr\xEAn \u0111\u1EC3 l\u01B0u."]})]}),t("button",{onClick:()=>V(!1),className:"w-full py-4 bg-slate-100 text-slate-600 font-bold rounded-2xl uppercase text-[11px] active:scale-95 transition-all",children:"\u0110\xF3ng"})]})})]})};import{useState as mt}from"react";import{X as bt,Save as ht,CreditCard as gt,RefreshCw as xt,Loader2 as ft}from"lucide-react";import{jsx as M,jsxs as q}from"react/jsx-runtime";var ze=({config:e,onSave:o,onClose:i,isAdmin:w,onCheckUpdate:m,isCheckingUpdate:x})=>{let[f,y]=mt({...e});return M("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:q("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[q("div",{className:"flex justify-between items-center",children:[M("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),M("button",{onClick:i,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:M(bt,{size:20})})]}),q("div",{className:"space-y-4",children:[q("div",{className:"space-y-3",children:[q("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[M(gt,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),q("div",{className:"grid grid-cols-2 gap-3",children:[M("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:f.bankInfo?.bankId,onChange:S=>y(N=>({...N,bankInfo:{...N.bankInfo,bankId:S.target.value}}))}),M("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:f.bankInfo?.accountNo,onChange:S=>y(N=>({...N,bankInfo:{...N.bankInfo,accountNo:S.target.value}}))}),M("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:f.bankInfo?.accountName,onChange:S=>y(N=>({...N,bankInfo:{...N.bankInfo,accountName:S.target.value.toUpperCase()}}))})]})]}),m&&M("div",{className:"pt-2",children:q("button",{onClick:m,disabled:x,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[x?M(ft,{size:14,className:"animate-spin"}):M(xt,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),q("div",{className:"flex gap-3",children:[q("button",{onClick:()=>o(f),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[M(ht,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),M("button",{onClick:i,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};async function B(e,o,i={},w=0){if(!e||!e.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let f=new AbortController,y=setTimeout(()=>f.abort(),2e4),S=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...i,action:o}),signal:f.signal});if(clearTimeout(y),!S.ok)throw new Error(`HTTP ${S.status}`);let N=await S.text();if(!N)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let G=N.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(G?G[0]:N)}catch(f){if(w<1&&(f.name==="AbortError"||f.message.includes("HTTP")))return B(e,o,i,w+1);throw f}}import{jsx as L,jsxs as ne}from"react/jsx-runtime";var yt=()=>{let[e,o]=O(()=>{let s=localStorage.getItem("diti_user");return s?JSON.parse(s):null}),[i,w]=O(()=>{let s=localStorage.getItem("diti_config");return{...s?JSON.parse(s):ke,sheetUrl:be}}),[m,x]=O(()=>{let s=localStorage.getItem("diti_services_cache");return s?JSON.parse(s):[]}),[f,y]=O([]),[S,N]=O([]),[G,H]=O(!1),[oe,D]=O(!1),[ee,C]=O(!1),[te,J]=O(!1),[P,Y]=O(null),[K,V]=O(null),[k,F]=O({dateFrom:me(),dateTo:me(),searchTerm:"",searchTech:"",viewAll:!1}),[A,W]=O({customerName:"",phone:"",address:"",status:re[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0});_e(()=>{let s=document.getElementById("splash");return s&&setTimeout(()=>{s.style.opacity="0",setTimeout(()=>s.remove(),600)},500),window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),V(r)}),()=>window.removeEventListener("beforeinstallprompt",()=>{})},[]);let n=async()=>{if(K){K.prompt();let{outcome:s}=await K.userChoice;s==="accepted"&&V(null)}else alert(`\u0110\u1EC3 c\xE0i \u0111\u1EB7t: 
- Android: Ch\u1ECDn 'Th\xEAm v\xE0o m\xE0n h\xECnh ch\xEDnh' trong menu tr\xECnh duy\u1EC7t.
- iOS: Nh\u1EA5n n\xFAt Share r\u1ED3i ch\u1ECDn 'Th\xEAm v\xE0o MH ch\xEDnh'.`)},h=Ee(async()=>{if(e){H(m.length===0);try{let[s,r,v]=await Promise.all([B(i.sheetUrl,"read"),B(i.sheetUrl,"read_settings"),B(i.sheetUrl,"read_pricelist")]);if(Array.isArray(s)){let j=s.map(R=>({...R,customerName:R.customer_name||R.customerName||"",workItems:typeof R.work_items=="string"?JSON.parse(R.work_items):R.work_items||[],revenue:Number(R.revenue||0),cost:Number(R.cost||0),debt:Number(R.debt||0),created_at:R.created_at||R.date||new Date().toISOString()}));x(j),localStorage.setItem("diti_services_cache",JSON.stringify(j))}if(r?.technicians){let j=typeof r.technicians=="string"?JSON.parse(r.technicians):r.technicians;y(Array.isArray(j)?j:[])}Array.isArray(v)&&N(v)}catch(s){console.error("Fetch Error:",s)}finally{H(!1)}}},[e,i.sheetUrl,m.length]);_e(()=>{e&&h()},[e,h]);let U=vt(()=>{let s=[...m];if(e?.role!=="admin"&&e?.associatedTech&&(s=s.filter(r=>r.technician===e.associatedTech)),k.viewAll||(s=s.filter(r=>{let v=(r.created_at||"").split("T")[0];return v>=k.dateFrom&&v<=k.dateTo})),k.searchTech&&(s=s.filter(r=>r.technician===k.searchTech)),k.searchTerm){let r=k.searchTerm.toLowerCase();s=s.filter(v=>(v.customerName||"").toLowerCase().includes(r)||(v.phone||"").includes(r)||(v.address||"").toLowerCase().includes(r))}return s.sort((r,v)=>new Date(v.created_at).getTime()-new Date(r.created_at).getTime())},[m,k,e]),ae=async(s,r)=>{H(!0);try{let v=await B(i.sheetUrl,"login",{username:s,password:r});v?.status==="success"&&v.user?(o(v.user),localStorage.setItem("diti_user",JSON.stringify(v.user))):alert(v?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{H(!1)}},z=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(o(null),localStorage.clear(),window.location.reload())},T=Ee(()=>{Y(null),W({customerName:"",phone:"",address:"",status:re[0],technician:e?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[e]);return e?ne("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[L("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:ne("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[ne("div",{className:"flex items-center gap-3",children:[L(X,{size:32}),ne("div",{children:[L("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),L("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:e.name})]})]}),ne("div",{className:"flex gap-2",children:[L("button",{onClick:()=>C(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:L(Nt,{size:18})}),L("button",{onClick:z,className:"p-2 text-red-400",children:L(wt,{size:18})})]})]})}),L("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:ne("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[L("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:L("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:L(Ae,{formData:A,setFormData:W,technicians:f,priceList:S,selectedId:P,isSubmitting:oe,currentUser:e,services:m,bankInfo:i.bankInfo,onClear:T,onSave:async()=>{D(!0);try{(await B(i.sheetUrl,"create",{...A,customer_name:A.customerName,work_items:A.workItems,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await h(),T(),alert("L\u01B0u phi\u1EBFu th\xE0nh c\xF4ng"))}catch{alert("L\u1ED7i khi l\u01B0u phi\u1EBFu")}finally{D(!1)}},onUpdate:async()=>{if(P){D(!0);try{await B(i.sheetUrl,"update",{...A,customer_name:A.customerName,work_items:A.workItems,id:P,created_at:m.find(s=>s.id===P)?.created_at}),await h(),T(),alert("C\u1EADp nh\u1EADt phi\u1EBFu th\xE0nh c\xF4ng")}catch{alert("L\u1ED7i khi c\u1EADp nh\u1EADt phi\u1EBFu")}finally{D(!1)}}},onDelete:async()=>{if(!(!P||!confirm("X\xF3a?"))){D(!0);try{await B(i.sheetUrl,"delete",{id:P,role:e.role}),await h(),T()}catch{alert("L\u1ED7i khi x\xF3a phi\u1EBFu")}finally{D(!1)}}}})})}),L("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:L(ye,{data:U,loading:G,technicians:f,selectedId:P,onSelectRow:s=>{Y(s.id),W({...s}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:k,setFilters:{setDateFrom:s=>F(r=>({...r,dateFrom:s,viewAll:!1})),setDateTo:s=>F(r=>({...r,dateTo:s,viewAll:!1})),setSearchTerm:s=>F(r=>({...r,searchTerm:s})),setSearchTech:s=>F(r=>({...r,searchTech:s})),setViewAll:s=>F(r=>({...r,viewAll:s}))},currentUser:e,onInstallApp:n,installAvailable:!!K})})]})}),ee&&L(ze,{config:i,isAdmin:e.role==="admin",onClose:()=>C(!1),onSave:s=>{w(s),localStorage.setItem("diti_config",JSON.stringify(s)),C(!1)}})]}):L(xe,{onLogin:ae,isLoading:G})},Ue=yt;import{jsx as Me}from"react/jsx-runtime";var Re=document.getElementById("root");Re&&St(Re).render(Me(kt.StrictMode,{children:Me(Ue,{})}));
