import ct from"react";import{createRoot as dt}from"react-dom/client";import{useState as _,useEffect as we,useCallback as ye,useMemo as ot}from"react";import{Settings as rt,LogOut as lt}from"lucide-react";import{useState as le}from"react";import{User as Ee,Lock as Re}from"lucide-react";import{jsx as Pe}from"react/jsx-runtime";var X=({className:t="",size:l=64})=>Pe("img",{src:"logo.png",alt:"Logo",width:l,height:l,className:`${t} object-contain`,loading:"eager",onError:i=>{let x=i.target;x.src.indexOf("public/")===-1&&(x.src="public/logo.png")}});import{jsx as T,jsxs as B}from"react/jsx-runtime";var ie=({onLogin:t,isLoading:l})=>{let[i,x]=le(""),[u,b]=le("");return T("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:B("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[l&&T("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:B("div",{className:"relative flex flex-col items-center",children:[T(X,{size:80,className:"animate-pulse"}),T("div",{className:"mt-8 text-center",children:T("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),B("div",{className:"flex flex-col items-center text-center space-y-3",children:[T(X,{size:64,className:l?"animate-pulse":""}),B("div",{children:[T("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),T("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),B("form",{onSubmit:v=>{v.preventDefault(),i&&u&&t(i,u)},className:"space-y-4",children:[B("div",{className:"relative",children:[T(Ee,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),T("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:i,onChange:v=>x(v.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),B("div",{className:"relative",children:[T(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),T("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:u,onChange:v=>b(v.target.value),required:!0,autoComplete:"current-password"})]}),T("button",{type:"submit",disabled:l,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),T("div",{className:"pt-4 text-center border-t border-slate-50",children:T("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as pe,useMemo as _e,useRef as ae}from"react";import{Search as ue,ChevronRight as ze,Calendar as Ue,Filter as Oe,CheckCircle2 as De,Phone as Me,MapPin as Fe,Download as He,Smartphone as je}from"lucide-react";import*as W from"xlsx";var ne=()=>new Date().toISOString().split("T")[0];var E=t=>{let l=typeof t=="number"?t:parseInt(String(t).replace(/\D/g,""),10);return isNaN(l)?"0":l.toLocaleString("vi-VN")},te=t=>{if(typeof t=="number")return t;let l=parseInt(t.replace(/\D/g,""),10);return isNaN(l)?0:l},ce=t=>t.reduce((l,i)=>l+(i.total||0),0);function de(t,l){let i;return(...x)=>{clearTimeout(i),i=setTimeout(()=>t(...x),l)}}import{Fragment as Xe,jsx as c,jsxs as d}from"react/jsx-runtime";var me=({data:t,loading:l,technicians:i,selectedId:x,onSelectRow:u,filters:b,setFilters:g,currentUser:v,onInstallApp:k,installAvailable:f})=>{let M=v?.role==="admin",[F,Z]=pe(b.searchTerm),[z,Q]=pe(null),L=ae(null),J=ae(!1),H=ae({x:0,y:0}),A=ae(!1),q=_e(()=>de(n=>g.setSearchTerm(n),300),[g]),j=n=>{Z(n.target.value),q(n.target.value)},K=()=>{if(t.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let n=t.map(N=>{let a=Number(N.revenue||0),e=Number(N.cost||0),s=a-e,r=Number(N.debt||0);return{"Ng\xE0y nh\u1EADp":(N.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":N.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":N.phone,"\u0110\u1ECBa ch\u1EC9":N.address,"K\u1EF9 thu\u1EADt vi\xEAn":N.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":N.content,"Doanh thu (\u0111)":a,"Gi\xE1 v\u1ED1n (\u0111)":e,"L\u1EE3i nhu\u1EADn (\u0111)":s,"C\xF4ng n\u1EE3 (\u0111)":r,"Tr\u1EA1ng th\xE1i":N.status}}),m=W.utils.json_to_sheet(n),D=W.utils.book_new();W.utils.book_append_sheet(D,m,"BaoCaoDichVu");let V=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;W.writeFile(D,V)},S=n=>{let m=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${n.customerName}
\u{1F4DE} S\u0110T: ${n.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${n.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${n.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${n.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(m).then(()=>{Q("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>Q(null),2e3)}).catch(D=>{console.error("L\u1ED7i copy:",D)})},O=(n,m)=>{J.current=!1,A.current=!1,H.current={x:n.clientX,y:n.clientY},L.current=setTimeout(()=>{A.current||(J.current=!0,S(m))},600)},U=n=>{let m=Math.abs(n.clientX-H.current.x),D=Math.abs(n.clientY-H.current.y);(m>10||D>10)&&(A.current=!0,L.current&&(clearTimeout(L.current),L.current=null))},P=(n,m)=>{L.current&&(clearTimeout(L.current),L.current=null),!J.current&&!A.current&&u(m)};return d("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[z&&d("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[c(De,{size:16,className:"text-green-400"}),c("span",{className:"font-black text-[11px] uppercase tracking-widest",children:z})]}),d("div",{className:"space-y-3 mb-5 shrink-0",children:[d("div",{className:"relative group",children:[c(ue,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),c("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:F,onChange:j})]}),d("div",{className:"flex flex-wrap items-center gap-1.5",children:[d("button",{onClick:()=>g.setViewAll(!b.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${b.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[c(Oe,{size:14})," ",b.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!b.viewAll&&d("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[c(Ue,{size:12,className:"text-slate-400"}),c("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateFrom,onChange:n=>g.setDateFrom(n.target.value)}),c("span",{className:"text-slate-300",children:"/"}),c("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateTo,onChange:n=>g.setDateTo(n.target.value)})]}),d("div",{className:"flex-1 flex gap-1.5",children:[M&&c("div",{className:"relative flex-1 min-w-[80px]",children:d("select",{className:"w-full pl-2 pr-6 py-1.5 bg-white border border-slate-200 rounded-xl outline-none font-bold text-slate-600 appearance-none h-[34px] cursor-pointer text-[10px] shadow-sm",value:b.searchTech,onChange:n=>g.setSearchTech(n.target.value),children:[c("option",{value:"",children:"KTV"}),i.map(n=>c("option",{value:n,children:n},n))]})}),d("button",{onClick:k,className:`h-[34px] px-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider flex-shrink-0 ${f?"bg-slate-800 text-white hover:bg-black animate-pulse":"bg-slate-100 text-slate-500 hover:bg-slate-200"}`,children:[c(je,{size:14})," T\u1EA2I APP"]}),d("button",{onClick:K,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider flex-shrink-0",children:[c(He,{size:14})," EXCEL"]})]})]})]}),c("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:l?d("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[c(X,{size:48,className:"animate-pulse"}),c("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):t.length===0?d("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[c(ue,{size:48,strokeWidth:1,className:"opacity-40"}),c("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):t.map(n=>d("div",{onPointerDown:m=>O(m,n),onPointerMove:U,onPointerUp:m=>P(m,n),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${x===n.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[d("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[d("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[c("span",{children:(n.created_at||"").split("T")[0]?.split("-")[2]||"--"}),d("span",{className:"opacity-60 text-[10px]",children:["T",(n.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),d("div",{className:"min-w-0 flex-1",children:[c("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:n.customerName}),c("div",{className:"flex flex-col gap-0.5 mb-1.5",children:d("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[c(Me,{size:10,className:"text-blue-400"}),c("span",{children:n.phone}),n.address&&d(Xe,{children:[c("span",{className:"text-slate-200",children:"|"}),c(Fe,{size:10,className:"text-red-400"}),c("span",{className:"truncate max-w-[120px]",children:n.address})]})]})}),d("div",{className:"flex items-center gap-2",children:[c("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:n.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),c("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${n.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":n.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:n.status})]})]})]}),d("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[d("div",{className:"text-right",children:[d("div",{className:"font-black text-slate-800 text-[14px]",children:[E(n.revenue),"\u0111"]}),Number(n.debt)>0&&d("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",E(n.debt)]})]}),c(ze,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),x===n.id&&c("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},n.id))}),d("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[d("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[b.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",c("span",{className:"text-slate-700 ml-1 font-black",children:t.length})]}),d("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",E(t.reduce((n,m)=>n+Number(m.revenue||0),0)),"\u0111"]})]})]})};import{useState as se,useRef as $e,useMemo as he}from"react";import{Plus as Ge,Trash2 as xe,Activity as qe,User as Ke,Phone as Ve,MapPin as fe,ReceiptText as Be,X as Je,MessageSquare as We}from"lucide-react";import Ye from"html2canvas";var oe="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",be={sheetUrl:oe,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},ee=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{jsx as h,jsxs as I}from"react/jsx-runtime";var ge=({formData:t,bankInfo:l})=>{let i=ce(t.workItems),x=l?`https://img.vietqr.io/image/${l.bankId}-${l.accountNo}-compact2.png?amount=${i}&addInfo=DITICOMS SERVICE ${t.customerName.toUpperCase()}&accountName=${encodeURIComponent(l.accountName)}`:"";return I("div",{className:"w-[302px] bg-white p-6 mx-auto font-sans block",style:{height:"auto",minHeight:"fit-content"},children:[I("div",{className:"flex flex-col items-center text-center space-y-1 mb-5",children:[h(X,{size:52}),h("h1",{className:"text-xl font-black uppercase text-blue-600 tracking-tight",children:"DITICOMS SERVICE"}),h("p",{className:"text-[8px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:"S\u1EEDa ch\u1EEFa & B\u1EA3o tr\xEC Thi\u1EBFt b\u1ECB"}),h("div",{className:"w-12 h-0.5 bg-blue-600 rounded-full mt-1.5"})]}),I("div",{className:"space-y-1.5 mb-5 text-[11px]",children:[I("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[h("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Kh\xE1ch h\xE0ng:"}),h("span",{className:"font-bold text-slate-900",children:t.customerName})]}),I("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[h("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Ng\xE0y t\u1EA1o:"}),h("span",{className:"font-bold text-slate-900",children:new Date().toLocaleDateString("vi-VN")})]})]}),I("div",{className:"space-y-3 mb-6",children:[h("div",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest border-l-2 border-blue-500 pl-2",children:"Chi ti\u1EBFt d\u1ECBch v\u1EE5"}),I("table",{className:"w-full text-[10px] border-collapse",children:[h("thead",{children:I("tr",{className:"text-[8px] text-slate-400 uppercase border-b border-slate-100",children:[h("th",{className:"pb-2 text-left font-black",children:"N\u1ED9i dung"}),h("th",{className:"pb-2 text-center font-black px-1",children:"SL"}),h("th",{className:"pb-2 text-right font-black px-1",children:"\u0110\u01A1n gi\xE1"}),h("th",{className:"pb-2 text-right font-black",children:"T.Ti\u1EC1n"})]})}),h("tbody",{className:"divide-y divide-slate-50",children:t.workItems.map((u,b)=>I("tr",{className:"align-middle",children:[h("td",{className:"py-2.5 text-slate-800 font-bold leading-tight pr-1",children:u.desc}),h("td",{className:"py-2.5 text-center text-slate-600 font-black px-1",children:u.qty}),h("td",{className:"py-2.5 text-right text-slate-600 font-medium whitespace-nowrap px-1",children:E(u.price)}),h("td",{className:"py-2.5 text-right font-black text-slate-900 whitespace-nowrap",children:E(u.total)})]},b))})]})]}),I("div",{className:"bg-slate-50 p-4 rounded-2xl flex justify-between items-center mb-6",children:[h("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-wider",children:"T\u1ED5ng c\u1ED9ng:"}),I("span",{className:"text-lg font-black text-blue-600",children:[E(t.revenue),"\u0111"]})]}),l&&t.status!=="Ho\xE0n th\xE0nh"&&I("div",{className:"flex flex-col items-center space-y-2.5 pt-4 border-t border-dashed border-slate-200",children:[h("img",{src:x,alt:"QR",className:"w-32 h-32 border-2 border-white shadow-sm rounded-lg"}),I("div",{className:"text-center",children:[I("p",{className:"text-[9px] font-black text-slate-800 uppercase tracking-tighter",children:[l.bankId," \u2022 ",l.accountNo]}),h("p",{className:"text-[8px] font-bold text-slate-400 uppercase mt-0.5",children:l.accountName})]})]}),I("div",{className:"text-center pt-6 border-t border-slate-50 mt-6",children:[h("p",{className:"text-[9px] font-bold text-slate-400 uppercase italic tracking-widest",children:"Tr\xE2n tr\u1ECDng c\u1EA3m \u01A1n!"}),h("p",{className:"text-[7px] text-slate-300 mt-2 font-bold tracking-[0.3em]",children:"DITICOMS SERVICE MANAGER"})]})]})};import{Fragment as Ze,jsx as o,jsxs as p}from"react/jsx-runtime";var ve=({formData:t,setFormData:l,technicians:i,priceList:x,selectedId:u,isSubmitting:b,currentUser:g,onSave:v,onUpdate:k,onDelete:f,onClear:M,services:F,bankInfo:Z})=>{let z=g?.role==="admin",[Q,L]=se(null),[J,H]=se(!1),[A,q]=se(!1),[j,K]=se(!1),S=$e(null),O=he(()=>{let a={};return[...F].sort((s,r)=>new Date(r.created_at).getTime()-new Date(s.created_at).getTime()).forEach(s=>{let r=String(s.phone||"").trim();r.length>=3&&(a[r]||(a[r]={name:s.customerName||"",address:s.address||""}))}),Object.entries(a).map(([s,r])=>({phone:s,...r}))},[F]),U=he(()=>{let a=t.phone.trim();return a.length<3?[]:O.filter(e=>e.phone.includes(a)).slice(0,5)},[O,t.phone]),P=(a,e)=>{l(s=>{let r={...s,[a]:e};return a==="status"&&(e==="Ho\xE0n th\xE0nh"?r.debt=0:r.debt=r.revenue),r})},n=a=>{l(e=>({...e,phone:a.phone,customerName:a.name,address:a.address})),H(!1)},m=(a,e,s)=>{l(r=>{let C=[...r.workItems],w={...C[a],[e]:s},Te=te(e==="price"?s:w.price),Ie=Number(e==="qty"?s:w.qty);w.total=Te*Ie,C[a]=w;let re=C.reduce((Le,Ae)=>Le+(Number(Ae.total)||0),0);return{...r,workItems:C,revenue:re,debt:r.status==="Ho\xE0n th\xE0nh"?0:re}})},D=async()=>{if(S.current){K(!0);try{let a=await Ye(S.current,{scale:3,useCORS:!0}),e=`Bill_${(t.customerName||"Khach").toUpperCase()}.png`;a.toBlob(async s=>{if(!s)return;if(navigator.share&&navigator.canShare){let C=new File([s],e,{type:"image/png"});if(navigator.canShare({files:[C]})){await navigator.share({files:[C],title:"Invoice"});return}}let r=document.createElement("a");r.href=a.toDataURL(),r.download=e,r.click()})}catch{alert("L\u1ED7i khi t\u1EA1o h\xF3a \u0111\u01A1n")}finally{K(!1)}}},V="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",N="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return p("div",{className:"space-y-6",children:[p("div",{className:"flex justify-between items-center",children:[p("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[o(qe,{size:18,className:"text-blue-500"})," ",u?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),u&&z&&o("button",{onClick:f,disabled:b,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:o(xe,{size:20})})]}),p("div",{className:"space-y-3",children:[p("div",{className:"relative",children:[o(Ve,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),o("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:V,value:t.phone,onChange:a=>{P("phone",a.target.value),H(!0)},onFocus:()=>H(!0),onBlur:()=>setTimeout(()=>H(!1),200)}),J&&U.length>0&&p("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-200 shadow-2xl z-[60] max-h-56 overflow-auto rounded-2xl mt-1 animate-in fade-in zoom-in duration-150",children:[o("div",{className:"p-2 border-b border-slate-50 bg-slate-50/50",children:o("span",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest px-1",children:"G\u1EE3i \xFD t\u1EEB l\u1ECBch s\u1EED"})}),U.map((a,e)=>p("div",{onMouseDown:()=>n(a),className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 transition-colors flex flex-col",children:[p("div",{className:"flex justify-between items-center mb-0.5",children:[o("span",{className:"font-black text-blue-600 text-xs",children:a.phone}),o("span",{className:"font-bold text-slate-800 text-xs",children:a.name})]}),p("div",{className:"flex items-center gap-1 text-slate-400 text-[10px]",children:[o(fe,{size:10}),o("span",{className:"truncate",children:a.address||"Kh\xF4ng c\xF3 \u0111\u1ECBa ch\u1EC9"})]})]},e))]})]}),p("div",{className:"relative",children:[o(Ke,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),o("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:V,value:t.customerName,onChange:a=>P("customerName",a.target.value)})]}),p("div",{className:"relative",children:[o(fe,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),o("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:V,value:t.address,onChange:a=>P("address",a.target.value)})]}),p("div",{className:"relative",children:[o(We,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),o("textarea",{placeholder:"Y\xEAu c\u1EA7u d\u1ECBch v\u1EE5...",className:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl min-h-[80px] focus:bg-white focus:border-blue-400 outline-none",value:t.content,onChange:a=>P("content",a.target.value)})]}),p("div",{className:"grid grid-cols-2 gap-3",children:[o("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:t.status,onChange:a=>P("status",a.target.value),children:ee.map(a=>o("option",{value:a,children:a},a))}),p("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold appearance-none text-slate-700 outline-none",value:t.technician,onChange:a=>P("technician",a.target.value),disabled:!z,children:[o("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),i.map(a=>o("option",{value:a,children:a},a))]})]}),p("div",{className:"pt-2",children:[p("div",{className:"flex justify-between items-center mb-2 px-1",children:[o("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"D\u1ECBch v\u1EE5 & Linh ki\u1EC7n"}),o("button",{onClick:()=>l(a=>({...a,workItems:[...a.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:o(Ge,{size:18})})]}),o("div",{className:"space-y-2",children:t.workItems.map((a,e)=>p("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 relative group hover:border-blue-100 transition-all",children:[o("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200",value:a.desc,onFocus:()=>L(e),onChange:s=>m(e,"desc",s.target.value),onBlur:()=>setTimeout(()=>L(null),200)}),p("div",{className:"flex gap-2 text-[11px] font-bold",children:[p("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg px-2 flex items-center gap-1",children:["SL: ",o("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:a.qty,onChange:s=>m(e,"qty",s.target.value)})]}),o("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:o("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:E(a.price),onChange:s=>m(e,"price",s.target.value)})}),o("button",{onClick:()=>l(s=>({...s,workItems:s.workItems.filter((r,C)=>C!==e)})),className:"text-slate-300 hover:text-red-400 transition-colors p-1",children:o(xe,{size:16})})]})]},e))})]}),p("div",{className:"pt-4 space-y-2 bg-slate-100/40 p-3 rounded-[24px] border border-slate-100",children:[o("div",{className:"flex items-center gap-2 px-1 mb-1",children:o("span",{className:"font-black text-slate-400 text-[9px] uppercase tracking-[0.2em]",children:"Th\xF4ng tin t\xE0i ch\xEDnh"})}),p("div",{className:"grid grid-cols-3 gap-2",children:[p("div",{className:"flex flex-col gap-1 text-center",children:[o("span",{className:"text-[8px] font-black text-blue-500 uppercase tracking-tighter",children:"T\u1ED5ng thu"}),o("input",{type:"text",className:`${N} text-blue-600 bg-slate-50`,value:E(t.revenue),readOnly:!0})]}),p("div",{className:"flex flex-col gap-1 text-center",children:[o("span",{className:"text-[8px] font-black text-orange-500 uppercase tracking-tighter",children:"V\u1ED1n"}),o("input",{type:"text",className:`${N} text-orange-600`,value:E(t.cost),onChange:a=>P("cost",te(a.target.value))})]}),p("div",{className:"flex flex-col gap-1 text-center",children:[o("span",{className:"text-[8px] font-black text-red-500 uppercase tracking-tighter",children:"C\xF4ng n\u1EE3"}),o("input",{type:"text",className:`${N} text-red-600`,value:E(t.debt),onChange:a=>P("debt",te(a.target.value))})]})]})]})]}),o("div",{className:"grid grid-cols-2 gap-3 pt-2",children:u?p(Ze,{children:[o("button",{disabled:b,onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),o("button",{onClick:M,className:"bg-slate-100 text-slate-600 font-bold py-4 rounded-xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):o("button",{disabled:b,onClick:v,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg uppercase tracking-wider text-[12px] active:scale-95 transition-all",children:b?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),u&&p("button",{onClick:()=>q(!0),className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 rounded-xl uppercase shadow-md flex items-center justify-center gap-2 text-[12px] transition-all",children:[o(Be,{size:18})," XEM H\xD3A \u0110\u01A0N"]}),A&&o("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-[999999] flex items-center justify-center p-4",children:p("div",{className:"bg-white rounded-[40px] p-2 max-w-[360px] w-full max-h-[95vh] flex flex-col shadow-2xl relative animate-in fade-in zoom-in duration-300",children:[o("button",{onClick:()=>q(!1),className:"absolute top-4 right-4 p-2.5 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-600 z-[1000001] transition-colors",children:o(Je,{size:20})}),o("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar bg-slate-100/30 flex justify-center rounded-t-[38px]",children:o("div",{ref:S,className:"bg-white shadow-xl h-fit",children:o(ge,{formData:t,bankInfo:Z})})}),p("div",{className:"p-4 bg-white grid grid-cols-2 gap-3 rounded-b-[40px] border-t border-slate-50",children:[o("button",{onClick:D,disabled:j,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] flex items-center justify-center gap-2 active:scale-95 transition-all shadow-lg",children:j?"\u0110ANG T\u1EA0O...":"L\u01AFU / CHIA S\u1EBA"}),o("button",{onClick:()=>window.print(),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl uppercase text-[11px] active:scale-95 transition-all shadow-lg",children:"IN H\xD3A \u0110\u01A0N"}),o("button",{onClick:()=>q(!1),className:"col-span-2 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-3.5 rounded-2xl uppercase text-[11px] transition-all",children:"\u0110\xD3NG"})]})]})})]})};import{useState as Qe}from"react";import{X as et,Save as tt,CreditCard as at,RefreshCw as st,Loader2 as nt}from"lucide-react";import{jsx as R,jsxs as $}from"react/jsx-runtime";var Ne=({config:t,onSave:l,onClose:i,isAdmin:x,onCheckUpdate:u,isCheckingUpdate:b})=>{let[g,v]=Qe({...t});return R("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:$("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[$("div",{className:"flex justify-between items-center",children:[R("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),R("button",{onClick:i,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:R(et,{size:20})})]}),$("div",{className:"space-y-4",children:[$("div",{className:"space-y-3",children:[$("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[R(at,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),$("div",{className:"grid grid-cols-2 gap-3",children:[R("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.bankId,onChange:k=>v(f=>({...f,bankInfo:{...f.bankInfo,bankId:k.target.value}}))}),R("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountNo,onChange:k=>v(f=>({...f,bankInfo:{...f.bankInfo,accountNo:k.target.value}}))}),R("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountName,onChange:k=>v(f=>({...f,bankInfo:{...f.bankInfo,accountName:k.target.value.toUpperCase()}}))})]})]}),u&&R("div",{className:"pt-2",children:$("button",{onClick:u,disabled:b,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[b?R(nt,{size:14,className:"animate-spin"}):R(st,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),$("div",{className:"flex gap-3",children:[$("button",{onClick:()=>l(g),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[R(tt,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),R("button",{onClick:i,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};async function G(t,l,i={},x=0){if(!t||!t.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let g=new AbortController,v=setTimeout(()=>g.abort(),2e4),k=await fetch(t,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...i,action:l}),signal:g.signal});if(clearTimeout(v),!k.ok)throw new Error(`HTTP ${k.status}`);let f=await k.text();if(!f)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let M=f.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(M?M[0]:f)}catch(g){if(x<1&&(g.name==="AbortError"||g.message.includes("HTTP")))return G(t,l,i,x+1);throw g}}import{jsx as y,jsxs as Y}from"react/jsx-runtime";var it=()=>{let[t,l]=_(()=>{let e=localStorage.getItem("diti_user");return e?JSON.parse(e):null}),[i,x]=_(()=>{let e=localStorage.getItem("diti_config");return{...e?JSON.parse(e):be,sheetUrl:oe}}),[u,b]=_(()=>{let e=localStorage.getItem("diti_services_cache");return e?JSON.parse(e):[]}),[g,v]=_([]),[k,f]=_([]),[M,F]=_(!1),[Z,z]=_(!1),[Q,L]=_(!1),[J,H]=_(!1),[A,q]=_(null),[j,K]=_(null),[S,O]=_({dateFrom:ne(),dateTo:ne(),searchTerm:"",searchTech:"",viewAll:!1}),[U,P]=_({customerName:"",phone:"",address:"",status:ee[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0});we(()=>{let e=document.getElementById("splash");return e&&setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),600)},500),window.addEventListener("beforeinstallprompt",s=>{s.preventDefault(),K(s)}),()=>window.removeEventListener("beforeinstallprompt",()=>{})},[]);let n=async()=>{if(j){j.prompt();let{outcome:e}=await j.userChoice;e==="accepted"&&K(null)}else alert(`\u0110\u1EC3 c\xE0i \u0111\u1EB7t: 
- Android: Ch\u1ECDn 'Th\xEAm v\xE0o m\xE0n h\xECnh ch\xEDnh' trong menu tr\xECnh duy\u1EC7t.
- iOS: Nh\u1EA5n n\xFAt Share r\u1ED3i ch\u1ECDn 'Th\xEAm v\xE0o MH ch\xEDnh'.`)},m=ye(async()=>{if(t){F(u.length===0);try{let[e,s,r]=await Promise.all([G(i.sheetUrl,"read"),G(i.sheetUrl,"read_settings"),G(i.sheetUrl,"read_pricelist")]);if(Array.isArray(e)){let C=e.map(w=>({...w,customerName:w.customer_name||w.customerName||"",workItems:typeof w.work_items=="string"?JSON.parse(w.work_items):w.work_items||[],revenue:Number(w.revenue||0),cost:Number(w.cost||0),debt:Number(w.debt||0),created_at:w.created_at||w.date||new Date().toISOString()}));b(C),localStorage.setItem("diti_services_cache",JSON.stringify(C))}if(s?.technicians){let C=typeof s.technicians=="string"?JSON.parse(s.technicians):s.technicians;v(Array.isArray(C)?C:[])}Array.isArray(r)&&f(r)}catch(e){console.error("Fetch Error:",e)}finally{F(!1)}}},[t,i.sheetUrl,u.length]);we(()=>{t&&m()},[t,m]);let D=ot(()=>{let e=[...u];if(t?.role!=="admin"&&t?.associatedTech&&(e=e.filter(s=>s.technician===t.associatedTech)),S.viewAll||(e=e.filter(s=>{let r=(s.created_at||"").split("T")[0];return r>=S.dateFrom&&r<=S.dateTo})),S.searchTech&&(e=e.filter(s=>s.technician===S.searchTech)),S.searchTerm){let s=S.searchTerm.toLowerCase();e=e.filter(r=>(r.customerName||"").toLowerCase().includes(s)||(r.phone||"").includes(s)||(r.address||"").toLowerCase().includes(s))}return e.sort((s,r)=>new Date(r.created_at).getTime()-new Date(s.created_at).getTime())},[u,S,t]),V=async(e,s)=>{F(!0);try{let r=await G(i.sheetUrl,"login",{username:e,password:s});r?.status==="success"&&r.user?(l(r.user),localStorage.setItem("diti_user",JSON.stringify(r.user))):alert(r?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{F(!1)}},N=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(l(null),localStorage.clear(),window.location.reload())},a=ye(()=>{q(null),P({customerName:"",phone:"",address:"",status:ee[0],technician:t?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[t]);return t?Y("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[y("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:Y("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[Y("div",{className:"flex items-center gap-3",children:[y(X,{size:32}),Y("div",{children:[y("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),y("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:t.name})]})]}),Y("div",{className:"flex gap-2",children:[y("button",{onClick:()=>L(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:y(rt,{size:18})}),y("button",{onClick:N,className:"p-2 text-red-400",children:y(lt,{size:18})})]})]})}),y("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:Y("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[y("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:y("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:y(ve,{formData:U,setFormData:P,technicians:g,priceList:k,selectedId:A,isSubmitting:Z,currentUser:t,services:u,bankInfo:i.bankInfo,onClear:a,onSave:async()=>{z(!0);try{(await G(i.sheetUrl,"create",{...U,customer_name:U.customerName,work_items:U.workItems,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await m(),a(),alert("L\u01B0u phi\u1EBFu th\xE0nh c\xF4ng"))}catch{alert("L\u1ED7i khi l\u01B0u phi\u1EBFu")}finally{z(!1)}},onUpdate:async()=>{if(A){z(!0);try{await G(i.sheetUrl,"update",{...U,customer_name:U.customerName,work_items:U.workItems,id:A,created_at:u.find(e=>e.id===A)?.created_at}),await m(),a(),alert("C\u1EADp nh\u1EADt phi\u1EBFu th\xE0nh c\xF4ng")}catch{alert("L\u1ED7i khi c\u1EADp nh\u1EADt phi\u1EBFu")}finally{z(!1)}}},onDelete:async()=>{if(!(!A||!confirm("X\xF3a?"))){z(!0);try{await G(i.sheetUrl,"delete",{id:A,role:t.role}),await m(),a()}catch{alert("L\u1ED7i khi x\xF3a phi\u1EBFu")}finally{z(!1)}}}})})}),y("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:y(me,{data:D,loading:M,technicians:g,selectedId:A,onSelectRow:e=>{q(e.id),P({...e}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:S,setFilters:{setDateFrom:e=>O(s=>({...s,dateFrom:e,viewAll:!1})),setDateTo:e=>O(s=>({...s,dateTo:e,viewAll:!1})),setSearchTerm:e=>O(s=>({...s,searchTerm:e})),setSearchTech:e=>O(s=>({...s,searchTech:e})),setViewAll:e=>O(s=>({...s,viewAll:e}))},currentUser:t,onInstallApp:n,installAvailable:!!j})})]})}),Q&&y(Ne,{config:i,isAdmin:t.role==="admin",onClose:()=>L(!1),onSave:e=>{x(e),localStorage.setItem("diti_config",JSON.stringify(e)),L(!1)}})]}):y(ie,{onLogin:V,isLoading:M})},ke=it;import{jsx as Ce}from"react/jsx-runtime";var Se=document.getElementById("root");Se&&dt(Se).render(Ce(ct.StrictMode,{children:Ce(ke,{})}));
