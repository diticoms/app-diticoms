import xt from"react";import{createRoot as vt}from"react-dom/client";import{useState as P,useEffect as Ae,useCallback as Le,useMemo as ht}from"react";import{Settings as gt,LogOut as bt}from"lucide-react";import{useState as ge}from"react";import{User as Oe,Lock as He}from"lucide-react";import{jsx as De}from"react/jsx-runtime";var $=({className:e="",size:r=64})=>De("img",{src:"public/logo.png",alt:"Logo",width:r,height:r,className:`${e} object-contain`,loading:"eager",onError:l=>{let N=l.target;N.src.indexOf("public/")!==-1&&(N.src="logo.png")}});import{jsx as T,jsxs as B}from"react/jsx-runtime";var be=({onLogin:e,isLoading:r})=>{let[l,N]=ge(""),[f,x]=ge("");return T("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:B("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[r&&T("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:B("div",{className:"relative flex flex-col items-center",children:[T($,{size:80,className:"animate-pulse"}),T("div",{className:"mt-8 text-center",children:T("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),B("div",{className:"flex flex-col items-center text-center space-y-3",children:[T($,{size:64,className:r?"animate-pulse":""}),B("div",{children:[T("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),T("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),B("form",{onSubmit:w=>{w.preventDefault(),l&&f&&e(l,f)},className:"space-y-4",children:[B("div",{className:"relative",children:[T(Oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),T("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:l,onChange:w=>N(w.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),B("div",{className:"relative",children:[T(He,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),T("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:f,onChange:w=>x(w.target.value),required:!0,autoComplete:"current-password"})]}),T("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),T("div",{className:"pt-4 text-center border-t border-slate-50",children:T("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as xe,useMemo as Fe,useRef as ie}from"react";import{Search as ve,ChevronRight as qe,Calendar as Xe,Filter as Ge,CheckCircle2 as je,Phone as Je,MapPin as $e,Download as Be,Smartphone as Ke}from"lucide-react";import*as Z from"xlsx";var pe=()=>new Date().toISOString().split("T")[0];var O=e=>{let r=typeof e=="number"?e:parseInt(String(e).replace(/\D/g,""),10);return isNaN(r)?"0":r.toLocaleString("vi-VN")},le=e=>{if(typeof e=="number")return e;let r=parseInt(e.replace(/\D/g,""),10);return isNaN(r)?0:r};function fe(e,r){let l;return(...N)=>{clearTimeout(l),l=setTimeout(()=>e(...N),r)}}import{Fragment as Ve,jsx as i,jsxs as d}from"react/jsx-runtime";var Ne=({data:e,loading:r,technicians:l,selectedId:N,onSelectRow:f,filters:x,setFilters:h,currentUser:w,onInstallApp:y,installAvailable:v})=>{let q=w?.role==="admin",[M,oe]=xe(x.searchTerm),[E,K]=xe(null),S=ie(null),te=ie(!1),V=ie({x:0,y:0}),C=ie(!1),ae=Fe(()=>fe(s=>h.setSearchTerm(s),300),[h]),J=s=>{oe(s.target.value),ae(s.target.value)},se=()=>{if(e.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let s=e.map(I=>{let U=Number(I.revenue||0),t=Number(I.cost||0),o=U-t,g=Number(I.debt||0);return{"Ng\xE0y nh\u1EADp":(I.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":I.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":I.phone,"\u0110\u1ECBa ch\u1EC9":I.address,"K\u1EF9 thu\u1EADt vi\xEAn":I.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":I.content,"Doanh thu (\u0111)":U,"Gi\xE1 v\u1ED1n (\u0111)":t,"L\u1EE3i nhu\u1EADn (\u0111)":o,"C\xF4ng n\u1EE3 (\u0111)":g,"Tr\u1EA1ng th\xE1i":I.status}}),u=Z.utils.json_to_sheet(s),z=Z.utils.book_new();Z.utils.book_append_sheet(z,u,"BaoCaoDichVu");let Y=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;Z.writeFile(z,Y)},_=s=>{let u=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${s.customerName}
\u{1F4DE} S\u0110T: ${s.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${s.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${s.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${s.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(u).then(()=>{K("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>K(null),2e3)}).catch(z=>{console.error("L\u1ED7i copy:",z)})},X=(s,u)=>{te.current=!1,C.current=!1,V.current={x:s.clientX,y:s.clientY},S.current=setTimeout(()=>{C.current||(te.current=!0,_(u))},600)},R=s=>{let u=Math.abs(s.clientX-V.current.x),z=Math.abs(s.clientY-V.current.y);(u>10||z>10)&&(C.current=!0,S.current&&(clearTimeout(S.current),S.current=null))},W=(s,u)=>{S.current&&(clearTimeout(S.current),S.current=null),!te.current&&!C.current&&f(u)};return d("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[E&&d("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[i(je,{size:16,className:"text-green-400"}),i("span",{className:"font-black text-[11px] uppercase tracking-widest",children:E})]}),d("div",{className:"space-y-3 mb-5 shrink-0",children:[d("div",{className:"relative group",children:[i(ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),i("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:M,onChange:J})]}),d("div",{className:"flex flex-wrap items-center gap-2",children:[d("button",{onClick:()=>h.setViewAll(!x.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${x.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[i(Ge,{size:14})," ",x.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!x.viewAll&&d("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[i(Xe,{size:12,className:"text-slate-400"}),i("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:x.dateFrom,onChange:s=>h.setDateFrom(s.target.value)}),i("span",{className:"text-slate-300",children:"/"}),i("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:x.dateTo,onChange:s=>h.setDateTo(s.target.value)})]}),d("div",{className:"flex items-center gap-2 ml-auto",children:[y&&d("button",{onClick:y,className:`h-[34px] px-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider ${v?"bg-slate-800 text-white hover:bg-black":"bg-slate-100 text-slate-500"}`,children:[i(Ke,{size:14})," ",v?"C\xC0I \u0110\u1EB6T APP":"T\u1EA2I APP"]}),d("button",{onClick:se,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider",children:[i(Be,{size:14})," EXCEL"]})]})]})]}),i("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:r?d("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[i($,{size:48,className:"animate-pulse"}),i("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):e.length===0?d("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[i(ve,{size:48,strokeWidth:1,className:"opacity-40"}),i("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):e.map(s=>d("div",{onPointerDown:u=>X(u,s),onPointerMove:R,onPointerUp:u=>W(u,s),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${N===s.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[d("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[d("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[i("span",{children:(s.created_at||"").split("T")[0]?.split("-")[2]||"--"}),d("span",{className:"opacity-60 text-[10px]",children:["T",(s.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),d("div",{className:"min-w-0 flex-1",children:[i("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:s.customerName}),i("div",{className:"flex flex-col gap-0.5 mb-1.5",children:d("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[i(Je,{size:10,className:"text-blue-400"}),i("span",{children:s.phone}),s.address&&d(Ve,{children:[i("span",{className:"text-slate-200",children:"|"}),i($e,{size:10,className:"text-red-400"}),i("span",{className:"truncate max-w-[120px]",children:s.address})]})]})}),d("div",{className:"flex items-center gap-2",children:[i("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:s.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),i("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${s.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":s.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:s.status})]})]})]}),d("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[d("div",{className:"text-right",children:[d("div",{className:"font-black text-slate-800 text-[14px]",children:[O(s.revenue),"\u0111"]}),Number(s.debt)>0&&d("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",O(s.debt)]})]}),i(qe,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),N===s.id&&i("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},s.id))}),d("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[d("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[x.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",i("span",{className:"text-slate-700 ml-1 font-black",children:e.length})]}),d("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",O(e.reduce((s,u)=>s+Number(u.revenue||0),0)),"\u0111"]})]})]})};import{useState as j,useRef as Ze,useMemo as Se}from"react";import{Plus as Qe,Trash2 as ke,Activity as et,User as tt,Phone as at,MapPin as st,ReceiptText as nt,MessageSquare as ot,Sparkles as Te,Loader2 as rt}from"lucide-react";var ue="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",we={sheetUrl:ue,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},ne=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{GoogleGenAI as We,Type as Q}from"@google/genai";var Ye=new We({apiKey:process.env.API_KEY}),ye=async e=>{if(!e||e.length<5)throw new Error("M\xF4 t\u1EA3 qu\xE1 ng\u1EAFn. Vui l\xF2ng nh\u1EADp chi ti\u1EBFt l\u1ED7i \u0111\u1EC3 AI ch\u1EA9n \u0111o\xE1n ch\xEDnh x\xE1c h\u01A1n.");let r=await Ye.models.generateContent({model:"gemini-3-flash-preview",contents:`Kh\xE1ch h\xE0ng b\xE1o l\u1ED7i: "${e}". 
    H\xE3y \u0111\xF3ng vai chuy\xEAn gia s\u1EEDa ch\u1EEFa c\u1EE7a Diticoms. H\xE3y ph\xE2n t\xEDch l\u1ED7i v\xE0 \u0111\u1EC1 xu\u1EA5t c\xE1c d\u1ECBch v\u1EE5 ho\u1EB7c linh ki\u1EC7n thay th\u1EBF c\u1EA7n thi\u1EBFt. 
    L\u01B0u \xFD: \u0110\u01A1n gi\xE1 (price) ph\u1EA3i ph\xF9 h\u1EE3p v\u1EDBi th\u1ECB tr\u01B0\u1EDDng s\u1EEDa ch\u1EEFa m\xE1y t\xEDnh/\u0111i\u1EC7n t\u1EED t\u1EA1i Vi\u1EC7t Nam.`,config:{responseMimeType:"application/json",responseSchema:{type:Q.OBJECT,properties:{suggestions:{type:Q.ARRAY,items:{type:Q.OBJECT,properties:{desc:{type:Q.STRING,description:"T\xEAn linh ki\u1EC7n ho\u1EB7c d\u1ECBch v\u1EE5"},qty:{type:Q.NUMBER,description:"S\u1ED1 l\u01B0\u1EE3ng"},price:{type:Q.NUMBER,description:"\u0110\u01A1n gi\xE1 (VN\u0110)"}},required:["desc","qty","price"]}}},required:["suggestions"]},systemInstruction:"B\u1EA1n l\xE0 tr\u1EE3 l\xFD k\u1EF9 thu\u1EADt th\xF4ng minh. Ch\u1EC9 tr\u1EA3 v\u1EC1 d\u1EEF li\u1EC7u JSON \u0111\u1EC3 h\u1EC7 th\u1ED1ng t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n v\xE0o h\xF3a \u0111\u01A1n. Ng\xF4n ng\u1EEF: Ti\u1EBFng Vi\u1EC7t."}});try{let l=r.text||"{}";return JSON.parse(l).suggestions}catch(l){throw console.error("L\u1ED7i x\u1EED l\xFD ph\u1EA3n h\u1ED3i AI:",l),new Error("AI ph\u1EA3n h\u1ED3i kh\xF4ng \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng. Vui l\xF2ng th\u1EED l\u1EA1i.")}};import{Fragment as lt,jsx as n,jsxs as m}from"react/jsx-runtime";var Ce=({formData:e,setFormData:r,technicians:l,priceList:N,selectedId:f,isSubmitting:x,currentUser:h,onSave:w,onUpdate:y,onDelete:v,onClear:q,services:M,bankInfo:oe})=>{let E=h?.role==="admin",[K,S]=j(!1),[te,V]=j(!1),[C,ae]=j(!1),[J,se]=j(!1),[_,X]=j(null),[R,W]=j(null),[s,u]=j(null),[z,Y]=j(!1),I=Ze(null),U=Se(()=>{let a={};return[...M].sort((p,c)=>new Date(c.created_at).getTime()-new Date(p.created_at).getTime()).forEach(p=>{let c=String(p.phone||"").trim();c.length>=3&&(a[c]||(a[c]={name:p.customerName||"",address:p.address||""}))}),Object.entries(a).map(([p,c])=>({phone:p,...c}))},[M]),t=Se(()=>{let a=e.phone.trim();return a.length<3?[]:U.filter(b=>b.phone.includes(a)).slice(0,5)},[U,e.phone]),o=(a,b)=>{r(p=>{let c={...p,[a]:b};return a==="status"&&(b==="Ho\xE0n th\xE0nh"?c.debt=0:c.debt=c.revenue),c})},g=a=>{r(b=>({...b,phone:a.phone,customerName:a.name,address:a.address})),S(!1)},D=(a,b,p)=>{r(c=>{let G=[...c.workItems],re={...G[a],[b]:p},ze=le(b==="price"?p:re.price),Re=Number(b==="qty"?p:re.qty);re.total=ze*Re,G[a]=re;let he=G.reduce((Ue,Me)=>Ue+(Number(Me.total)||0),0);return{...c,workItems:G,revenue:he,debt:c.status==="Ho\xE0n th\xE0nh"?0:he}})},A=async()=>{if(!e.content||e.content.length<5){me("Vui l\xF2ng nh\u1EADp m\xF4 t\u1EA3 l\u1ED7i chi ti\u1EBFt");return}Y(!0);try{let a=await ye(e.content);if(a&&a.length>0){let b=a.map(c=>({desc:c.desc,qty:c.qty,price:c.price,total:c.qty*c.price})),p=b.reduce((c,G)=>c+G.total,0);r(c=>({...c,workItems:b,revenue:p,debt:c.status==="Ho\xE0n th\xE0nh"?0:p})),me("AI \u0111\xE3 ph\xE2n t\xEDch v\xE0 b\xE1o gi\xE1 xong!")}}catch(a){alert(a.message||"L\u1ED7i AI")}finally{Y(!1)}},me=a=>{u(a),setTimeout(()=>u(null),3e3)},ce="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",de="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return m("div",{className:"space-y-6",children:[s&&m("div",{className:"fixed top-24 left-1/2 -translate-x-1/2 z-[10001] bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full text-[11px] font-black uppercase tracking-widest animate-in fade-in zoom-in shadow-2xl flex items-center gap-2",children:[n(Te,{size:14,className:"text-yellow-400"}),s]}),m("div",{className:"flex justify-between items-center",children:[m("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[n(et,{size:18,className:"text-blue-500"})," ",f?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),f&&E&&n("button",{onClick:v,disabled:x,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:n(ke,{size:20})})]}),m("div",{className:"space-y-3",children:[m("div",{className:"relative",children:[n(at,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:ce,value:e.phone,onChange:a=>{o("phone",a.target.value),S(!0)},onFocus:()=>S(!0),onBlur:()=>setTimeout(()=>S(!1),200)}),K&&t.length>0&&n("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-200 shadow-2xl z-[60] max-h-56 overflow-auto rounded-2xl mt-1 animate-in fade-in zoom-in duration-150",children:t.map((a,b)=>n("div",{onMouseDown:()=>g(a),className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 transition-colors flex flex-col",children:m("div",{className:"flex justify-between items-center",children:[n("span",{className:"font-black text-blue-600 text-xs",children:a.phone}),n("span",{className:"font-bold text-slate-800 text-xs",children:a.name})]})},b))})]}),m("div",{className:"relative",children:[n(tt,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:ce,value:e.customerName,onChange:a=>o("customerName",a.target.value)})]}),m("div",{className:"relative",children:[n(st,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:ce,value:e.address,onChange:a=>o("address",a.target.value)})]}),m("div",{className:"relative group",children:[n(ot,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),n("textarea",{placeholder:"M\xF4 t\u1EA3 l\u1ED7i c\u1EE7a kh\xE1ch h\xE0ng...",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl min-h-[100px] focus:bg-white focus:border-blue-400 outline-none transition-all",value:e.content,onChange:a=>o("content",a.target.value)}),m("button",{onClick:A,disabled:z||!e.content,className:`absolute right-3 bottom-3 flex items-center gap-2 px-4 py-2 rounded-xl font-black text-[10px] uppercase tracking-wider transition-all shadow-md ${z?"bg-slate-200 text-slate-400":"bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white hover:shadow-indigo-200 hover:scale-105 active:scale-95"}`,children:[z?n(rt,{size:14,className:"animate-spin"}):n(Te,{size:14}),"AI Ch\u1EA9n \u0111o\xE1n"]})]}),m("div",{className:"grid grid-cols-2 gap-3",children:[n("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none",value:e.status,onChange:a=>o("status",a.target.value),children:ne.map(a=>n("option",{value:a,children:a},a))}),m("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none",value:e.technician,onChange:a=>o("technician",a.target.value),disabled:!E,children:[n("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),l.map(a=>n("option",{value:a,children:a},a))]})]}),m("div",{className:"pt-2",children:[m("div",{className:"flex justify-between items-center mb-2 px-1",children:[n("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"Danh s\xE1ch d\u1ECBch v\u1EE5"}),n("button",{onClick:()=>r(a=>({...a,workItems:[...a.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:n(Qe,{size:18})})]}),n("div",{className:"space-y-2",children:e.workItems.map((a,b)=>m("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 group hover:border-blue-100 transition-all",children:[n("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5/linh ki\u1EC7n...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200",value:a.desc,onChange:p=>D(b,"desc",p.target.value)}),m("div",{className:"flex gap-2 text-[11px] font-bold",children:[m("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg flex items-center gap-1",children:["SL: ",n("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:a.qty,onChange:p=>D(b,"qty",p.target.value)})]}),n("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:n("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:O(a.price),onChange:p=>D(b,"price",p.target.value)})}),n("button",{onClick:()=>r(p=>({...p,workItems:p.workItems.filter((c,G)=>G!==b)})),className:"text-slate-300 hover:text-red-400 p-1",children:n(ke,{size:16})})]})]},b))})]}),n("div",{className:"pt-4 space-y-2 bg-slate-100/40 p-4 rounded-[32px] border border-slate-100",children:m("div",{className:"grid grid-cols-3 gap-3",children:[m("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-blue-500 uppercase",children:"Doanh thu"}),n("input",{type:"text",className:`${de} text-blue-600 bg-slate-50`,value:O(e.revenue),readOnly:!0})]}),m("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-orange-500 uppercase",children:"Gi\xE1 v\u1ED1n"}),n("input",{type:"text",className:`${de} text-orange-600`,value:O(e.cost),onChange:a=>o("cost",le(a.target.value))})]}),m("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-red-500 uppercase",children:"C\xF4ng n\u1EE3"}),n("input",{type:"text",className:`${de} text-red-600`,value:O(e.debt),onChange:a=>o("debt",le(a.target.value))})]})]})})]}),n("div",{className:"grid grid-cols-2 gap-3 pt-4",children:f?m(lt,{children:[n("button",{disabled:x,onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),n("button",{onClick:q,className:"bg-slate-100 text-slate-600 font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):n("button",{disabled:x,onClick:w,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl shadow-lg uppercase tracking-widest text-[12px] active:scale-95 transition-all",children:x?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),f&&m("button",{onClick:()=>V(!0),className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-black py-4 rounded-2xl uppercase shadow-md flex items-center justify-center gap-3 text-[12px] transition-all",children:[n(nt,{size:20})," XU\u1EA4T H\xD3A \u0110\u01A0N"]})]})};import{useState as it}from"react";import{X as ct,Save as dt,CreditCard as pt,RefreshCw as ut,Loader2 as mt}from"lucide-react";import{jsx as L,jsxs as H}from"react/jsx-runtime";var Ie=({config:e,onSave:r,onClose:l,isAdmin:N,onCheckUpdate:f,isCheckingUpdate:x})=>{let[h,w]=it({...e});return L("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:H("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[H("div",{className:"flex justify-between items-center",children:[L("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),L("button",{onClick:l,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:L(ct,{size:20})})]}),H("div",{className:"space-y-4",children:[H("div",{className:"space-y-3",children:[H("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[L(pt,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),H("div",{className:"grid grid-cols-2 gap-3",children:[L("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:h.bankInfo?.bankId,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,bankId:y.target.value}}))}),L("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:h.bankInfo?.accountNo,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,accountNo:y.target.value}}))}),L("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:h.bankInfo?.accountName,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,accountName:y.target.value.toUpperCase()}}))})]})]}),f&&L("div",{className:"pt-2",children:H("button",{onClick:f,disabled:x,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[x?L(mt,{size:14,className:"animate-spin"}):L(ut,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),H("div",{className:"flex gap-3",children:[H("button",{onClick:()=>r(h),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[L(dt,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),L("button",{onClick:l,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};async function F(e,r,l={},N=0){if(!e||!e.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let h=new AbortController,w=setTimeout(()=>h.abort(),2e4),y=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...l,action:r}),signal:h.signal});if(clearTimeout(w),!y.ok)throw new Error(`HTTP ${y.status}`);let v=await y.text();if(!v)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let q=v.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(q?q[0]:v)}catch(h){if(N<1&&(h.name==="AbortError"||h.message.includes("HTTP")))return F(e,r,l,N+1);throw h}}import{jsx as k,jsxs as ee}from"react/jsx-runtime";var ft=()=>{let[e,r]=P(()=>{let t=localStorage.getItem("diti_user");return t?JSON.parse(t):null}),[l,N]=P(()=>{let t=localStorage.getItem("diti_config");return{...t?JSON.parse(t):we,sheetUrl:ue}}),[f,x]=P(()=>{let t=localStorage.getItem("diti_services_cache");return t?JSON.parse(t):[]}),[h,w]=P([]),[y,v]=P([]),[q,M]=P(!1),[oe,E]=P(!1),[K,S]=P(!1),[te,V]=P(!1),[C,ae]=P(null),[J,se]=P(null),[_,X]=P({dateFrom:pe(),dateTo:pe(),searchTerm:"",searchTech:"",viewAll:!1}),[R,W]=P({customerName:"",phone:"",address:"",status:ne[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0});Ae(()=>{let t=document.getElementById("splash");return t&&setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),600)},500),window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),se(o)}),()=>window.removeEventListener("beforeinstallprompt",()=>{})},[]);let s=async()=>{if(J){J.prompt();let{outcome:t}=await J.userChoice;t==="accepted"&&se(null)}else alert(`\u0110\u1EC3 c\xE0i \u0111\u1EB7t: 
- Android: Ch\u1ECDn 'Th\xEAm v\xE0o m\xE0n h\xECnh ch\xEDnh' trong menu tr\xECnh duy\u1EC7t.
- iOS: Nh\u1EA5n n\xFAt Share r\u1ED3i ch\u1ECDn 'Th\xEAm v\xE0o MH ch\xEDnh'.`)},u=Le(async()=>{if(e){M(f.length===0);try{let[t,o,g]=await Promise.all([F(l.sheetUrl,"read"),F(l.sheetUrl,"read_settings"),F(l.sheetUrl,"read_pricelist")]);if(Array.isArray(t)){let D=t.map(A=>({...A,customerName:A.customer_name||A.customerName||"",workItems:typeof A.work_items=="string"?JSON.parse(A.work_items):A.work_items||[],revenue:Number(A.revenue||0),cost:Number(A.cost||0),debt:Number(A.debt||0),created_at:A.created_at||A.date||new Date().toISOString()}));x(D),localStorage.setItem("diti_services_cache",JSON.stringify(D))}if(o?.technicians){let D=typeof o.technicians=="string"?JSON.parse(o.technicians):o.technicians;w(Array.isArray(D)?D:[])}Array.isArray(g)&&v(g)}catch(t){console.error("Fetch Error:",t)}finally{M(!1)}}},[e,l.sheetUrl,f.length]);Ae(()=>{e&&u()},[e,u]);let z=ht(()=>{let t=[...f];if(e?.role!=="admin"&&e?.associatedTech&&(t=t.filter(o=>o.technician===e.associatedTech)),_.viewAll||(t=t.filter(o=>{let g=(o.created_at||"").split("T")[0];return g>=_.dateFrom&&g<=_.dateTo})),_.searchTech&&(t=t.filter(o=>o.technician===_.searchTech)),_.searchTerm){let o=_.searchTerm.toLowerCase();t=t.filter(g=>(g.customerName||"").toLowerCase().includes(o)||(g.phone||"").includes(o)||(g.address||"").toLowerCase().includes(o))}return t.sort((o,g)=>new Date(g.created_at).getTime()-new Date(o.created_at).getTime())},[f,_,e]),Y=async(t,o)=>{M(!0);try{let g=await F(l.sheetUrl,"login",{username:t,password:o});g?.status==="success"&&g.user?(r(g.user),localStorage.setItem("diti_user",JSON.stringify(g.user))):alert(g?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{M(!1)}},I=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(r(null),localStorage.clear(),window.location.reload())},U=Le(()=>{ae(null),W({customerName:"",phone:"",address:"",status:ne[0],technician:e?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[e]);return e?ee("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[k("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:ee("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[ee("div",{className:"flex items-center gap-3",children:[k($,{size:32}),ee("div",{children:[k("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),k("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:e.name})]})]}),ee("div",{className:"flex gap-2",children:[k("button",{onClick:()=>S(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:k(gt,{size:18})}),k("button",{onClick:I,className:"p-2 text-red-400",children:k(bt,{size:18})})]})]})}),k("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:ee("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[k("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:k("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:k(Ce,{formData:R,setFormData:W,technicians:h,priceList:y,selectedId:C,isSubmitting:oe,currentUser:e,services:f,bankInfo:l.bankInfo,onClear:U,onSave:async()=>{E(!0);try{(await F(l.sheetUrl,"create",{...R,customer_name:R.customerName,work_items:R.workItems,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await u(),U(),alert("L\u01B0u phi\u1EBFu th\xE0nh c\xF4ng"))}catch{alert("L\u1ED7i khi l\u01B0u phi\u1EBFu")}finally{E(!1)}},onUpdate:async()=>{if(C){E(!0);try{await F(l.sheetUrl,"update",{...R,customer_name:R.customerName,work_items:R.workItems,id:C,created_at:f.find(t=>t.id===C)?.created_at}),await u(),U(),alert("C\u1EADp nh\u1EADt phi\u1EBFu th\xE0nh c\xF4ng")}catch{alert("L\u1ED7i khi c\u1EADp nh\u1EADt phi\u1EBFu")}finally{E(!1)}}},onDelete:async()=>{if(!(!C||!confirm("X\xF3a?"))){E(!0);try{await F(l.sheetUrl,"delete",{id:C,role:e.role}),await u(),U()}catch{alert("L\u1ED7i khi x\xF3a phi\u1EBFu")}finally{E(!1)}}}})})}),k("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:k(Ne,{data:z,loading:q,technicians:h,selectedId:C,onSelectRow:t=>{ae(t.id),W({...t}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:_,setFilters:{setDateFrom:t=>X(o=>({...o,dateFrom:t,viewAll:!1})),setDateTo:t=>X(o=>({...o,dateTo:t,viewAll:!1})),setSearchTerm:t=>X(o=>({...o,searchTerm:t})),setSearchTech:t=>X(o=>({...o,searchTech:t})),setViewAll:t=>X(o=>({...o,viewAll:t}))},currentUser:e,onInstallApp:s,installAvailable:!!J})})]})}),K&&k(Ie,{config:l,isAdmin:e.role==="admin",onClose:()=>S(!1),onSave:t=>{N(t),localStorage.setItem("diti_config",JSON.stringify(t)),S(!1)}})]}):k(be,{onLogin:Y,isLoading:q})},Pe=ft;import{jsx as _e}from"react/jsx-runtime";var Ee=document.getElementById("root");Ee&&vt(Ee).render(_e(xt.StrictMode,{children:_e(Pe,{})}));
