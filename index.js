import Mt from"react";import{createRoot as Ft}from"react-dom/client";import{useState as j,useEffect as Ut,useCallback as Fe,useMemo as Ot}from"react";import{Settings as _t,LogOut as Dt}from"lucide-react";import{useState as ve}from"react";import{User as Ve,Lock as Ye}from"lucide-react";import{jsx as Ke}from"react/jsx-runtime";var J=({className:e="",size:r=64})=>Ke("img",{src:"public/logo.png",alt:"Logo",width:r,height:r,className:`${e} object-contain`,loading:"eager",onError:o=>{let h=o.target;h.src.indexOf("public/")!==-1&&(h.src="logo.png")}});import{jsx as R,jsxs as Q}from"react/jsx-runtime";var Ne=({onLogin:e,isLoading:r})=>{let[o,h]=ve(""),[c,i]=ve("");return R("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:Q("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[r&&R("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:Q("div",{className:"relative flex flex-col items-center",children:[R(J,{size:80,className:"animate-pulse"}),R("div",{className:"mt-8 text-center",children:R("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),Q("div",{className:"flex flex-col items-center text-center space-y-3",children:[R(J,{size:64,className:r?"animate-pulse":""}),Q("div",{children:[R("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),R("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),Q("form",{onSubmit:w=>{w.preventDefault(),o&&c&&e(o,c)},className:"space-y-4",children:[Q("div",{className:"relative",children:[R(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),R("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:o,onChange:w=>h(w.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),Q("div",{className:"relative",children:[R(Ye,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),R("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:c,onChange:w=>i(w.target.value),required:!0,autoComplete:"current-password"})]}),R("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),R("div",{className:"pt-4 text-center border-t border-slate-50",children:R("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as ke,useMemo as We,useRef as ie}from"react";import{Search as Se,ChevronRight as Qe,Calendar as Ze,Filter as et,CheckCircle2 as tt,Phone as at,MapPin as st,Download as nt,Smartphone as rt}from"lucide-react";import*as te from"xlsx";var he=()=>new Date().toISOString().split("T")[0];var O=e=>{let r=typeof e=="number"?e:parseInt(String(e).replace(/\D/g,""),10);return isNaN(r)?"0":r.toLocaleString("vi-VN")},le=e=>{if(typeof e=="number")return e;let r=parseInt(e.replace(/\D/g,""),10);return isNaN(r)?0:r},we=e=>e.reduce((r,o)=>r+(o.total||0),0);function ye(e,r){let o;return(...h)=>{clearTimeout(o),o=setTimeout(()=>e(...h),r)}}import{Fragment as ot,jsx as m,jsxs as b}from"react/jsx-runtime";var Ce=({data:e,loading:r,technicians:o,selectedId:h,onSelectRow:c,filters:i,setFilters:x,currentUser:w,onInstallApp:v,installAvailable:N})=>{let z=w?.role==="admin",[F,E]=ke(i.searchTerm),[T,P]=ke(null),y=ie(null),D=ie(!1),X=ie({x:0,y:0}),L=ie(!1),q=We(()=>ye(n=>x.setSearchTerm(n),300),[x]),H=n=>{E(n.target.value),q(n.target.value)},G=()=>{if(e.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let n=e.map(S=>{let C=Number(S.revenue||0),re=Number(S.cost||0),de=C-re,pe=Number(S.debt||0);return{"Ng\xE0y nh\u1EADp":(S.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":S.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":S.phone,"\u0110\u1ECBa ch\u1EC9":S.address,"K\u1EF9 thu\u1EADt vi\xEAn":S.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":S.content,"Doanh thu (\u0111)":C,"Gi\xE1 v\u1ED1n (\u0111)":re,"L\u1EE3i nhu\u1EADn (\u0111)":de,"C\xF4ng n\u1EE3 (\u0111)":pe,"Tr\u1EA1ng th\xE1i":S.status}}),a=te.utils.json_to_sheet(n),l=te.utils.book_new();te.utils.book_append_sheet(l,a,"BaoCaoDichVu");let u=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;te.writeFile(l,u)},$=n=>{let a=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${n.customerName}
\u{1F4DE} S\u0110T: ${n.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${n.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${n.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${n.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(a).then(()=>{P("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>P(null),2e3)}).catch(l=>{console.error("L\u1ED7i copy:",l)})},Z=(n,a)=>{D.current=!1,L.current=!1,X.current={x:n.clientX,y:n.clientY},y.current=setTimeout(()=>{L.current||(D.current=!0,$(a))},600)},W=n=>{let a=Math.abs(n.clientX-X.current.x),l=Math.abs(n.clientY-X.current.y);(a>10||l>10)&&(L.current=!0,y.current&&(clearTimeout(y.current),y.current=null))},ee=(n,a)=>{y.current&&(clearTimeout(y.current),y.current=null),!D.current&&!L.current&&c(a)};return b("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[T&&b("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[m(tt,{size:16,className:"text-green-400"}),m("span",{className:"font-black text-[11px] uppercase tracking-widest",children:T})]}),b("div",{className:"space-y-3 mb-5 shrink-0",children:[b("div",{className:"relative group",children:[m(Se,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),m("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:F,onChange:H})]}),b("div",{className:"flex flex-wrap items-center gap-2",children:[b("button",{onClick:()=>x.setViewAll(!i.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${i.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[m(et,{size:14})," ",i.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!i.viewAll&&b("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[m(Ze,{size:12,className:"text-slate-400"}),m("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:i.dateFrom,onChange:n=>x.setDateFrom(n.target.value)}),m("span",{className:"text-slate-300",children:"/"}),m("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:i.dateTo,onChange:n=>x.setDateTo(n.target.value)})]}),b("div",{className:"flex items-center gap-2 ml-auto",children:[v&&b("button",{onClick:v,className:`h-[34px] px-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider ${N?"bg-slate-800 text-white hover:bg-black":"bg-slate-100 text-slate-500"}`,children:[m(rt,{size:14})," ",N?"C\xC0I \u0110\u1EB6T APP":"T\u1EA2I APP"]}),b("button",{onClick:G,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider",children:[m(nt,{size:14})," EXCEL"]})]})]})]}),m("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:r?b("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[m(J,{size:48,className:"animate-pulse"}),m("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):e.length===0?b("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[m(Se,{size:48,strokeWidth:1,className:"opacity-40"}),m("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):e.map(n=>b("div",{onPointerDown:a=>Z(a,n),onPointerMove:W,onPointerUp:a=>ee(a,n),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${h===n.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[b("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[b("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[m("span",{children:(n.created_at||"").split("T")[0]?.split("-")[2]||"--"}),b("span",{className:"opacity-60 text-[10px]",children:["T",(n.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),b("div",{className:"min-w-0 flex-1",children:[m("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:n.customerName}),m("div",{className:"flex flex-col gap-0.5 mb-1.5",children:b("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[m(at,{size:10,className:"text-blue-400"}),m("span",{children:n.phone}),n.address&&b(ot,{children:[m("span",{className:"text-slate-200",children:"|"}),m(st,{size:10,className:"text-red-400"}),m("span",{className:"truncate max-w-[120px]",children:n.address})]})]})}),b("div",{className:"flex items-center gap-2",children:[m("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:n.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),m("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${n.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":n.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:n.status})]})]})]}),b("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[b("div",{className:"text-right",children:[b("div",{className:"font-black text-slate-800 text-[14px]",children:[O(n.revenue),"\u0111"]}),Number(n.debt)>0&&b("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",O(n.debt)]})]}),m(Qe,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),h===n.id&&m("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},n.id))}),b("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[b("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[i.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",m("span",{className:"text-slate-700 ml-1 font-black",children:e.length})]}),b("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",O(e.reduce((n,a)=>n+Number(a.revenue||0),0)),"\u0111"]})]})]})};import{useState as ae,useRef as it,useMemo as Pe}from"react";import{Plus as ct,Trash2 as ze,Activity as dt,User as pt,Phone as ut,MapPin as mt,ReceiptText as gt,Share2 as ht,MessageSquare as bt,Download as xt,Sparkles as Ee,Loader2 as Ue,Camera as ft,ArrowLeft as vt}from"lucide-react";import Nt from"html2canvas";var be="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",Te={sheetUrl:be,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},ne=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{jsx as g,jsxs as A}from"react/jsx-runtime";var Ie=({formData:e,bankInfo:r})=>{let o=we(e.workItems),h=r?`https://img.vietqr.io/image/${r.bankId}-${r.accountNo}-compact2.png?amount=${o}&addInfo=DITICOMS SERVICE ${e.customerName.toUpperCase()}&accountName=${encodeURIComponent(r.accountName)}`:"";return A("div",{className:"w-[302px] bg-white p-6 mx-auto font-sans block",style:{height:"auto",minHeight:"fit-content"},children:[A("div",{className:"flex flex-col items-center text-center space-y-1 mb-5",children:[g(J,{size:52}),g("h1",{className:"text-xl font-black uppercase text-blue-600 tracking-tight",children:"DITICOMS SERVICE"}),g("p",{className:"text-[10px] text-slate-800 font-black uppercase tracking-widest",children:"Hotline: 0935.71.5151"}),g("div",{className:"w-12 h-0.5 bg-blue-600 rounded-full mt-1.5"})]}),A("div",{className:"space-y-1.5 mb-5 text-[11px]",children:[A("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[g("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"Kh\xE1ch h\xE0ng:"}),g("span",{className:"font-bold text-slate-900 text-right",children:e.customerName})]}),A("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[g("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"\u0110i\u1EC7n tho\u1EA1i:"}),g("span",{className:"font-bold text-slate-900 text-right",children:e.phone})]}),e.address&&A("div",{className:"flex justify-between border-b border-slate-50 pb-1 gap-2",children:[g("span",{className:"font-bold text-slate-400 uppercase text-[9px] shrink-0",children:"\u0110\u1ECBa ch\u1EC9:"}),g("span",{className:"font-bold text-slate-900 text-right truncate max-w-[180px]",children:e.address})]}),A("div",{className:"flex justify-between border-b border-slate-50 pb-1",children:[g("span",{className:"font-bold text-slate-400 uppercase text-[9px]",children:"Ng\xE0y t\u1EA1o:"}),g("span",{className:"font-bold text-slate-900",children:new Date().toLocaleDateString("vi-VN")})]})]}),A("div",{className:"space-y-3 mb-6",children:[g("div",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest border-l-2 border-blue-500 pl-2",children:"Chi ti\u1EBFt d\u1ECBch v\u1EE5"}),A("table",{className:"w-full text-[10px] border-collapse",children:[g("thead",{children:A("tr",{className:"text-[8px] text-slate-400 uppercase border-b border-slate-100",children:[g("th",{className:"pb-2 text-left font-black",children:"N\u1ED9i dung"}),g("th",{className:"pb-2 text-center font-black px-1",children:"SL"}),g("th",{className:"pb-2 text-right font-black px-1",children:"\u0110\u01A1n gi\xE1"}),g("th",{className:"pb-2 text-right font-black",children:"T.Ti\u1EC1n"})]})}),g("tbody",{className:"divide-y divide-slate-50",children:e.workItems.map((c,i)=>A("tr",{className:"align-middle",children:[g("td",{className:"py-2.5 text-slate-800 font-bold leading-tight pr-1",children:c.desc}),g("td",{className:"py-2.5 text-center text-slate-600 font-black px-1",children:c.qty}),g("td",{className:"py-2.5 text-right text-slate-600 font-medium whitespace-nowrap px-1",children:O(c.price)}),g("td",{className:"py-2.5 text-right font-black text-slate-900 whitespace-nowrap",children:O(c.total)})]},i))})]})]}),A("div",{className:"bg-slate-50 p-4 rounded-2xl flex justify-between items-center mb-6",children:[g("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-wider",children:"T\u1ED5ng c\u1ED9ng:"}),A("span",{className:"text-lg font-black text-blue-600",children:[O(e.revenue),"\u0111"]})]}),r&&e.status!=="Ho\xE0n th\xE0nh"&&A("div",{className:"flex flex-col items-center space-y-3 pt-4 border-t border-dashed border-slate-200",children:[g("div",{className:"bg-white p-2 rounded-xl border-2 border-slate-100 shadow-sm inline-block",children:g("img",{src:h,alt:"QR",className:"w-36 h-36 aspect-square object-contain mx-auto"})}),A("div",{className:"text-center",children:[A("p",{className:"text-[10px] font-black text-slate-800 uppercase tracking-tighter",children:[r.bankId," \u2022 ",r.accountNo]}),g("p",{className:"text-[8px] font-bold text-slate-400 uppercase mt-0.5",children:r.accountName})]})]}),g("div",{className:"text-center pt-6 border-t border-slate-50 mt-6",children:g("p",{className:"text-[9px] font-bold text-slate-400 uppercase italic tracking-widest",children:"Tr\xE2n tr\u1ECDng c\u1EA3m \u01A1n!"})})]})};import{GoogleGenAI as lt,Type as M}from"@google/genai";var Ae=()=>new lt({apiKey:process.env.API_KEY}),Le=async e=>{if(!e||e.length<5)throw new Error("M\xF4 t\u1EA3 qu\xE1 ng\u1EAFn \u0111\u1EC3 AI c\xF3 th\u1EC3 ch\u1EA9n \u0111o\xE1n.");let o=await Ae().models.generateContent({model:"gemini-3-flash-preview",contents:`Kh\xE1ch h\xE0ng b\xE1o l\u1ED7i: "${e}". H\xE3y ph\xE2n t\xEDch l\u1ED7i k\u1EF9 thu\u1EADt n\xE0y v\xE0 \u0111\u1EC1 xu\u1EA5t c\xE1c d\u1ECBch v\u1EE5 ho\u1EB7c linh ki\u1EC7n thay th\u1EBF k\xE8m \u0111\u01A1n gi\xE1 ph\xF9 h\u1EE3p t\u1EA1i th\u1ECB tr\u01B0\u1EDDng Vi\u1EC7t Nam hi\u1EC7n nay.`,config:{responseMimeType:"application/json",responseSchema:{type:M.OBJECT,properties:{suggestions:{type:M.ARRAY,items:{type:M.OBJECT,properties:{desc:{type:M.STRING,description:"T\xEAn linh ki\u1EC7n ho\u1EB7c d\u1ECBch v\u1EE5 \u0111\u1EC1 xu\u1EA5t"},qty:{type:M.NUMBER,description:"S\u1ED1 l\u01B0\u1EE3ng"},price:{type:M.NUMBER,description:"\u0110\u01A1n gi\xE1 d\u1EF1 ki\u1EBFn (VN\u0110)"}},required:["desc","qty","price"]}}},required:["suggestions"]},systemInstruction:"B\u1EA1n l\xE0 m\u1ED9t chuy\xEAn gia s\u1EEDa ch\u1EEFa m\xE1y t\xEDnh v\xE0 thi\u1EBFt b\u1ECB \u0111i\u1EC7n t\u1EED c\u1EE7a Diticoms. B\u1EA1n ch\u1EC9 tr\u1EA3 v\u1EC1 d\u1EEF li\u1EC7u d\u01B0\u1EDBi d\u1EA1ng JSON \u0111\u1EC3 h\u1EC7 th\u1ED1ng t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n v\xE0o h\xF3a \u0111\u01A1n."}});try{let h=o.text||"{}";return JSON.parse(h).suggestions||[]}catch(h){return console.error("L\u1ED7i ph\xE2n t\xEDch JSON t\u1EEB AI:",h),[]}},Re=async(e,r)=>{let o=Ae(),h=r.map(i=>({khach_hang:i.customerName,ngay:i.created_at?.split("T")[0],trang_thai:i.status,ky_thuat:i.technician,doanh_thu:Number(i.revenue||0),noi_dung:i.content})),c=await o.models.generateContent({model:"gemini-3-flash-preview",contents:`C\xE2u h\u1ECFi t\u1EEB qu\u1EA3n l\xFD: "${e}"

D\u1EEF li\u1EC7u phi\u1EBFu d\u1ECBch v\u1EE5 hi\u1EC7n c\xF3: ${JSON.stringify(h.slice(0,50))}`,config:{responseMimeType:"application/json",responseSchema:{type:M.OBJECT,properties:{answer:{type:M.STRING,description:"C\xE2u tr\u1EA3 l\u1EDDi ph\xE2n t\xEDch ho\u1EB7c th\u1ED1ng k\xEA"},filterUpdate:{type:M.OBJECT,properties:{searchTerm:{type:M.STRING,description:"T\u1EEB kh\xF3a c\u1EA7n t\xECm n\u1EBFu ng\u01B0\u1EDDi d\xF9ng y\xEAu c\u1EA7u l\u1ECDc"},status:{type:M.STRING,description:"Tr\u1EA1ng th\xE1i c\u1EA7n l\u1ECDc"},viewAll:{type:M.BOOLEAN,description:"B\u1EADt ch\u1EBF \u0111\u1ED9 xem t\u1EA5t c\u1EA3 n\u1EBFu c\u1EA7n"}}}},required:["answer"]},systemInstruction:"B\u1EA1n l\xE0 tr\u1EE3 l\xFD d\u1EEF li\u1EC7u th\xF4ng minh c\u1EE7a Diticoms. B\u1EA1n gi\xFAp nh\xE2n vi\xEAn th\u1ED1ng k\xEA doanh thu, t\xECm ki\u1EBFm kh\xE1ch h\xE0ng ho\u1EB7c l\u1ECDc tr\u1EA1ng th\xE1i c\xF4ng vi\u1EC7c. Tr\u1EA3 l\u1EDDi ng\u1EAFn g\u1ECDn, chuy\xEAn nghi\u1EC7p."}});try{let i=c.text||"{}";return JSON.parse(i)}catch{return{answer:"Xin l\u1ED7i, t\xF4i g\u1EB7p tr\u1EE5c tr\u1EB7c khi truy xu\u1EA5t d\u1EEF li\u1EC7u."}}};import{Fragment as Oe,jsx as s,jsxs as d}from"react/jsx-runtime";var _e=({formData:e,setFormData:r,technicians:o,priceList:h,selectedId:c,isSubmitting:i,currentUser:x,onSave:w,onUpdate:v,onDelete:N,onClear:z,services:F,bankInfo:E})=>{let T=x?.role==="admin",[P,y]=ae(!1),[D,X]=ae(!1),[L,q]=ae(!1),[H,G]=ae(null),[$,Z]=ae(null),[W,ee]=ae(!1),n=it(null),a=Pe(()=>{let t={};return F.forEach(p=>{let f=String(p.phone||"").trim();f.length>=3&&!t[f]&&(t[f]={name:p.customerName||"",address:p.address||""})}),Object.entries(t).map(([p,f])=>({phone:p,...f}))},[F]),l=Pe(()=>{let t=e.phone.trim();return t.length<3?[]:a.filter(p=>p.phone.includes(t)).slice(0,5)},[a,e.phone]),u=(t,p)=>{r(f=>({...f,[t]:p}))},S=t=>{r(p=>({...p,phone:t.phone,customerName:t.name,address:t.address})),y(!1)},C=(t,p,f)=>{r(U=>{let Y=[...U.workItems],oe={...Y[t],[p]:f},Be=le(p==="price"?f:oe.price),Xe=Number(p==="qty"?f:oe.qty);oe.total=Be*Xe,Y[t]=oe;let fe=Y.reduce((Ge,Je)=>Ge+(Number(Je.total)||0),0);return{...U,workItems:Y,revenue:fe,debt:U.status==="Ho\xE0n th\xE0nh"?0:fe}})},re=async()=>{if(!e.content)return ue("Vui l\xF2ng nh\u1EADp n\u1ED9i dung l\u1ED7i");ee(!0);try{let t=await Le(e.content);if(t&&t.length>0){let p=t.map(U=>({...U,total:U.qty*U.price})),f=p.reduce((U,Y)=>U+Y.total,0);r(U=>({...U,workItems:p,revenue:f,debt:U.status==="Ho\xE0n th\xE0nh"?0:f})),ue("AI \u0111\xE3 b\xE1o gi\xE1 ho\xE0n t\u1EA5t!")}}catch(t){alert(t.message)}finally{ee(!1)}},de=async()=>{if(n.current){q(!0);try{await new Promise(p=>setTimeout(p,600));let t=await Nt(n.current,{scale:3,useCORS:!0,backgroundColor:"#ffffff",logging:!1});G(t.toDataURL("image/png")),ue("\u0110\xE3 t\u1EA1o \u1EA3nh h\xF3a \u0111\u01A1n!")}catch{alert("L\u1ED7i khi t\u1EA1o \u1EA3nh h\xF3a \u0111\u01A1n. H\xE3y th\u1EED l\u1EA1i.")}finally{q(!1)}}},pe=async()=>{if(H)try{let t=await(await fetch(H)).blob(),p=new File([t],`Bill_${e.customerName}.png`,{type:"image/png"});navigator.share&&navigator.canShare?.({files:[p]})?await navigator.share({files:[p],title:"H\xF3a \u0111\u01A1n Diticoms",text:`H\xF3a \u0111\u01A1n kh\xE1ch h\xE0ng ${e.customerName}`}):xe()}catch(t){console.error(t)}},xe=()=>{if(!H)return;let t=document.createElement("a");t.download=`Hoadon_${e.customerName}.png`,t.href=H,t.click()},ue=t=>{Z(t),setTimeout(()=>Z(null),3e3)},me="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",ge="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return d("div",{className:"space-y-6",children:[$&&d("div",{className:"fixed top-24 left-1/2 -translate-x-1/2 z-[10001] bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full text-[11px] font-black uppercase tracking-widest animate-in fade-in zoom-in shadow-2xl flex items-center gap-2",children:[s(Ee,{size:14,className:"text-yellow-400"})," ",$]}),d("div",{className:"flex justify-between items-center",children:[d("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[s(dt,{size:18,className:"text-blue-500"})," ",c?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),c&&T&&s("button",{onClick:N,disabled:i,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:s(ze,{size:20})})]}),d("div",{className:"space-y-3",children:[d("div",{className:"relative",children:[s(ut,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),s("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:me,value:e.phone,onChange:t=>{u("phone",t.target.value),y(!0)},onFocus:()=>y(!0),onBlur:()=>setTimeout(()=>y(!1),200)}),P&&l.length>0&&s("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-200 shadow-2xl z-[60] max-h-56 overflow-auto rounded-2xl mt-1",children:l.map((t,p)=>d("div",{onMouseDown:()=>S(t),className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 transition-colors flex justify-between",children:[s("span",{className:"font-black text-blue-600 text-xs",children:t.phone}),s("span",{className:"font-bold text-slate-800 text-xs",children:t.name})]},p))})]}),d("div",{className:"relative",children:[s(pt,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),s("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:me,value:e.customerName,onChange:t=>u("customerName",t.target.value)})]}),d("div",{className:"relative",children:[s(mt,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),s("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:me,value:e.address,onChange:t=>u("address",t.target.value)})]}),d("div",{className:"relative group",children:[s(bt,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),s("textarea",{placeholder:"M\xF4 t\u1EA3 l\u1ED7i c\u1EE7a kh\xE1ch h\xE0ng...",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl min-h-[100px] focus:bg-white focus:border-blue-400 outline-none transition-all",value:e.content,onChange:t=>u("content",t.target.value)}),d("button",{onClick:re,disabled:W||!e.content,className:`absolute right-3 bottom-3 flex items-center gap-2 px-4 py-2 rounded-xl font-black text-[10px] uppercase tracking-wider transition-all shadow-md ${W?"bg-slate-200 text-slate-400":"bg-gradient-to-r from-purple-600 to-indigo-600 text-white"}`,children:[W?s(Ue,{size:14,className:"animate-spin"}):s(Ee,{size:14})," AI Ch\u1EA9n \u0111o\xE1n"]})]}),d("div",{className:"grid grid-cols-2 gap-3",children:[s("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none",value:e.status,onChange:t=>u("status",t.target.value),children:ne.map(t=>s("option",{value:t,children:t},t))}),d("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none disabled:opacity-50",value:e.technician,onChange:t=>u("technician",t.target.value),disabled:!T,children:[s("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),o.map(t=>s("option",{value:t,children:t},t))]})]}),d("div",{className:"pt-2",children:[d("div",{className:"flex justify-between items-center mb-2 px-1",children:[s("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"Danh s\xE1ch d\u1ECBch v\u1EE5"}),s("button",{onClick:()=>r(t=>({...t,workItems:[...t.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:s(ct,{size:18})})]}),s("div",{className:"space-y-2",children:e.workItems.map((t,p)=>d("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 group hover:border-blue-100 transition-all",children:[s("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5/linh ki\u1EC7n...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200 text-[13px]",value:t.desc,onChange:f=>C(p,"desc",f.target.value)}),d("div",{className:"flex gap-2 text-[11px] font-bold",children:[d("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg flex items-center gap-1",children:["SL: ",s("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:t.qty,onChange:f=>C(p,"qty",f.target.value)})]}),s("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:s("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:O(t.price),onChange:f=>C(p,"price",f.target.value)})}),s("button",{onClick:()=>r(f=>({...f,workItems:f.workItems.filter((U,Y)=>Y!==p)})),className:"text-slate-300 hover:text-red-400 p-1",children:s(ze,{size:16})})]})]},p))})]}),d("div",{className:"pt-4 grid grid-cols-3 gap-3 bg-slate-100/40 p-4 rounded-[32px] border border-slate-100",children:[d("div",{className:"text-center",children:[s("span",{className:"text-[9px] font-black text-blue-500 uppercase",children:"Doanh thu"}),s("input",{type:"text",className:`${ge} text-blue-600`,value:O(e.revenue),readOnly:!0})]}),d("div",{className:"text-center",children:[s("span",{className:"text-[9px] font-black text-orange-500 uppercase",children:"Gi\xE1 v\u1ED1n"}),s("input",{type:"text",className:`${ge} text-orange-600`,value:O(e.cost),onChange:t=>u("cost",le(t.target.value))})]}),d("div",{className:"text-center",children:[s("span",{className:"text-[9px] font-black text-red-500 uppercase",children:"C\xF4ng n\u1EE3"}),s("input",{type:"text",className:`${ge} text-red-600`,value:O(e.debt),onChange:t=>u("debt",le(t.target.value))})]})]})]}),s("div",{className:"grid grid-cols-2 gap-3 pt-4",children:c?d(Oe,{children:[s("button",{disabled:i,onClick:v,className:"bg-blue-600 text-white font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),s("button",{onClick:z,className:"bg-slate-100 text-slate-600 font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):s("button",{disabled:i,onClick:w,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl shadow-lg uppercase tracking-widest text-[12px] active:scale-95 transition-all",children:i?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),c&&d("button",{onClick:()=>{X(!0),G(null)},className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-black py-4 rounded-2xl uppercase shadow-md flex items-center justify-center gap-3 text-[12px] transition-all",children:[s(gt,{size:20})," XU\u1EA4T H\xD3A \u0110\u01A0N"]}),D&&s("div",{className:"fixed inset-0 z-[10000] bg-black/90 flex flex-col p-4 animate-in fade-in",children:d("div",{className:"max-w-md w-full mx-auto flex flex-col h-full",children:[d("div",{className:"flex justify-between items-center mb-6",children:[d("button",{onClick:()=>X(!1),className:"flex items-center gap-2 text-white/70 font-bold uppercase text-[10px] tracking-widest hover:text-white transition-colors",children:[s(vt,{size:16})," Quay l\u1EA1i"]}),s("h3",{className:"text-white font-black uppercase tracking-[0.2em] text-xs",children:"H\xF3a \u0111\u01A1n d\u1ECBch v\u1EE5"}),s("div",{className:"w-10"})]}),s("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-slate-100 rounded-[40px] p-4 shadow-2xl relative flex flex-col items-center",children:H?d("div",{className:"animate-in zoom-in duration-300 w-full flex flex-col items-center",children:[s("img",{src:H,alt:"H\xF3a \u0111\u01A1n",className:"w-full rounded-2xl shadow-xl border border-white/50 mb-8"}),d("div",{className:"w-full space-y-3",children:[d("button",{onClick:pe,className:"w-full bg-blue-600 text-white font-black py-5 rounded-3xl uppercase tracking-widest flex items-center justify-center gap-3 shadow-lg active:scale-95 transition-all",children:[s(ht,{size:20})," CHIA S\u1EBA H\xD3A \u0110\u01A0N"]}),d("button",{onClick:xe,className:"w-full bg-slate-800 text-white font-black py-4 rounded-3xl uppercase tracking-widest flex items-center justify-center gap-3 shadow-lg active:scale-95 transition-all",children:[s(xt,{size:18})," T\u1EA2I \u1EA2NH XU\u1ED0NG"]}),s("button",{onClick:()=>G(null),className:"w-full text-slate-400 font-bold py-3 uppercase text-[10px] tracking-widest",children:"CH\u1EE4P L\u1EA0I \u1EA2NH"})]})]}):d(Oe,{children:[s("div",{ref:n,className:"bg-white rounded-3xl overflow-hidden shadow-sm p-1",children:s(Ie,{formData:e,bankInfo:E})}),s("div",{className:"w-full mt-8 px-4",children:d("button",{onClick:de,disabled:L,className:"w-full bg-blue-600 text-white font-black py-5 rounded-3xl uppercase tracking-widest flex items-center justify-center gap-4 shadow-2xl active:scale-95 transition-all",children:[L?s(Ue,{size:24,className:"animate-spin"}):s(ft,{size:24})," T\u1EA0O \u1EA2NH H\xD3A \u0110\u01A0N"]})})]})})]})})]})};import{useState as wt}from"react";import{X as yt,Save as kt,CreditCard as St,RefreshCw as Ct,Loader2 as Tt}from"lucide-react";import{jsx as _,jsxs as K}from"react/jsx-runtime";var De=({config:e,onSave:r,onClose:o,isAdmin:h,onCheckUpdate:c,isCheckingUpdate:i})=>{let[x,w]=wt({...e});return _("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:K("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[K("div",{className:"flex justify-between items-center",children:[_("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),_("button",{onClick:o,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:_(yt,{size:20})})]}),K("div",{className:"space-y-4",children:[K("div",{className:"space-y-3",children:[K("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[_(St,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),K("div",{className:"grid grid-cols-2 gap-3",children:[_("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:x.bankInfo?.bankId,onChange:v=>w(N=>({...N,bankInfo:{...N.bankInfo,bankId:v.target.value}}))}),_("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:x.bankInfo?.accountNo,onChange:v=>w(N=>({...N,bankInfo:{...N.bankInfo,accountNo:v.target.value}}))}),_("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:x.bankInfo?.accountName,onChange:v=>w(N=>({...N,bankInfo:{...N.bankInfo,accountName:v.target.value.toUpperCase()}}))})]})]}),c&&_("div",{className:"pt-2",children:K("button",{onClick:c,disabled:i,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[i?_(Tt,{size:14,className:"animate-spin"}):_(Ct,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),K("div",{className:"flex gap-3",children:[K("button",{onClick:()=>r(x),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[_(kt,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),_("button",{onClick:o,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};import{useState as ce,useRef as It,useEffect as At}from"react";import{Send as Lt,X as He,Sparkles as Rt,Loader2 as Pt,Bot as zt}from"lucide-react";import{Fragment as Et,jsx as k,jsxs as B}from"react/jsx-runtime";var Me=({services:e,onApplyFilter:r})=>{let[o,h]=ce(!1),[c,i]=ce(""),[x,w]=ce([{role:"bot",text:"Ch\xE0o b\u1EA1n! T\xF4i c\xF3 th\u1EC3 gi\xFAp b\u1EA1n t\xECm ki\u1EBFm kh\xE1ch h\xE0ng, l\u1ECDc tr\u1EA1ng th\xE1i ho\u1EB7c th\u1ED1ng k\xEA doanh thu nhanh ch\xF3ng. B\u1EA1n c\u1EA7n g\xEC?"}]),[v,N]=ce(!1),z=It(null);At(()=>{z.current&&(z.current.scrollTop=z.current.scrollHeight)},[x,v]);let F=async E=>{if(E?.preventDefault(),!c.trim()||v)return;let T=c.trim();w(P=>[...P,{role:"user",text:T}]),i(""),N(!0);try{let P=await Re(T,e);w(y=>[...y,{role:"bot",text:P.answer}]),P.filterUpdate&&r(P.filterUpdate)}catch(P){w(y=>[...y,{role:"bot",text:"L\u1ED7i k\u1EBFt n\u1ED1i AI: "+P.message}])}finally{N(!1)}};return B("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col items-end",children:[o&&B("div",{className:"w-[340px] h-[480px] bg-white rounded-[32px] shadow-2xl border border-slate-100 flex flex-col mb-4 animate-in slide-in-from-bottom overflow-hidden",children:[B("div",{className:"bg-blue-600 p-5 text-white flex justify-between items-center shrink-0",children:[B("div",{className:"flex items-center gap-3",children:[k("div",{className:"p-2 bg-white/20 rounded-xl",children:k(Rt,{size:18})}),B("div",{children:[k("h3",{className:"font-black text-xs uppercase tracking-widest",children:"DITI AI Assistant"}),B("div",{className:"flex items-center gap-1.5 mt-0.5",children:[k("div",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),k("span",{className:"text-[9px] font-bold text-blue-100 uppercase",children:"S\u1EB5n s\xE0ng h\u1ED7 tr\u1EE3"})]})]})]}),k("button",{onClick:()=>h(!1),className:"p-2 hover:bg-black/10 rounded-full transition-colors",children:k(He,{size:20})})]}),B("div",{ref:z,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50 custom-scrollbar",children:[x.map((E,T)=>k("div",{className:`flex ${E.role==="user"?"justify-end":"justify-start"}`,children:k("div",{className:`max-w-[85%] p-3.5 rounded-2xl text-[12px] font-medium shadow-sm leading-relaxed ${E.role==="user"?"bg-blue-600 text-white rounded-br-none":"bg-white text-slate-800 border border-slate-100 rounded-bl-none"}`,children:E.text})},T)),v&&k("div",{className:"flex justify-start",children:B("div",{className:"bg-white border border-slate-100 p-3.5 rounded-2xl rounded-bl-none flex items-center gap-3",children:[k(Pt,{size:14,className:"animate-spin text-blue-600"}),k("span",{className:"text-[11px] font-black text-slate-400 uppercase tracking-widest",children:"\u0110ang ph\xE2n t\xEDch..."})]})})]}),B("form",{onSubmit:F,className:"p-4 bg-white border-t border-slate-50 flex gap-2",children:[k("input",{type:"text",placeholder:"Nh\u1EADp y\xEAu c\u1EA7u (VD: Th\u1ED1ng k\xEA doanh thu)",className:"flex-1 bg-slate-50 border-none rounded-xl px-4 py-3 text-xs font-medium focus:ring-2 focus:ring-blue-500/20 transition-all outline-none",value:c,onChange:E=>i(E.target.value),disabled:v}),k("button",{type:"submit",disabled:v||!c.trim(),className:"bg-blue-600 text-white p-3 rounded-xl shadow-lg shadow-blue-100 active:scale-90 transition-all disabled:opacity-50",children:k(Lt,{size:18})})]})]}),k("button",{onClick:()=>h(!o),className:`w-14 h-14 rounded-full flex items-center justify-center shadow-2xl transition-all active:scale-90 group relative ${o?"bg-slate-800 text-white":"bg-blue-600 text-white hover:bg-blue-700"}`,children:o?k(He,{size:24}):B(Et,{children:[k(zt,{size:28}),k("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full border-2 border-white flex items-center justify-center text-[10px] font-bold",children:"1"})]})})]})};async function V(e,r,o={},h=0){if(!e||!e.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let x=new AbortController,w=setTimeout(()=>x.abort(),2e4),v=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...o,action:r}),signal:x.signal});if(clearTimeout(w),!v.ok)throw new Error(`HTTP ${v.status}`);let N=await v.text();if(!N)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let z=N.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(z?z[0]:N)}catch(x){if(h<1&&(x.name==="AbortError"||x.message.includes("HTTP")))return V(e,r,o,h+1);throw x}}import{jsx as I,jsxs as se}from"react/jsx-runtime";var Ht=()=>{let[e,r]=j(()=>{let a=localStorage.getItem("diti_user");return a?JSON.parse(a):null}),[o,h]=j(()=>{let a=localStorage.getItem("diti_config");return{...a?JSON.parse(a):Te,sheetUrl:be}}),[c,i]=j(()=>{let a=localStorage.getItem("diti_services_cache");return a?JSON.parse(a):[]}),[x,w]=j([]),[v,N]=j([]),[z,F]=j(!1),[E,T]=j(!1),[P,y]=j(!1),[D,X]=j(null),[L,q]=j({dateFrom:he(),dateTo:he(),searchTerm:"",searchTech:"",viewAll:!1}),[H,G]=j({customerName:"",phone:"",address:"",status:ne[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0}),$=Fe(async()=>{if(e){F(c.length===0);try{let[a,l,u]=await Promise.all([V(o.sheetUrl,"read"),V(o.sheetUrl,"read_settings"),V(o.sheetUrl,"read_pricelist")]);if(Array.isArray(a)){let S=a.map(C=>({...C,customerName:C.customer_name||C.customerName||"",workItems:typeof C.work_items=="string"?JSON.parse(C.work_items):C.work_items||[],revenue:Number(C.revenue||0),cost:Number(C.cost||0),debt:Number(C.debt||0),created_at:C.created_at||C.date||new Date().toISOString()}));i(S),localStorage.setItem("diti_services_cache",JSON.stringify(S))}if(l?.technicians){let S=typeof l.technicians=="string"?JSON.parse(l.technicians):l.technicians;w(Array.isArray(S)?S:[])}Array.isArray(u)&&N(u)}catch(a){console.error(a)}finally{F(!1)}}},[e,o.sheetUrl,c.length]);Ut(()=>{e&&$()},[e,$]);let Z=Ot(()=>{let a=[...c];if(e?.role!=="admin"&&e?.associatedTech&&(a=a.filter(l=>l.technician===e.associatedTech)),L.viewAll||(a=a.filter(l=>{let u=(l.created_at||"").split("T")[0];return u>=L.dateFrom&&u<=L.dateTo})),L.searchTerm){let l=L.searchTerm.toLowerCase();a=a.filter(u=>(u.customerName||"").toLowerCase().includes(l)||(u.phone||"").includes(l)||(u.address||"").toLowerCase().includes(l))}return a.sort((l,u)=>new Date(u.created_at).getTime()-new Date(l.created_at).getTime())},[c,L,e]),W=async(a,l)=>{F(!0);try{let u=await V(o.sheetUrl,"login",{username:a,password:l});u?.status==="success"&&u.user?(r(u.user),localStorage.setItem("diti_user",JSON.stringify(u.user)),n(u.user)):alert(u?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{F(!1)}},ee=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(r(null),localStorage.clear(),window.location.reload())},n=Fe((a=e)=>{X(null),G({customerName:"",phone:"",address:"",status:ne[0],technician:a?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[e]);return e?se("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[I("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:se("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[se("div",{className:"flex items-center gap-3",children:[I(J,{size:32}),se("div",{children:[I("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),I("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:e.name})]})]}),se("div",{className:"flex gap-2",children:[I("button",{onClick:()=>y(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:I(_t,{size:18})}),I("button",{onClick:ee,className:"p-2 text-red-400",children:I(Dt,{size:18})})]})]})}),I("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:se("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[I("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:I("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:I(_e,{formData:H,setFormData:G,technicians:x,priceList:v,selectedId:D,isSubmitting:E,currentUser:e,services:c,bankInfo:o.bankInfo,onClear:()=>n(),onSave:async()=>{T(!0);try{(await V(o.sheetUrl,"create",{...H,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await $(),n())}catch{alert("L\u1ED7i l\u01B0u phi\u1EBFu")}finally{T(!1)}},onUpdate:async()=>{if(D){T(!0);try{await V(o.sheetUrl,"update",{...H,id:D}),await $(),n()}catch{alert("L\u1ED7i c\u1EADp nh\u1EADt")}finally{T(!1)}}},onDelete:async()=>{if(!(!D||!confirm("X\xF3a phi\u1EBFu n\xE0y?"))){T(!0);try{await V(o.sheetUrl,"delete",{id:D,role:e.role}),await $(),n()}catch{alert("L\u1ED7i x\xF3a")}finally{T(!1)}}}})})}),I("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:I(Ce,{data:Z,loading:z,technicians:x,selectedId:D,onSelectRow:a=>{X(a.id),G({...a}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:L,setFilters:{setDateFrom:a=>q(l=>({...l,dateFrom:a,viewAll:!1})),setDateTo:a=>q(l=>({...l,dateTo:a,viewAll:!1})),setSearchTerm:a=>q(l=>({...l,searchTerm:a})),setViewAll:a=>q(l=>({...l,viewAll:a}))},currentUser:e})})]})}),I(Me,{services:c,onApplyFilter:a=>q(l=>({...l,...a}))}),P&&I(De,{config:o,isAdmin:e.role==="admin",onClose:()=>y(!1),onSave:a=>{h(a),localStorage.setItem("diti_config",JSON.stringify(a)),y(!1)}})]}):I(Ne,{onLogin:W,isLoading:z})},je=Ht;import{jsx as $e}from"react/jsx-runtime";var jt=()=>{typeof window.removeSplash=="function"&&window.removeSplash()},qe=document.getElementById("root");qe&&(jt(),Ft(qe).render($e(Mt.StrictMode,{children:$e(je,{})})));
