import vt from"react";import{createRoot as Nt}from"react-dom/client";import{useState as P,useEffect as Le,useCallback as Pe,useMemo as gt}from"react";import{Settings as bt,LogOut as ft}from"lucide-react";import{useState as be}from"react";import{User as He,Lock as Fe}from"lucide-react";import{jsx as Oe}from"react/jsx-runtime";var J=({className:e="",size:r=64})=>Oe("img",{src:"public/logo.png",alt:"Logo",width:r,height:r,className:`${e} object-contain`,loading:"eager",onError:l=>{let N=l.target;N.src.indexOf("public/")!==-1&&(N.src="logo.png")}});import{jsx as C,jsxs as $}from"react/jsx-runtime";var fe=({onLogin:e,isLoading:r})=>{let[l,N]=be(""),[p,b]=be("");return C("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6 font-sans text-sm",children:$("div",{className:"max-w-md w-full bg-white rounded-[32px] shadow-lg border border-slate-100 p-8 space-y-8 relative overflow-hidden",children:[r&&C("div",{className:"absolute inset-0 bg-white/98 z-[100] flex flex-col items-center justify-center space-y-6",children:$("div",{className:"relative flex flex-col items-center",children:[C(J,{size:80,className:"animate-pulse"}),C("div",{className:"mt-8 text-center",children:C("p",{className:"font-black text-blue-600 uppercase tracking-[0.3em] text-[10px]",children:"\u0110ANG T\u1EA2I..."})})]})}),$("div",{className:"flex flex-col items-center text-center space-y-3",children:[C(J,{size:64,className:r?"animate-pulse":""}),$("div",{children:[C("h1",{className:"text-xl font-bold text-slate-800 uppercase tracking-tight",children:"DITICOMS SERVICE"}),C("p",{className:"font-bold text-slate-400 uppercase tracking-widest text-[10px] mt-1",children:"H\u1EC7 th\u1ED1ng qu\u1EA3n l\xFD n\u1ED9i b\u1ED9"})]})]}),$("form",{onSubmit:w=>{w.preventDefault(),l&&p&&e(l,p)},className:"space-y-4",children:[$("div",{className:"relative",children:[C(He,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),C("input",{type:"text",placeholder:"T\xEAn \u0111\u0103ng nh\u1EADp",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:l,onChange:w=>N(w.target.value),required:!0,autoComplete:"username",spellCheck:"false"})]}),$("div",{className:"relative",children:[C(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:18}),C("input",{type:"password",placeholder:"M\u1EADt kh\u1EA9u",className:"w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:bg-white focus:border-blue-400 font-medium",value:p,onChange:w=>b(w.target.value),required:!0,autoComplete:"current-password"})]}),C("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white font-bold py-5 rounded-2xl shadow-md active:bg-blue-700 transition-colors uppercase tracking-widest mt-2",children:"\u0110\u0102NG NH\u1EACP"})]}),C("div",{className:"pt-4 text-center border-t border-slate-50",children:C("p",{className:"font-bold text-slate-300 uppercase tracking-widest text-[9px]",children:"v1.0.44 \u2022 diticoms.vn"})})]})})};import{useState as ve,useMemo as qe,useRef as ie}from"react";import{Search as Ne,ChevronRight as Ke,Calendar as Xe,Filter as Ge,CheckCircle2 as je,Phone as Je,MapPin as $e,Download as Ve,Smartphone as Be}from"lucide-react";import*as Z from"xlsx";var pe=()=>new Date().toISOString().split("T")[0];var O=e=>{let r=typeof e=="number"?e:parseInt(String(e).replace(/\D/g,""),10);return isNaN(r)?"0":r.toLocaleString("vi-VN")},le=e=>{if(typeof e=="number")return e;let r=parseInt(e.replace(/\D/g,""),10);return isNaN(r)?0:r};function xe(e,r){let l;return(...N)=>{clearTimeout(l),l=setTimeout(()=>e(...N),r)}}import{Fragment as Ye,jsx as i,jsxs as d}from"react/jsx-runtime";var we=({data:e,loading:r,technicians:l,selectedId:N,onSelectRow:p,filters:b,setFilters:g,currentUser:w,onInstallApp:y,installAvailable:v})=>{let q=w?.role==="admin",[D,oe]=ve(b.searchTerm),[_,V]=ve(null),S=ie(null),te=ie(!1),B=ie({x:0,y:0}),T=ie(!1),ae=qe(()=>xe(s=>g.setSearchTerm(s),300),[g]),j=s=>{oe(s.target.value),ae(s.target.value)},se=()=>{if(e.length===0)return alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t!");let s=e.map(I=>{let U=Number(I.revenue||0),a=Number(I.cost||0),o=U-a,f=Number(I.debt||0);return{"Ng\xE0y nh\u1EADp":(I.created_at||"").split("T")[0],"Kh\xE1ch h\xE0ng":I.customerName,"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i":I.phone,"\u0110\u1ECBa ch\u1EC9":I.address,"K\u1EF9 thu\u1EADt vi\xEAn":I.technician||"Ch\u01B0a ph\xE2n c\xF4ng","N\u1ED9i dung d\u1ECBch v\u1EE5":I.content,"Doanh thu (\u0111)":U,"Gi\xE1 v\u1ED1n (\u0111)":a,"L\u1EE3i nhu\u1EADn (\u0111)":o,"C\xF4ng n\u1EE3 (\u0111)":f,"Tr\u1EA1ng th\xE1i":I.status}}),m=Z.utils.json_to_sheet(s),z=Z.utils.book_new();Z.utils.book_append_sheet(z,m,"BaoCaoDichVu");let W=`Diticoms_Report_${new Date().toISOString().split("T")[0]}.xlsx`;Z.writeFile(z,W)},E=s=>{let m=`\u{1F4CC} TH\xD4NG TIN KH\xC1CH H\xC0NG
----------------------
\u{1F464} Kh\xE1ch: ${s.customerName}
\u{1F4DE} S\u0110T: ${s.phone}
\u{1F4CD} \u0110\u1ECBa ch\u1EC9: ${s.address||"Kh\xF4ng c\xF3"}
\u{1F4AC} Y\xEAu c\u1EA7u: ${s.content||"S\u1EEDa ch\u1EEFa thi\u1EBFt b\u1ECB"}
----------------------
\u{1F527} K\u1EF9 thu\u1EADt: ${s.technician||"Ch\u01B0a ph\xE2n c\xF4ng"}`;navigator.clipboard.writeText(m).then(()=>{V("\u0110\xE3 ch\xE9p th\xF4ng tin!"),setTimeout(()=>V(null),2e3)}).catch(z=>{console.error("L\u1ED7i copy:",z)})},K=(s,m)=>{te.current=!1,T.current=!1,B.current={x:s.clientX,y:s.clientY},S.current=setTimeout(()=>{T.current||(te.current=!0,E(m))},600)},R=s=>{let m=Math.abs(s.clientX-B.current.x),z=Math.abs(s.clientY-B.current.y);(m>10||z>10)&&(T.current=!0,S.current&&(clearTimeout(S.current),S.current=null))},Y=(s,m)=>{S.current&&(clearTimeout(S.current),S.current=null),!te.current&&!T.current&&p(m)};return d("div",{className:"bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col font-sans text-sm relative overflow-hidden lg:h-full",children:[_&&d("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[100] bg-slate-900/95 backdrop-blur-md text-white px-5 py-2.5 rounded-full flex items-center gap-2 shadow-2xl animate-in fade-in zoom-in duration-200",children:[i(je,{size:16,className:"text-green-400"}),i("span",{className:"font-black text-[11px] uppercase tracking-widest",children:_})]}),d("div",{className:"space-y-3 mb-5 shrink-0",children:[d("div",{className:"relative group",children:[i(Ne,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-blue-500 transition-colors",size:18}),i("input",{type:"text",placeholder:"T\xECm t\xEAn, S\u0110T ho\u1EB7c \u0111\u1ECBa ch\u1EC9...",className:"w-full pl-11 pr-4 py-2.5 bg-slate-50 border border-slate-50 rounded-xl outline-none focus:bg-white focus:border-blue-100 transition-all font-medium",value:D,onChange:j})]}),d("div",{className:"flex flex-wrap items-center gap-2",children:[d("button",{onClick:()=>g.setViewAll(!b.viewAll),className:`px-3 py-1.5 rounded-xl font-bold transition-all flex items-center gap-1.5 border shadow-sm text-[11px] ${b.viewAll?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,children:[i(Ge,{size:14})," ",b.viewAll?"T\u1EA5t c\u1EA3":"L\u1ECDc Ng\xE0y"]}),!b.viewAll&&d("div",{className:"flex items-center gap-1 bg-white rounded-xl px-2 border border-slate-200 h-[34px] shadow-sm",children:[i(Xe,{size:12,className:"text-slate-400"}),i("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateFrom,onChange:s=>g.setDateFrom(s.target.value)}),i("span",{className:"text-slate-300",children:"/"}),i("input",{type:"date",className:"bg-transparent font-bold text-slate-600 outline-none w-[88px] text-[10px]",value:b.dateTo,onChange:s=>g.setDateTo(s.target.value)})]}),d("div",{className:"flex items-center gap-2 ml-auto",children:[y&&d("button",{onClick:y,className:`h-[34px] px-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider ${v?"bg-slate-800 text-white hover:bg-black":"bg-slate-100 text-slate-500"}`,children:[i(Be,{size:14})," ",v?"C\xC0I \u0110\u1EB6T APP":"T\u1EA2I APP"]}),d("button",{onClick:se,className:"h-[34px] px-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-sm active:scale-95 text-[10px] uppercase tracking-wider",children:[i(Ve,{size:14})," EXCEL"]})]})]})]}),i("div",{className:"flex-1 lg:overflow-y-auto space-y-2 pr-1 custom-scrollbar pb-2",children:r?d("div",{className:"py-12 flex flex-col items-center justify-center space-y-6",children:[i(J,{size:48,className:"animate-pulse"}),i("span",{className:"font-black text-slate-400 uppercase tracking-[0.2em] text-[10px]",children:"\u0110ang t\u1EA3i..."})]}):e.length===0?d("div",{className:"py-12 flex flex-col items-center justify-center text-slate-300 space-y-3",children:[i(Ne,{size:48,strokeWidth:1,className:"opacity-40"}),i("span",{className:"font-black uppercase tracking-widest text-[11px]",children:"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"})]}):e.map(s=>d("div",{onPointerDown:m=>K(m,s),onPointerMove:R,onPointerUp:m=>Y(m,s),className:`p-4 rounded-[24px] border transition-all cursor-pointer flex items-center justify-between group relative select-none touch-pan-y ${N===s.id?"bg-blue-50/80 border-blue-100 ring-2 ring-blue-50":"bg-white border-slate-50 hover:border-slate-200 hover:bg-slate-50/50"}`,children:[d("div",{className:"flex gap-3.5 items-center flex-1 min-w-0",children:[d("div",{className:"h-11 w-11 bg-slate-100/50 rounded-2xl flex flex-col items-center justify-center font-bold text-slate-500 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors text-[13px] shrink-0 shadow-sm",children:[i("span",{children:(s.created_at||"").split("T")[0]?.split("-")[2]||"--"}),d("span",{className:"opacity-60 text-[10px]",children:["T",(s.created_at||"").split("T")[0]?.split("-")[1]||"--"]})]}),d("div",{className:"min-w-0 flex-1",children:[i("div",{className:"font-bold text-slate-800 leading-tight mb-0.5 truncate text-[14px]",children:s.customerName}),i("div",{className:"flex flex-col gap-0.5 mb-1.5",children:d("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 font-medium",children:[i(Je,{size:10,className:"text-blue-400"}),i("span",{children:s.phone}),s.address&&d(Ye,{children:[i("span",{className:"text-slate-200",children:"|"}),i($e,{size:10,className:"text-red-400"}),i("span",{className:"truncate max-w-[120px]",children:s.address})]})]})}),d("div",{className:"flex items-center gap-2",children:[i("span",{className:"font-black text-slate-400 uppercase tracking-tighter text-[10px] truncate max-w-[90px]",children:s.technician||"CH\u01AFA PH\xC2N C\xD4NG"}),i("span",{className:`font-black px-2 py-0.5 rounded-lg uppercase tracking-widest text-[9px] ${s.status==="Ho\xE0n th\xE0nh"?"bg-green-100 text-green-600":s.status==="\u0110ang s\u1EEDa ch\u1EEFa"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"}`,children:s.status})]})]})]}),d("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[d("div",{className:"text-right",children:[d("div",{className:"font-black text-slate-800 text-[14px]",children:[O(s.revenue),"\u0111"]}),Number(s.debt)>0&&d("div",{className:"font-black text-red-500 text-[10px] mt-0.5",children:["N\u1EE3: ",O(s.debt)]})]}),i(Ke,{size:18,className:"text-slate-200 group-hover:text-blue-400 transition-all"})]}),N===s.id&&i("div",{className:"absolute left-0 top-4 bottom-4 w-1 bg-blue-500 rounded-r-full"})]},s.id))}),d("div",{className:"mt-2 pt-4 border-t border-slate-50 flex flex-wrap justify-between items-center gap-2 px-1 shrink-0",children:[d("span",{className:"font-black text-slate-400 uppercase tracking-widest text-[10px]",children:[b.viewAll?"T\u1ED5ng c\u1ED9ng: ":"Trong ng\xE0y: ",i("span",{className:"text-slate-700 ml-1 font-black",children:e.length})]}),d("span",{className:"font-black text-blue-600 bg-blue-50 px-4 py-2 rounded-2xl uppercase tracking-[0.1em] border border-blue-100 text-[11px] shadow-sm",children:["Thu: ",O(e.reduce((s,m)=>s+Number(m.revenue||0),0)),"\u0111"]})]})]})};import{useState as G,useRef as Qe,useMemo as ke}from"react";import{Plus as et,Trash2 as Ce,Activity as tt,User as at,Phone as st,MapPin as nt,ReceiptText as ot,MessageSquare as rt,Sparkles as Te,Loader2 as lt}from"lucide-react";var ue="https://script.google.com/macros/s/AKfycbydOG7vnrXSXF6o0tLU843G_P2Jl9iOCcyuGAI7gRqhLrgmCvMgGj84HKPcfLFf1ZJL/exec",ye={sheetUrl:ue,bankInfo:{bankId:"TCB",accountNo:"7929499999",accountName:"NGUYEN PHUOC DUC"}},ne=["M\u1EDBi ti\u1EBFp nh\u1EADn","\u0110ang s\u1EEDa ch\u1EEFa","Ho\xE0n th\xE0nh"];import{GoogleGenAI as We,Type as Q}from"@google/genai";var me=()=>{try{return typeof process<"u"&&process.env&&process.env.API_KEY?process.env.API_KEY:""}catch{return""}},Kt=me(),Ze=()=>{let e=me();return new We({apiKey:e||"dummy_key"})},Se=async e=>{if(!me())throw new Error("H\u1EC7 th\u1ED1ng AI ch\u01B0a s\u1EB5n s\xE0ng (Thi\u1EBFu API Key). Vui l\xF2ng ki\u1EC3m tra l\u1EA1i c\u1EA5u h\xECnh ho\u1EB7c li\xEAn h\u1EC7 admin.");if(!e||e.length<5)throw new Error("M\xF4 t\u1EA3 qu\xE1 ng\u1EAFn. Vui l\xF2ng nh\u1EADp chi ti\u1EBFt l\u1ED7i \u0111\u1EC3 AI ch\u1EA9n \u0111o\xE1n ch\xEDnh x\xE1c h\u01A1n.");let N=await Ze().models.generateContent({model:"gemini-3-flash-preview",contents:`Kh\xE1ch h\xE0ng b\xE1o l\u1ED7i: "${e}". 
    H\xE3y \u0111\xF3ng vai chuy\xEAn gia s\u1EEDa ch\u1EEFa c\u1EE7a Diticoms. H\xE3y ph\xE2n t\xEDch l\u1ED7i v\xE0 \u0111\u1EC1 xu\u1EA5t c\xE1c d\u1ECBch v\u1EE5 ho\u1EB7c linh ki\u1EC7n thay th\u1EBF c\u1EA7n thi\u1EBFt. 
    L\u01B0u \xFD: \u0110\u01A1n gi\xE1 (price) ph\u1EA3i ph\xF9 h\u1EE3p v\u1EDBi th\u1ECB tr\u01B0\u1EDDng s\u1EEDa ch\u1EEFa m\xE1y t\xEDnh/\u0111i\u1EC7n t\u1EED t\u1EA1i Vi\u1EC7t Nam.`,config:{responseMimeType:"application/json",responseSchema:{type:Q.OBJECT,properties:{suggestions:{type:Q.ARRAY,items:{type:Q.OBJECT,properties:{desc:{type:Q.STRING,description:"T\xEAn linh ki\u1EC7n ho\u1EB7c d\u1ECBch v\u1EE5"},qty:{type:Q.NUMBER,description:"S\u1ED1 l\u01B0\u1EE3ng"},price:{type:Q.NUMBER,description:"\u0110\u01A1n gi\xE1 (VN\u0110)"}},required:["desc","qty","price"]}}},required:["suggestions"]},systemInstruction:"B\u1EA1n l\xE0 tr\u1EE3 l\xFD k\u1EF9 thu\u1EADt th\xF4ng minh c\u1EE7a Diticoms. Ch\u1EC9 tr\u1EA3 v\u1EC1 d\u1EEF li\u1EC7u JSON \u0111\u1EC3 h\u1EC7 th\u1ED1ng t\u1EF1 \u0111\u1ED9ng \u0111i\u1EC1n v\xE0o h\xF3a \u0111\u01A1n. Ng\xF4n ng\u1EEF: Ti\u1EBFng Vi\u1EC7t."}});try{let p=N.text||"{}";return JSON.parse(p).suggestions}catch(p){throw console.error("L\u1ED7i x\u1EED l\xFD ph\u1EA3n h\u1ED3i AI:",p),new Error("AI ph\u1EA3n h\u1ED3i kh\xF4ng \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng. Vui l\xF2ng th\u1EED l\u1EA1i sau.")}};import{Fragment as it,jsx as n,jsxs as h}from"react/jsx-runtime";var Ie=({formData:e,setFormData:r,technicians:l,priceList:N,selectedId:p,isSubmitting:b,currentUser:g,onSave:w,onUpdate:y,onDelete:v,onClear:q,services:D,bankInfo:oe})=>{let _=g?.role==="admin",[V,S]=G(!1),[te,B]=G(!1),[T,ae]=G(!1),[j,se]=G(!1),[E,K]=G(null),[R,Y]=G(null),[s,m]=G(null),[z,W]=G(!1),I=Qe(null),U=ke(()=>{let t={};return[...D].sort((u,c)=>new Date(c.created_at).getTime()-new Date(u.created_at).getTime()).forEach(u=>{let c=String(u.phone||"").trim();c.length>=3&&(t[c]||(t[c]={name:u.customerName||"",address:u.address||""}))}),Object.entries(t).map(([u,c])=>({phone:u,...c}))},[D]),a=ke(()=>{let t=e.phone.trim();return t.length<3?[]:U.filter(x=>x.phone.includes(t)).slice(0,5)},[U,e.phone]),o=(t,x)=>{r(u=>{let c={...u,[t]:x};return t==="status"&&(x==="Ho\xE0n th\xE0nh"?c.debt=0:c.debt=c.revenue),c})},f=t=>{r(x=>({...x,phone:t.phone,customerName:t.name,address:t.address})),S(!1)},M=(t,x,u)=>{r(c=>{let X=[...c.workItems],re={...X[t],[x]:u},Re=le(x==="price"?u:re.price),Ue=Number(x==="qty"?u:re.qty);re.total=Re*Ue,X[t]=re;let ge=X.reduce((De,Me)=>De+(Number(Me.total)||0),0);return{...c,workItems:X,revenue:ge,debt:c.status==="Ho\xE0n th\xE0nh"?0:ge}})},A=async()=>{if(!e.content||e.content.length<5){he("Vui l\xF2ng nh\u1EADp m\xF4 t\u1EA3 l\u1ED7i chi ti\u1EBFt");return}W(!0);try{let t=await Se(e.content);if(t&&t.length>0){let x=t.map(c=>({desc:c.desc,qty:c.qty,price:c.price,total:c.qty*c.price})),u=x.reduce((c,X)=>c+X.total,0);r(c=>({...c,workItems:x,revenue:u,debt:c.status==="Ho\xE0n th\xE0nh"?0:u})),he("AI \u0111\xE3 ph\xE2n t\xEDch v\xE0 b\xE1o gi\xE1 xong!")}}catch(t){alert(t.message||"L\u1ED7i AI")}finally{W(!1)}},he=t=>{m(t),setTimeout(()=>m(null),3e3)},ce="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:bg-white focus:border-blue-400 font-medium transition-all text-slate-800",de="w-full p-2 bg-white border border-slate-100 rounded-xl outline-none focus:border-blue-400 font-black text-slate-800 text-[10px] text-center";return h("div",{className:"space-y-6",children:[s&&h("div",{className:"fixed top-24 left-1/2 -translate-x-1/2 z-[10001] bg-slate-900/90 backdrop-blur-md text-white px-6 py-3 rounded-full text-[11px] font-black uppercase tracking-widest animate-in fade-in zoom-in shadow-2xl flex items-center gap-2",children:[n(Te,{size:14,className:"text-yellow-400"}),s]}),h("div",{className:"flex justify-between items-center",children:[h("h2",{className:"font-bold text-slate-700 flex items-center gap-2 uppercase tracking-wider text-sm",children:[n(tt,{size:18,className:"text-blue-500"})," ",p?"C\u1EADp nh\u1EADt phi\u1EBFu":"Ti\u1EBFp nh\u1EADn m\u1EDBi"]}),p&&_&&n("button",{onClick:v,disabled:b,className:"text-red-400 p-2 hover:bg-red-50 rounded-full transition-colors",children:n(Ce,{size:20})})]}),h("div",{className:"space-y-3",children:[h("div",{className:"relative",children:[n(st,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"tel",placeholder:"S\u1ED1 \u0111i\u1EC7n tho\u1EA1i",className:ce,value:e.phone,onChange:t=>{o("phone",t.target.value),S(!0)},onFocus:()=>S(!0),onBlur:()=>setTimeout(()=>S(!1),200)}),V&&a.length>0&&n("div",{className:"absolute top-full left-0 right-0 bg-white border border-slate-200 shadow-2xl z-[60] max-h-56 overflow-auto rounded-2xl mt-1 animate-in fade-in zoom-in duration-150",children:a.map((t,x)=>n("div",{onMouseDown:()=>f(t),className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 transition-colors flex flex-col",children:h("div",{className:"flex justify-between items-center",children:[n("span",{className:"font-black text-blue-600 text-xs",children:t.phone}),n("span",{className:"font-bold text-slate-800 text-xs",children:t.name})]})},x))})]}),h("div",{className:"relative",children:[n(at,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"T\xEAn kh\xE1ch h\xE0ng",className:ce,value:e.customerName,onChange:t=>o("customerName",t.target.value)})]}),h("div",{className:"relative",children:[n(nt,{className:"absolute left-3.5 top-3 text-slate-400 z-10",size:16}),n("input",{type:"text",placeholder:"\u0110\u1ECBa ch\u1EC9",className:ce,value:e.address,onChange:t=>o("address",t.target.value)})]}),h("div",{className:"relative group",children:[n(rt,{className:"absolute left-3.5 top-3.5 text-slate-400 z-10",size:16}),n("textarea",{placeholder:"M\xF4 t\u1EA3 l\u1ED7i c\u1EE7a kh\xE1ch h\xE0ng...",className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl min-h-[100px] focus:bg-white focus:border-blue-400 outline-none transition-all",value:e.content,onChange:t=>o("content",t.target.value)}),h("button",{onClick:A,disabled:z||!e.content,className:`absolute right-3 bottom-3 flex items-center gap-2 px-4 py-2 rounded-xl font-black text-[10px] uppercase tracking-wider transition-all shadow-md ${z?"bg-slate-200 text-slate-400":"bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 text-white hover:shadow-indigo-200 hover:scale-105 active:scale-95"}`,children:[z?n(lt,{size:14,className:"animate-spin"}):n(Te,{size:14}),"AI Ch\u1EA9n \u0111o\xE1n"]})]}),h("div",{className:"grid grid-cols-2 gap-3",children:[n("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none",value:e.status,onChange:t=>o("status",t.target.value),children:ne.map(t=>n("option",{value:t,children:t},t))}),h("select",{className:"w-full p-2.5 bg-slate-50 border border-slate-100 rounded-xl font-bold text-slate-700 outline-none",value:e.technician,onChange:t=>o("technician",t.target.value),disabled:!_,children:[n("option",{value:"",children:"K\u1EF9 thu\u1EADt vi\xEAn"}),l.map(t=>n("option",{value:t,children:t},t))]})]}),h("div",{className:"pt-2",children:[h("div",{className:"flex justify-between items-center mb-2 px-1",children:[n("span",{className:"font-black text-slate-400 text-[10px] uppercase tracking-widest",children:"Danh s\xE1ch d\u1ECBch v\u1EE5"}),n("button",{onClick:()=>r(t=>({...t,workItems:[...t.workItems,{desc:"",qty:1,price:"",total:0}]})),className:"text-blue-500 p-1 hover:bg-blue-50 rounded-lg",children:n(et,{size:18})})]}),n("div",{className:"space-y-2",children:e.workItems.map((t,x)=>h("div",{className:"p-3 bg-slate-50/50 border border-slate-100 rounded-2xl space-y-2 group hover:border-blue-100 transition-all",children:[n("input",{type:"text",placeholder:"T\xEAn d\u1ECBch v\u1EE5/linh ki\u1EC7n...",className:"w-full bg-transparent font-bold text-slate-800 outline-none border-b border-transparent focus:border-blue-200",value:t.desc,onChange:u=>M(x,"desc",u.target.value)}),h("div",{className:"flex gap-2 text-[11px] font-bold",children:[h("div",{className:"flex-1 bg-white border border-slate-100 p-1.5 rounded-lg flex items-center gap-1",children:["SL: ",n("input",{type:"number",className:"w-full outline-none font-black text-center bg-transparent",value:t.qty,onChange:u=>M(x,"qty",u.target.value)})]}),n("div",{className:"flex-[2] bg-white border border-slate-100 p-1.5 rounded-lg px-2 text-right",children:n("input",{type:"text",className:"w-full outline-none font-black text-right text-blue-600 bg-transparent",value:O(t.price),onChange:u=>M(x,"price",u.target.value)})}),n("button",{onClick:()=>r(u=>({...u,workItems:u.workItems.filter((c,X)=>X!==x)})),className:"text-slate-300 hover:text-red-400 p-1",children:n(Ce,{size:16})})]})]},x))})]}),n("div",{className:"pt-4 space-y-2 bg-slate-100/40 p-4 rounded-[32px] border border-slate-100",children:h("div",{className:"grid grid-cols-3 gap-3",children:[h("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-blue-500 uppercase",children:"Doanh thu"}),n("input",{type:"text",className:`${de} text-blue-600 bg-slate-50`,value:O(e.revenue),readOnly:!0})]}),h("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-orange-500 uppercase",children:"Gi\xE1 v\u1ED1n"}),n("input",{type:"text",className:`${de} text-orange-600`,value:O(e.cost),onChange:t=>o("cost",le(t.target.value))})]}),h("div",{className:"flex flex-col gap-1 text-center",children:[n("span",{className:"text-[9px] font-black text-red-500 uppercase",children:"C\xF4ng n\u1EE3"}),n("input",{type:"text",className:`${de} text-red-600`,value:O(e.debt),onChange:t=>o("debt",le(t.target.value))})]})]})})]}),n("div",{className:"grid grid-cols-2 gap-3 pt-4",children:p?h(it,{children:[n("button",{disabled:b,onClick:y,className:"bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"C\u1EACP NH\u1EACT"}),n("button",{onClick:q,className:"bg-slate-100 text-slate-600 font-black py-4 rounded-2xl uppercase text-[12px] active:scale-95 transition-all",children:"TI\u1EBEP M\u1EDAI"})]}):n("button",{disabled:b,onClick:w,className:"col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl shadow-lg uppercase tracking-widest text-[12px] active:scale-95 transition-all",children:b?"\u0110ANG L\u01AFU...":"L\u01AFU PHI\u1EBEU M\u1EDAI"})}),p&&h("button",{onClick:()=>B(!0),className:"w-full bg-slate-800 hover:bg-slate-900 text-white font-black py-4 rounded-2xl uppercase shadow-md flex items-center justify-center gap-3 text-[12px] transition-all",children:[n(ot,{size:20})," XU\u1EA4T H\xD3A \u0110\u01A0N"]})]})};import{useState as ct}from"react";import{X as dt,Save as pt,CreditCard as ut,RefreshCw as mt,Loader2 as ht}from"lucide-react";import{jsx as L,jsxs as H}from"react/jsx-runtime";var Ae=({config:e,onSave:r,onClose:l,isAdmin:N,onCheckUpdate:p,isCheckingUpdate:b})=>{let[g,w]=ct({...e});return L("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4",children:H("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl space-y-6",children:[H("div",{className:"flex justify-between items-center",children:[L("h3",{className:"font-black text-slate-900 uppercase tracking-tight",children:"C\u1EA5u h\xECnh h\u1EC7 th\u1ED1ng"}),L("button",{onClick:l,className:"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600",children:L(dt,{size:20})})]}),H("div",{className:"space-y-4",children:[H("div",{className:"space-y-3",children:[H("label",{className:"text-[10px] font-bold text-slate-400 uppercase ml-1 flex items-center gap-2",children:[L(ut,{size:12})," Th\xF4ng tin ng\xE2n h\xE0ng"]}),H("div",{className:"grid grid-cols-2 gap-3",children:[L("input",{placeholder:"ID Ng\xE2n h\xE0ng",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.bankId,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,bankId:y.target.value}}))}),L("input",{placeholder:"S\u1ED1 t\xE0i kho\u1EA3n",className:"p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountNo,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,accountNo:y.target.value}}))}),L("input",{placeholder:"Ch\u1EE7 t\xE0i kho\u1EA3n",className:"col-span-2 p-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:border-blue-500 text-xs",value:g.bankInfo?.accountName,onChange:y=>w(v=>({...v,bankInfo:{...v.bankInfo,accountName:y.target.value.toUpperCase()}}))})]})]}),p&&L("div",{className:"pt-2",children:H("button",{onClick:p,disabled:b,className:"w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl text-[10px] font-bold uppercase transition-colors",children:[b?L(ht,{size:14,className:"animate-spin"}):L(mt,{size:14}),"Ki\u1EC3m tra c\u1EADp nh\u1EADt t\u1EEB GitHub"]})})]}),H("div",{className:"flex gap-3",children:[H("button",{onClick:()=>r(g),className:"flex-1 bg-blue-600 text-white font-bold py-3 rounded-2xl flex items-center justify-center gap-2 shadow-lg shadow-blue-100",children:[L(pt,{size:18})," L\u01AFU C\u1EA4U H\xCCNH"]}),L("button",{onClick:l,className:"px-6 bg-slate-100 text-slate-600 font-bold rounded-2xl",children:"H\u1EE6Y"})]})]})})};async function F(e,r,l={},N=0){if(!e||!e.startsWith("http"))throw new Error("C\u1EA5u h\xECnh URL Server kh\xF4ng h\u1EE3p l\u1EC7.");try{let g=new AbortController,w=setTimeout(()=>g.abort(),2e4),y=await fetch(e,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({...l,action:r}),signal:g.signal});if(clearTimeout(w),!y.ok)throw new Error(`HTTP ${y.status}`);let v=await y.text();if(!v)throw new Error("Server ph\u1EA3n h\u1ED3i r\u1ED7ng.");let q=v.match(/(\{[\s\S]*\}|\[[\s\S]*\])/);return JSON.parse(q?q[0]:v)}catch(g){if(N<1&&(g.name==="AbortError"||g.message.includes("HTTP")))return F(e,r,l,N+1);throw g}}import{jsx as k,jsxs as ee}from"react/jsx-runtime";var xt=()=>{let[e,r]=P(()=>{let a=localStorage.getItem("diti_user");return a?JSON.parse(a):null}),[l,N]=P(()=>{let a=localStorage.getItem("diti_config");return{...a?JSON.parse(a):ye,sheetUrl:ue}}),[p,b]=P(()=>{let a=localStorage.getItem("diti_services_cache");return a?JSON.parse(a):[]}),[g,w]=P([]),[y,v]=P([]),[q,D]=P(!1),[oe,_]=P(!1),[V,S]=P(!1),[te,B]=P(!1),[T,ae]=P(null),[j,se]=P(null),[E,K]=P({dateFrom:pe(),dateTo:pe(),searchTerm:"",searchTech:"",viewAll:!1}),[R,Y]=P({customerName:"",phone:"",address:"",status:ne[0],technician:"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0});Le(()=>{let a=o=>{o.preventDefault(),se(o)};return window.addEventListener("beforeinstallprompt",a),()=>window.removeEventListener("beforeinstallprompt",a)},[]);let s=async()=>{if(j){j.prompt();let{outcome:a}=await j.userChoice;a==="accepted"&&se(null)}else alert(`\u0110\u1EC3 c\xE0i \u0111\u1EB7t: 
- Android: Ch\u1ECDn 'Th\xEAm v\xE0o m\xE0n h\xECnh ch\xEDnh' trong menu tr\xECnh duy\u1EC7t.
- iOS: Nh\u1EA5n n\xFAt Share r\u1ED3i ch\u1ECDn 'Th\xEAm v\xE0o MH ch\xEDnh'.`)},m=Pe(async()=>{if(e){D(p.length===0);try{let[a,o,f]=await Promise.all([F(l.sheetUrl,"read"),F(l.sheetUrl,"read_settings"),F(l.sheetUrl,"read_pricelist")]);if(Array.isArray(a)){let M=a.map(A=>({...A,customerName:A.customer_name||A.customerName||"",workItems:typeof A.work_items=="string"?JSON.parse(A.work_items):A.work_items||[],revenue:Number(A.revenue||0),cost:Number(A.cost||0),debt:Number(A.debt||0),created_at:A.created_at||A.date||new Date().toISOString()}));b(M),localStorage.setItem("diti_services_cache",JSON.stringify(M))}if(o?.technicians){let M=typeof o.technicians=="string"?JSON.parse(o.technicians):o.technicians;w(Array.isArray(M)?M:[])}Array.isArray(f)&&v(f)}catch(a){console.error("Fetch Error:",a)}finally{D(!1)}}},[e,l.sheetUrl,p.length]);Le(()=>{e&&m()},[e,m]);let z=gt(()=>{let a=[...p];if(e?.role!=="admin"&&e?.associatedTech&&(a=a.filter(o=>o.technician===e.associatedTech)),E.viewAll||(a=a.filter(o=>{let f=(o.created_at||"").split("T")[0];return f>=E.dateFrom&&f<=E.dateTo})),E.searchTech&&(a=a.filter(o=>o.technician===E.searchTech)),E.searchTerm){let o=E.searchTerm.toLowerCase();a=a.filter(f=>(f.customerName||"").toLowerCase().includes(o)||(f.phone||"").includes(o)||(f.address||"").toLowerCase().includes(o))}return a.sort((o,f)=>new Date(f.created_at).getTime()-new Date(o.created_at).getTime())},[p,E,e]),W=async(a,o)=>{D(!0);try{let f=await F(l.sheetUrl,"login",{username:a,password:o});f?.status==="success"&&f.user?(r(f.user),localStorage.setItem("diti_user",JSON.stringify(f.user))):alert(f?.error||"Sai th\xF4ng tin")}catch{alert("L\u1ED7i k\u1EBFt n\u1ED1i")}finally{D(!1)}},I=()=>{confirm("\u0110\u0103ng xu\u1EA5t?")&&(r(null),localStorage.clear(),window.location.reload())},U=Pe(()=>{ae(null),Y({customerName:"",phone:"",address:"",status:ne[0],technician:e?.associatedTech||"",content:"",workItems:[{desc:"",qty:1,price:"",total:0}],revenue:0,cost:0,debt:0})},[e]);return e?ee("div",{className:"flex flex-col min-h-screen bg-slate-50 font-sans",children:[k("header",{className:"sticky top-0 z-40 bg-white border-b px-4 py-3 shadow-sm",children:ee("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[ee("div",{className:"flex items-center gap-3",children:[k(J,{size:32}),ee("div",{children:[k("h1",{className:"font-bold text-slate-800 text-[12px] uppercase",children:"DITICOMS SERVICE"}),k("span",{className:"text-slate-400 text-[10px] uppercase font-bold",children:e.name})]})]}),ee("div",{className:"flex gap-2",children:[k("button",{onClick:()=>S(!0),className:"p-2 text-slate-400 hover:text-blue-500",children:k(bt,{size:18})}),k("button",{onClick:I,className:"p-2 text-red-400",children:k(ft,{size:18})})]})]})}),k("main",{className:"flex-1 lg:h-[calc(100vh-64px)] overflow-y-auto lg:overflow-hidden",children:ee("div",{className:"max-w-7xl mx-auto p-4 lg:p-6 h-full grid grid-cols-1 lg:grid-cols-12 gap-6",children:[k("div",{className:"lg:col-span-5 h-full bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col",children:k("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:k(Ie,{formData:R,setFormData:Y,technicians:g,priceList:y,selectedId:T,isSubmitting:oe,currentUser:e,services:p,bankInfo:l.bankInfo,onClear:U,onSave:async()=>{_(!0);try{(await F(l.sheetUrl,"create",{...R,customer_name:R.customerName,work_items:R.workItems,id:Date.now().toString(),created_at:new Date().toISOString()}))?.status==="success"&&(await m(),U(),alert("L\u01B0u phi\u1EBFu th\xE0nh c\xF4ng"))}catch{alert("L\u1ED7i khi l\u01B0u phi\u1EBFu")}finally{_(!1)}},onUpdate:async()=>{if(T){_(!0);try{await F(l.sheetUrl,"update",{...R,customer_name:R.customerName,work_items:R.workItems,id:T,created_at:p.find(a=>a.id===T)?.created_at}),await m(),U(),alert("C\u1EADp nh\u1EADt phi\u1EBFu th\xE0nh c\xF4ng")}catch{alert("L\u1ED7i khi c\u1EADp nh\u1EADt phi\u1EBFu")}finally{_(!1)}}},onDelete:async()=>{if(!(!T||!confirm("X\xF3a?"))){_(!0);try{await F(l.sheetUrl,"delete",{id:T,role:e.role}),await m(),U()}catch{alert("L\u1ED7i khi x\xF3a phi\u1EBFu")}finally{_(!1)}}}})})}),k("div",{className:"lg:col-span-7 h-full flex flex-col min-h-[500px]",children:k(we,{data:z,loading:q,technicians:g,selectedId:T,onSelectRow:a=>{ae(a.id),Y({...a}),window.innerWidth<1024&&window.scrollTo({top:0,behavior:"smooth"})},filters:E,setFilters:{setDateFrom:a=>K(o=>({...o,dateFrom:a,viewAll:!1})),setDateTo:a=>K(o=>({...o,dateTo:a,viewAll:!1})),setSearchTerm:a=>K(o=>({...o,searchTerm:a})),setSearchTech:a=>K(o=>({...o,searchTech:a})),setViewAll:a=>K(o=>({...o,viewAll:a}))},currentUser:e,onInstallApp:s,installAvailable:!!j})})]})}),V&&k(Ae,{config:l,isAdmin:e.role==="admin",onClose:()=>S(!1),onSave:a=>{N(a),localStorage.setItem("diti_config",JSON.stringify(a)),S(!1)}})]}):k(fe,{onLogin:W,isLoading:q})},_e=xt;import{jsx as ze}from"react/jsx-runtime";var wt=()=>{typeof window.removeSplash=="function"&&window.removeSplash()},Ee=document.getElementById("root");Ee&&(wt(),Nt(Ee).render(ze(vt.StrictMode,{children:ze(_e,{})})));
